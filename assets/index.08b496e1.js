var tt=Object.defineProperty,nt=Object.defineProperties;var rt=Object.getOwnPropertyDescriptors;var Me=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable;var he=(e,t,n)=>t in e?tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,k=(e,t)=>{for(var n in t||(t={}))st.call(t,n)&&he(e,n,t[n]);if(Me)for(var n of Me(t))ot.call(t,n)&&he(e,n,t[n]);return e},se=(e,t)=>nt(e,rt(t));var ze=(e,t,n)=>(he(e,typeof t!="symbol"?t+"":t,n),n),pe=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)};var oe=(e,t,n)=>(pe(e,t,"read from private field"),n?n.call(e):t.get(e)),ye=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},_e=(e,t,n,r)=>(pe(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);var Oe=(e,t,n)=>(pe(e,t,"access private method"),n);import{C as it,R as at,a as ct,D as lt,F as dt,A as ut,m as ft,j as ie,c as ge,b as A,r as w,n as ae,d as ht,L as pt,E as yt,e as gt,f as wt,g as mt,h as xt}from"./vendor.8922c5b7.js";const Dt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}};Dt();const Ce={theme:"outline",size:"20",fill:"#333"},we=[{type:"selection",Icon:it},{type:"rectangle",Icon:at},{type:"circle",Icon:ct},{type:"diamond",Icon:lt},{type:"text",Icon:dt},{type:"arrow",Icon:ut}],me="emodraw",Pe="Segoe UI Emoji",Y=15,xe=Y+3,St="#fff",L={default:"default",crosshair:"crosshair",move:"move",grab:"grab",neswResize:"nesw-resize",nwseResize:"nwse-resize"},Tt=30,W=3,U=8,Et=[15,10],ce=10,Ne=20,le=30,Rt="emodraw.png",bt="emodraw",ke=["rectangle","circle","diamond"],J=(e,t,n,r,s)=>{e.beginPath(),e.moveTo(t,n),e.lineTo(t+r,n),e.lineTo(t+r,n+s),e.lineTo(t,n+s),e.closePath(),e.stroke()},Lt=(e,t,n,r,s)=>{e.save(),e.fillStyle="rgba(255,165,0,0.5)",e.fillRect(t,n,r,s),e.restore()},It=(e,t,n,r,s)=>{const o=r>s?1/r:1/s;e.beginPath(),e.moveTo(t+r,n);for(let i=0;i<Math.PI*2;i+=o)e.lineTo(t+r*Math.cos(i),n+s*Math.sin(i));e.closePath(),e.stroke()},vt=(e,t,n,r,s)=>{e.beginPath(),e.moveTo(t+r/2,n+s),e.lineTo(t+r,n+s/2),e.lineTo(t+r/2,n),e.lineTo(t,n+s/2),e.closePath(),e.stroke()},At=(e,t)=>Math.floor(180/(Math.PI/Math.atan(e/t))),Xe=30,Mt=(e,t,n,r,s)=>{const o=Math.min(Math.pow(r*r+s*s,1/2)/2,Tt),i=s<0?-o:o,g=At(r,s),c=g+Xe,p=g-Xe,x=t+r,D=n+s,S=x-i*Math.sin(Math.PI*c/180),I=D-i*Math.cos(Math.PI*c/180),R=x-i*Math.sin(Math.PI*p/180),X=D-i*Math.cos(Math.PI*p/180);e.beginPath(),e.moveTo(t,n),e.lineTo(x,D),e.lineTo(S,I),e.moveTo(x,D),e.lineTo(R,X),e.stroke()},zt=(e,t)=>{const{type:n,x:r,y:s,width:o,height:i}=t;switch(n){case"rectangle":J(e,r,s,o,i);return;case"circle":It(e,r+o/2,s+i/2,Math.abs(o/2),Math.abs(i/2));return;case"arrow":Mt(e,r,s,o,i);return;case"diamond":vt(e,r,s,o,i);return;case"selection":Lt(e,r,s,o,i);return}},_t=(e,t)=>{const{content:n,x:r,y:s,containerId:o,width:i}=t;e.textBaseline="bottom",e.font=`${Y}px  ${Pe}`,Re(n).forEach((c,p)=>{if(o){const x=e.measureText(c).width;e.fillText(c,r+(i-x)/2,s+Y*(p+1))}else e.fillText(c,r,s+Y*(p+1))})},Ye=(e,{x:t,y:n,width:r,height:s,type:o},i)=>{const g=r>0?W:-W,c=s>0?W:-W,p=t-g,x=t+r+g,D=n-c,S=n+s+c;if(e.setLineDash(Et),e.beginPath(),e.moveTo(p,D),e.lineTo(x,D),e.lineTo(x,S),e.lineTo(p,S),e.closePath(),e.stroke(),e.setLineDash([]),!i){const I=r>0?U:-U,R=s>0?U:-U;o!=="text"&&(J(e,p,D,-I,-R),J(e,x,S,I,R),o!=="arrow"&&(J(e,x,D,I,-R),J(e,p,S,-I,R)))}},Ot=e=>{const t=l.getSelectionData();if(!t)return;const[n,r,s,o]=t;Ye(e,{x:n,y:s,width:r-n,height:o-s,type:"selection"},!1)},De=(e,t=l.data)=>{let n=!1;l.data.filter(s=>s.isSelected).length>1&&(Ot(e),n=!0),t.forEach(s=>{s.isSelected&&Ye(e,s,n),s.type==="text"?_t(e,s):zt(e,s)})};var G,de,Pt;class Ct{constructor(){ye(this,de);ze(this,"data");ye(this,G,void 0);this.data=Oe(this,de,Pt).call(this),_e(this,G,[])}addOperateStack(t){oe(this,G).push(t)}getSelectionData(){const t=this.data.filter(n=>n.isSelected);if(t.length===1&&t[0].type==="text")return null;if(t.length===1&&t[0].type==="arrow"){const n=t[0];return[n.x,n.x+n.width,n.y,n.y+n.height,!0]}return[...Ee(t),!1]}addDrawData(t){this.data.push(t)}popDrawData(){this.data.pop()}revokeDrawData(){if(oe(this,G).length>0){const t=oe(this,G).pop();if(t.type==="DELETE"&&this.data.push(...t.payload),t.type==="ADD"&&(this.data=this.data.filter(n=>!t.selectedIds.includes(n.id))),t.type==="MOVE"){const{x:n,y:r}=t.payload;this.data.forEach(s=>s.isSelected=!1),this.data.filter(s=>t.selectedIds.includes(s.id)).forEach(s=>{s.x-=n,s.y-=r,s.isSelected=!0})}if(t.type==="RESIZE"){const n=t.payload,r=n.map(s=>s.id);this.data=this.data.filter(s=>!r.includes(s.id)).concat(n)}t.type==="SET"&&(this.data=t.payload),this.storageDrawData()}}storageDrawData(){this.data=this.data.filter(t=>t.type!=="selection").map(t=>{if(t.type==="arrow")return t;const n=k({},t);return n.width<0&&(n.x=n.x+n.width,n.width=-n.width),n.height<0&&(n.y=n.y+n.height,n.height=-n.height),n}),localStorage.setItem(me,JSON.stringify(this.data))}delete(){const t=[];this.data.forEach(n=>{n.isSelected&&(n.isDeleted=!0,ke.includes(n.type)&&n.boundElement.forEach(r=>{console.log(r,this.data),this.data.find(s=>s.id===r.id).isDeleted=!0}))}),this.data=this.data.filter(n=>n.isDeleted?(t.push(se(k({},n),{isSelected:!1,isDeleted:!1})),!1):!0),this.addOperateStack({type:"DELETE",payload:t}),this.storageDrawData()}}G=new WeakMap,de=new WeakSet,Pt=function(){let t;try{t=JSON.parse(localStorage.getItem(me))||[]}catch{t=[],localStorage.setItem(me,"[]")}return t};var l=new Ct;const We=()=>document.querySelector("textarea")?null:document.createElement("textarea"),He=(e,t)=>{Object.assign(e.style,k({position:"absolute",margin:0,padding:0,border:0,outline:0,background:"transparent",resize:"none",fontSize:Y+"px",lineHeight:"1em",fontFamily:Pe,overflow:"hidden"},t))},Fe=(e,{oninput:t,onChange:n})=>{e.onkeydown=r=>{r.stopPropagation()},e.oninput=()=>{e.style.height=e.scrollHeight+"px",t==null||t()},e.onblur=r=>{n(r.target.value),document.body.removeChild(e)},setTimeout(()=>{e.focus()})},Nt=(e,t,n)=>{const r=We();if(!r)return;if(He(r,{top:e.y+e.height/2-xe+"px",left:e.x+"px",width:e.width+"px",height:xe+"px",textAlign:"center"}),n){const o=n.content;r.value=o,r.setSelectionRange(0,o.length),r.style.height=n.height+"px",r.style.top=e.y+e.height/2-n.height/2+"px"}const s=()=>{const[o]=Be(r.value,e.width);return o.length};Fe(r,{oninput:()=>{const o=s();r.style.height=o*xe+"px",r.style.top=e.y+e.height/2-o*Y/2+"px"},onChange:o=>{t(o,Y*s())}}),document.body.appendChild(r)},kt=({x:e,y:t},n,r)=>{const s=We();if(!!s){if(r){const o=r.content;s.value=o,s.setSelectionRange(0,o.length),s.style.height=r.height+"px"}He(s,{top:t+"px",left:e+"px",width:`${window.innerWidth-e}px`,whiteSpace:"nowrap"}),Fe(s,{onChange:n}),document.body.appendChild(s)}},O=5,Xt=e=>e>O?e-O:0,K=e=>e+O<window.innerWidth?e+O:window.innerWidth,V=e=>e+O<window.innerWidth?e+O:window.innerWidth,N=(e,t,n)=>e>=Xt(t)&&e<=n,Se=(e,t,n,r)=>Math.pow(Math.pow(Math.abs(e-t),2)+Math.pow(Math.abs(n-r),2),1/2),Te=({x:e,y:t})=>{for(let n=0;n<l.data.length;n++){const r=l.data[n],s=r.x,o=r.x+r.width,i=r.y,g=r.y+r.height;if(r.isSelected){const c=r.width>0?o:s,p=r.width>0?s:o,x=r.height>0?g:i,D=r.height>0?i:g;if(e>=p&&e<=c&&t>=D&&t<=x)return r.id}if(r.type==="text"&&N(e,s,K(o))&&N(t,i,V(g))||r.type==="rectangle"&&((N(e,s,K(s))||N(e,o,K(o)))&&N(t,i,V(g))||(N(t,i,V(i))||N(t,g,V(g)))&&N(e,s,K(o))))return r.id;if(r.type==="diamond"){const c=r.width*r.height,p=Math.abs(e-(s+r.width/2)),x=Math.abs(t-(i+r.height/2)),D=((p+O)*r.height+(x+O)*r.width)*2,S=((p-O)*r.height+(x-O)*r.width)*2;if(D>=c&&S<=c)return r.id}if(r.type==="circle"){const c=s+r.width/2,p=i+r.height/2,x=Math.abs(r.width/2),D=Math.abs(r.height/2),S=x>D?1/x:1/D;for(let I=0;I<Math.PI*2;I+=S){const R=Math.round(c+x*Math.cos(I)),X=Math.round(p+D*Math.sin(I));if(N(e,R,K(R))&&N(t,X,V(X)))return r.id}}if(r.type==="arrow"){const c=Math.round(Se(s,o,i,g)),p=Math.round(Se(e,s,t,i)+Se(e,o,t,g));if(p>=c-O/2&&p<=c+O/2)return r.id}}return null},Yt=(e,t,n,r)=>{const[s,o]=n>0?[e+n,e]:[e,e+n],[i,g]=r>0?[t+r,t]:[t,t+r];return l.data.filter(c=>{if(c.type==="selection")return!1;const[p,x]=c.width>0?[c.x+c.width,c.x]:[c.x,c.x+c.width],[D,S]=c.height>0?[c.y+c.height,c.y]:[c.y,c.y+c.height];return s>=p&&o<=x&&i>=D&&g<=S}).map(({id:c})=>c)},Ge=(e,t)=>{const n=l.getSelectionData();if(!n)return!1;const[r,s,o,i]=n;return e<=r&&e>=s&&t<=o&&t>=i},T=(e,t,n)=>n?e>=t+W&&e<=t+U+W:e<=t-W&&e>=t-U-W,Ue=({x:e,y:t})=>{const n=l.getSelectionData();if(!n)return null;const[r,s,o,i,g]=n;if(g){if(r>=s&&o>i){if(T(e,s,!1)&&T(t,i,!1))return[L.nwseResize,"top"];if(T(e,r,!0)&&T(t,o,!0))return[L.nwseResize,"bottom"]}else if(r>=s&&o<i){if(T(e,s,!1)&&T(t,i,!0))return[L.neswResize,"bottom"];if(T(e,r,!0)&&T(t,o,!1))return[L.neswResize,"top"]}else if(r<s&&o>i){if(T(e,s,!0)&&T(t,i,!1))return[L.neswResize,"top"];if(T(e,r,!1)&&T(t,o,!0))return[L.neswResize,"bottom"]}else{if(T(e,r,!1)&&T(t,o,!1))return[L.nwseResize,"top"];if(T(e,s,!0)&&T(t,i,!0))return[L.nwseResize,"bottom"]}return null}return T(e,s,!1)&&T(t,i,!1)?[L.nwseResize,"top"]:T(e,r,!0)&&T(t,o,!0)?[L.nwseResize,"bottom"]:T(e,s,!1)&&T(t,o,!0)?[L.neswResize,"bottom"]:T(e,r,!0)&&T(t,i,!1)?[L.neswResize,"top"]:null},Wt=({x:e,y:t})=>{const n=l.data.filter(r=>r.type==="text");for(let r=0;r<n.length;r++){const s=n[r];if(e>=s.x&&e<=s.x+s.width&&t>=s.y&&t<=s.y+s.height)return s}return null},Ee=e=>{let t=-1/0,n=-1/0,r=1/0,s=1/0;return e.forEach(o=>{const[i,g]=o.width>0?[o.x+o.width,o.x]:[o.x,o.x+o.width],[c,p]=o.height>0?[o.y+o.height,o.y]:[o.y,o.y+o.height];i>t&&(t=i),c>n&&(n=c),g<r&&(r=g),p<s&&(s=p)}),[t,r,n,s]},Ht=({x:e,y:t})=>{let n=null;return l.data.forEach(r=>{const s=r.x+r.width/2,o=r.y+r.height/2;ke.includes(r.type)&&e<=s+ce&&e>=s-ce&&t<=o+ce&&t>=o-ce&&(n?r.width<n.width&&(n=r):n=r)}),n},Re=e=>e.replace(/\r\n?/g,`
`).split(`
`),Ft=e=>{const t="\uFEFF",n=new Blob([t+e],{type:"text/json"});return URL.createObjectURL(n)},Be=(e,t,n)=>{const r=n!=null?n:document.createElement("canvas").getContext("2d"),s=[];Re(e).forEach(g=>{let c="",p=0;for(let x=1;x<=g.length;x++){c=g.substring(p,x);const{width:D}=r.measureText(c);D>t&&(s.push(g.substring(p,x-1)),p=x-1)}s.push(c)});let i=0;return s.forEach(g=>{const{width:c}=r.measureText(g);c>i&&(i=c)}),[s,i]},je=(e,t)=>{const n=document.createElement("a");n.download=t,n.href=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)};var C=ft();const Gt="_container_1dwzc_1",Ut="_element_1dwzc_10",Bt="_operate_1dwzc_14",jt="_active_1dwzc_30";var H={container:Gt,element:Ut,operate:Bt,"tool-item":"_tool-item_1dwzc_17",active:jt,"tool-index":"_tool-index_1dwzc_33"};const Jt=({Icon:e,index:t,changeType:n,isActive:r})=>ie("div",{className:ge(H["tool-item"],{[H.active]:r}),onClick:n,children:[A("div",{children:e}),A("div",{className:H["tool-index"],children:t})]}),Kt=(e,t)=>{w.exports.useEffect(()=>{const n=()=>{!e.current||!t.current||(e.current.width=window.innerWidth,e.current.height=window.innerHeight,De(t.current))};return n(),window.addEventListener("resize",n),()=>document.removeEventListener("resize",n)},[])},Je=e=>{w.exports.useEffect(()=>{const t=n=>{const{key:r,metaKey:s}=n;e(r,s)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[])},be=w.exports.createContext({}),Vt=({children:e})=>{const[t,n]=w.exports.useState("selection");return A(be.Provider,{value:{drawType:t,setDrawType:n},children:e})},Le=w.exports.createContext({}),Zt=({children:e})=>{const[t,n]=w.exports.useState(L.default);return A(Le.Provider,{value:{cursorType:t,setCursorType:n},children:e})},$t=e=>{const{drawType:t,setDrawType:n}=w.exports.useContext(be),{cursorType:r,setCursorType:s}=w.exports.useContext(Le),o=w.exports.useRef(!1),i=w.exports.useRef(!1),g=w.exports.useRef(!1),c=w.exports.useRef(!1),p=w.exports.useRef(),x=w.exports.useRef(),D=w.exports.useRef(),S=w.exports.useRef({x:0,y:0}),I=w.exports.useRef({x:0,y:0}),R=w.exports.useRef({x:0,y:0}),X=w.exports.useRef([]),Z=w.exports.useRef([]),ue=w.exports.useRef({x:0,y:0}),$=w.exports.useRef(!1),z=()=>{e.current&&(e.current.clearRect(0,0,window.innerWidth,window.innerHeight),De(e.current))},B=()=>{l.data.forEach(d=>d.isSelected=!1)};w.exports.useEffect(()=>{const d=()=>{l.addOperateStack({type:"DELETE",payload:l.data}),l.data=[],l.storageDrawData(),z()},u=()=>{if(l.data.length===0)return;const h=document.createElement("canvas"),[y,m,E,b]=Ee(l.data),v=y-m+le,_=E-b+le;h.width=v,h.height=_;const M=h.getContext("2d");M.save(),M.fillStyle=St,M.fillRect(0,0,v,_),M.restore(),De(M,l.data.map(j=>se(k({},j),{x:j.x-m+le/2,y:j.y-b+le/2})));const F=h.toDataURL();je(F,Rt)},a=()=>{if(l.data.length===0)return;const h=Ft(JSON.stringify(l.data));je(h,bt)},f=()=>{const h=document.createElement("input");h.type="file",document.body.appendChild(h),h.click(),h.onchange=y=>{const E=y.target.files[0],b=new FileReader;b.onload=v=>{try{const _=JSON.parse(v.target.result);l.addOperateStack({type:"SET",payload:l.data}),l.data=_,l.storageDrawData(),z()}catch{}},b.readAsText(E),document.body.removeChild(h)}};return C.on("exportImage",u),C.on("exportData",a),C.on("clear",d),C.on("import",f),()=>{C.off("import",f),C.off("exportData",a),C.off("exportImage",u),C.off("clear",d)}},[]),w.exports.useEffect(()=>{const d=()=>{Z.current=l.data.filter(a=>a.isSelected)},u=()=>{if(Z.current.length>0&&!$.current){const[a,f,h,y]=Ee(Z.current),[m,E]=[(a+f)/2,(h+y)/2],[b,v]=[ue.current.x-m,ue.current.y-E];B();const _=[];Z.current.forEach(M=>{const F=ae();l.addDrawData(se(k({},M),{id:F,x:M.x+b,y:M.y+v,isSelected:!0})),_.push(F)}),l.addOperateStack({type:"ADD",selectedIds:_}),l.storageDrawData(),z()}};return document.addEventListener("copy",d),document.addEventListener("paste",u),()=>{document.removeEventListener("copy",d),document.addEventListener("paste",u)}},[]);const Ke=(d,u,a)=>{d.type==="arrow"?x.current==="head"?(d.width+=u,d.height+=a):(d.x+=u,d.y+=a,d.width-=u,d.height-=a):r==="nesw-resize"?p.current==="top"?(d.y+=a,d.width+=u,d.height-=a):(d.height+=a,d.x+=u,d.width-=u):r==="nwse-resize"&&(p.current==="top"?(d.x+=u,d.y+=a,d.width-=u,d.height-=a):(d.width+=u,d.height+=a))},Ve=(d,u,a)=>{const{x:f,y:h}=I.current,y={x:0,y:0},m=u-f,E=a-h,b=l.getSelectionData(),v=b[0]-b[1],_=b[2]-b[3],M=p.current==="top",F=M&&r==="nesw-resize"||p.current==="bottom"&&r==="nwse-resize",j=p.current==="bottom"&&r==="nesw-resize"||M&&r==="nwse-resize";if(v<=Ne&&(m<=R.current.x&&F||m>=R.current.x&&j)||_<=Ne&&(E<=R.current.y&&p.current==="bottom"||E>=R.current.y&&M))return;let ne=0,re=0;const Ie=Math.abs(m)>Math.abs(E);ne=Ie?r==="nesw-resize"?-E:E:m,re=Ie?E:r==="nesw-resize"?-m:m,y.x=b[F?1:0],y.y=b[M?2:3],d.forEach(P=>{const ve=Math.abs(P.x-y.x)/v,Qe=Math.abs(P.x+P.width-y.x)/v,Ae=Math.abs(P.y-y.y)/_,et=Math.abs(P.y+P.height-y.y)/_;P.x+=(ne-R.current.x)*ve,P.y+=(re-R.current.y)*Ae,P.width+=(ne-R.current.x)*(Qe-ve),P.height+=(re-R.current.y)*(et-Ae)}),R.current={x:ne,y:re}},Ze=(d,u,a)=>{d.length===1?Ke(d[0],u-S.current.x,a-S.current.y):Ve(d,u,a)},$e=(d,u,a)=>{d.forEach(f=>{f.x+=u,f.y+=a})},fe=(d,u,a)=>{$.current=!0;const f=u?l.data.find(y=>y.id===u):Ht(d),h=ae();f?Nt(f,(y,m)=>{if($.current=!1,y.trim()&&e.current){const[E,b]=Be(y,f.width,e.current),v=f.y+f.height/2-m/2;l.addDrawData({type:"text",id:h,x:f.x+(f.width-b)/2,y:v,content:E.join(`
`),width:b,height:m,isSelected:!1,isDeleted:!1,containerId:f.id}),f.boundElement.push({type:"text",id:h}),l.addOperateStack({type:"ADD",selectedIds:[h]}),l.storageDrawData(),z()}},a):kt(d,y=>{if($.current=!1,y.trim()){const m=Re(y);let E=0;m.forEach(b=>{if(e.current){const{width:v}=e.current.measureText(b);v>E&&(E=v)}}),l.addDrawData({type:"text",id:h,x:d.x,y:d.y,content:y,width:E,height:m.length*Y,isSelected:!1,isDeleted:!1,containerId:null}),l.addOperateStack({type:"ADD",selectedIds:[h]}),l.storageDrawData(),z()}},a)},q=w.exports.useRef();q.current=(d,u)=>{if(t==="selection"){const a=Wt({x:d,y:u});if(B(),a){if(l.data=l.data.filter(f=>f.id!==a.id),a.containerId){const f=l.data.find(h=>h.id===a.containerId);f.boundElement=f.boundElement.filter(h=>h.id!==a.id)}fe({x:a.x,y:a.y},a.containerId,a)}else fe({x:d,y:u},null);z()}},w.exports.useEffect(()=>{const d=({pageX:u,pageY:a})=>{var f;(f=q.current)==null||f.call(q,u,a)};return document.addEventListener("dblclick",d),()=>document.removeEventListener("dblclick",d)},[]),w.exports.useEffect(()=>{s(t==="selection"?L.default:L.crosshair),t!=="selection"&&B()},[t]),Je((d,u)=>{u&&d==="z"&&(l.revokeDrawData(),z()),u&&d==="a"&&(l.data.forEach(a=>a.isSelected=!0),l.data.length>1&&(c.current=!0),l.storageDrawData(),z()),d==="Backspace"&&(l.delete(),z())});const qe=()=>{D.current=void 0,g.current=!1,R.current={x:0,y:0},X.current=[]},Q=w.exports.useRef();Q.current=d=>{if(d.button===2)return;const{pageX:u,pageY:a}=d;if(S.current=I.current={x:u,y:a},t==="text")n("selection"),fe({x:u,y:a},null);else if(t==="selection"){if(o.current=!0,c.current&&Ge(u,a)){i.current=!0;return}const f=Ue({x:u,y:a});if(f){p.current=f[1],i.current=!0;const y=l.data.filter(m=>m.isSelected);if(X.current=y.map(m=>k({},m)),y.length===1&&y[0].type==="arrow"){const m=y[0];x.current=m.height<=0&&p.current==="top"||m.height>0&&p.current==="bottom"?"head":"foot"}return}const h=Te({x:u,y:a});B(),i.current=!1,h?(l.data.find(y=>y.id===h).isSelected=!0,i.current=!0,l.storageDrawData()):(l.addDrawData({type:t,id:ae(),x:u,y:a,width:0,height:0,isSelected:!1,isDeleted:!1}),z())}else o.current=!0,l.addDrawData({type:t,id:ae(),x:u,y:a,width:0,height:0,isSelected:!1,isDeleted:!1,boundElement:[]})};const ee=w.exports.useRef();ee.current=d=>{const{pageX:u,pageY:a}=d;if(ue.current={x:u,y:a},!o.current){const y=Ue({x:u,y:a});if(y){s(y[0]);return}if(t==="selection"){const m=c.current?Ge(u,a):Te({x:u,y:a});s(m?L.move:L.default)}return}const f=u-S.current.x,h=a-S.current.y;if(t==="selection"&&i.current){const y=l.data.filter(E=>E.isSelected),m=["nesw-resize","nwse-resize"].includes(r);m?Ze(y,u,a):$e(y,f,h),(u!==S.current.x||a!==S.current.y)&&(D.current=m?"resize":"move",S.current={x:u,y:a})}else{const y=l.data[l.data.length-1];if(y.type!=="text"&&(y.width=f,y.height=h),y.type==="selection"){g.current=!0;const m=Yt(S.current.x,S.current.y,f,h);c.current=m.length>1,l.data.forEach(E=>{E.isSelected=m.includes(E.id)})}}z()};const te=w.exports.useRef();te.current=d=>{if(!o.current)return;o.current=!1;const{pageX:u,pageY:a}=d;if(u===S.current.x&&a===S.current.y)t!=="selection"&&l.popDrawData(),D.current?D.current==="move"?l.addOperateStack({type:"MOVE",selectedIds:l.data.filter(f=>f.isSelected).map(f=>f.id),payload:{x:u-I.current.x,y:a-I.current.y}}):l.addOperateStack({type:"RESIZE",payload:X.current}):c.current=!1;else{if(t!=="selection"){const f=l.data[l.data.length-1];f.isSelected=!0,l.addOperateStack({type:"ADD",selectedIds:[f.id]}),n("selection")}else l.popDrawData();z()}if(t==="selection"&&!D.current&&!g.current){B();const f=Te({x:u,y:a});f?l.data.find(h=>h.id===f).isSelected=!0:s(L.default),z()}qe(),l.storageDrawData()},w.exports.useEffect(()=>{const d=f=>{var h;(h=ee.current)==null||h.call(ee,f)},u=f=>{var h;(h=Q.current)==null||h.call(Q,f)},a=f=>{var h;(h=te.current)==null||h.call(te,f)};return document.addEventListener("mousedown",u),document.addEventListener("mousemove",d),document.addEventListener("mouseup",a),()=>{document.removeEventListener("mousedown",u),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",a)}},[])},qt=()=>{const{drawType:e,setDrawType:t}=w.exports.useContext(be);Je(g=>{const c=+g-1;!isNaN(c)&&c!==-1&&c<we.length&&t(we[c].type)});const n=(g,c)=>A("div",{className:H["tool-item"],onClick:c,children:A(g,k({},Ce))}),r=()=>{C.emit("clear")},s=()=>{C.emit("import")},o=()=>{C.emit("exportData")},i=()=>{C.emit("exportImage")};return ie(ht,{children:[A("div",{className:ge(H.container,H.element),children:we.map(({Icon:g,type:c},p)=>A(Jt,{isActive:c===e,Icon:A(g,k({},Ce)),index:p+1,changeType:()=>t(c)},p))}),ie("div",{className:ge(H.container,H.operate),children:[n(wt,r),n(pt,s),n(yt,o),n(gt,i)]})]})};function Qt(){const e=w.exports.useRef(null),t=w.exports.useRef(null),{cursorType:n}=w.exports.useContext(Le);return w.exports.useEffect(()=>{e.current&&(t.current=e.current.getContext("2d"))},[]),$t(t),Kt(e,t),ie("div",{className:"App",style:{position:"relative",cursor:n},children:[A(qt,{}),A("canvas",{ref:e,id:"canvas"})]})}mt.render(A(xt.StrictMode,{children:A(Vt,{children:A(Zt,{children:A(Qt,{})})})}),document.getElementById("root"));
