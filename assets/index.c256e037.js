var Ze=Object.defineProperty,$e=Object.defineProperties;var qe=Object.getOwnPropertyDescriptors;var Ie=Object.getOwnPropertySymbols;var Qe=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable;var pe=(e,t,r)=>t in e?Ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,X=(e,t)=>{for(var r in t||(t={}))Qe.call(t,r)&&pe(e,r,t[r]);if(Ie)for(var r of Ie(t))Ve.call(t,r)&&pe(e,r,t[r]);return e},re=(e,t)=>$e(e,qe(t));var Me=(e,t,r)=>(pe(e,typeof t!="symbol"?t+"":t,r),r),he=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var ne=(e,t,r)=>(he(e,t,"read from private field"),r?r.call(e):t.get(e)),ye=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},ze=(e,t,r,o)=>(he(e,t,"write to private field"),o?o.call(e,r):t.set(e,r),r);var Ae=(e,t,r)=>(he(e,t,"access private method"),r);import{C as et,R as tt,a as rt,D as nt,F as ot,A as st,m as at,j as oe,c as ge,b as I,r as h,n as se,d as it,L as ct,E as lt,e as ut,f as dt,g as ft,h as pt}from"./vendor.8922c5b7.js";const ht=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}};ht();const _e={theme:"outline",size:"20",fill:"#333"},me=[{type:"selection",Icon:et},{type:"rectangle",Icon:tt},{type:"circle",Icon:rt},{type:"diamond",Icon:nt},{type:"text",Icon:ot},{type:"arrow",Icon:st}],we="emodraw",Oe="Segoe UI Emoji",ae=15,yt="#fff",v={default:"default",crosshair:"crosshair",move:"move",grab:"grab",neswResize:"nesw-resize",nwseResize:"nwse-resize"},gt=30,Y=3,H=8,mt=[15,10],Ce=20,ie=30,wt="emodraw.png",xt="emodraw",j=(e,t,r,o,n)=>{e.beginPath(),e.moveTo(t,r),e.lineTo(t+o,r),e.lineTo(t+o,r+n),e.lineTo(t,r+n),e.closePath(),e.stroke()},Dt=(e,t,r,o,n)=>{e.save(),e.fillStyle="rgba(255,165,0,0.5)",e.fillRect(t,r,o,n),e.restore()},St=(e,t,r,o,n)=>{const s=o>n?1/o:1/n;e.beginPath(),e.moveTo(t+o,r);for(let a=0;a<Math.PI*2;a+=s)e.lineTo(t+o*Math.cos(a),r+n*Math.sin(a));e.closePath(),e.stroke()},Tt=(e,t,r,o,n)=>{e.beginPath(),e.moveTo(t+o/2,r+n),e.lineTo(t+o,r+n/2),e.lineTo(t+o/2,r),e.lineTo(t,r+n/2),e.closePath(),e.stroke()},Et=(e,t)=>Math.floor(180/(Math.PI/Math.atan(e/t))),Pe=30,Rt=(e,t,r,o,n)=>{const s=Math.min(Math.pow(o*o+n*n,1/2)/2,gt),a=n<0?-s:s,g=Et(o,n),d=g+Pe,m=g-Pe,w=t+o,T=r+n,R=w-a*Math.sin(Math.PI*d/180),D=T-a*Math.cos(Math.PI*d/180),M=w-a*Math.sin(Math.PI*m/180),b=T-a*Math.cos(Math.PI*m/180);e.beginPath(),e.moveTo(t,r),e.lineTo(w,T),e.lineTo(R,D),e.moveTo(w,T),e.lineTo(M,b),e.stroke()},vt=(e,t)=>{const{type:r,x:o,y:n,width:s,height:a}=t;switch(r){case"rectangle":j(e,o,n,s,a);return;case"circle":St(e,o+s/2,n+a/2,Math.abs(s/2),Math.abs(a/2));return;case"arrow":Rt(e,o,n,s,a);return;case"diamond":Tt(e,o,n,s,a);return;case"selection":Dt(e,o,n,s,a);return}},Lt=(e,t)=>{const{content:r,x:o,y:n}=t;e.textBaseline="bottom",e.font=`${ae}px  ${Oe}`,Ye(r).forEach((s,a)=>{e.fillText(s,o,n+ae*(a+1))})},Ne=(e,{x:t,y:r,width:o,height:n,type:s},a)=>{const g=o>0?Y:-Y,d=n>0?Y:-Y,m=t-g,w=t+o+g,T=r-d,R=r+n+d;if(e.setLineDash(mt),e.beginPath(),e.moveTo(m,T),e.lineTo(w,T),e.lineTo(w,R),e.lineTo(m,R),e.closePath(),e.stroke(),e.setLineDash([]),!a){const D=o>0?H:-H,M=n>0?H:-H;s!=="text"&&(j(e,m,T,-D,-M),j(e,w,R,D,M),s!=="arrow"&&(j(e,w,T,D,-M),j(e,m,R,-D,M)))}},bt=e=>{const t=u.getSelectionData();if(!t)return;const[r,o,n,s]=t;Ne(e,{x:r,y:n,width:o-r,height:s-n,type:"selection"},!1)},xe=(e,t=u.data)=>{let r=!1;u.data.filter(n=>n.isSelected).length>1&&(bt(e),r=!0),t.forEach(n=>{n.isSelected&&Ne(e,n,r),n.type==="text"?Lt(e,n):vt(e,n)})};var W,ce,Mt;class It{constructor(){ye(this,ce);Me(this,"data");ye(this,W,void 0);this.data=Ae(this,ce,Mt).call(this),ze(this,W,[])}addOperateStack(t){ne(this,W).push(t)}getSelectionData(){const t=this.data.filter(r=>r.isSelected);if(t.length===1&&t[0].type==="text")return null;if(t.length===1&&t[0].type==="arrow"){const r=t[0];return[r.x,r.x+r.width,r.y,r.y+r.height,!0]}return[...Te(t),!1]}addDrawData(t){this.data.push(t)}popDrawData(){this.data.pop()}revokeDrawData(){if(ne(this,W).length>0){const t=ne(this,W).pop();if(t.type==="DELETE"&&this.data.push(...t.payload),t.type==="ADD"&&(this.data=this.data.filter(r=>t.selectedIds!==r.id)),t.type==="MOVE"){const{x:r,y:o}=t.payload;this.data.forEach(n=>n.isSelected=!1),this.data.filter(n=>t.selectedIds.includes(n.id)).forEach(n=>{n.x-=r,n.y-=o,n.isSelected=!0})}if(t.type==="RESIZE"){const r=t.payload,o=r.map(n=>n.id);this.data=this.data.filter(n=>!o.includes(n.id)).concat(r)}t.type==="SET"&&(this.data=t.payload),this.storageDrawData()}}storageDrawData(){this.data=this.data.filter(t=>t.type!=="selection").map(t=>{if(t.type==="arrow")return t;const r=X({},t);return r.width<0&&(r.x=r.x+r.width,r.width=-r.width),r.height<0&&(r.y=r.y+r.height,r.height=-r.height),r}),localStorage.setItem(we,JSON.stringify(this.data))}delete(){const t=[];this.data=this.data.filter(r=>r.isSelected?(t.push(re(X({},r),{isSelected:!1})),!1):!0),this.addOperateStack({type:"DELETE",payload:t}),this.storageDrawData()}}W=new WeakMap,ce=new WeakSet,Mt=function(){let t;try{t=JSON.parse(localStorage.getItem(we))||[]}catch{t=[],localStorage.setItem(we,"[]")}return t};var u=new It;const zt=({x:e,y:t},r,o)=>{if(document.querySelector("textarea"))return;const s=document.createElement("textarea");Object.assign(s.style,{position:"absolute",margin:0,padding:0,border:0,outline:0,background:"transparent",resize:"none",top:t+"px",left:e+"px",fontSize:ae+"px",lineHeight:"1em",fontFamily:Oe,width:`${window.innerWidth-e}px`,whiteSpace:"nowrap",overflowX:"hidden"}),o&&(s.value=o,s.setSelectionRange(0,o.length)),s.onkeydown=a=>{a.stopPropagation()},s.oninput=()=>{s.style.height=s.scrollHeight+"px"},s.onblur=a=>{r(a.target.value),document.body.removeChild(s)},document.body.appendChild(s),setTimeout(()=>{s.focus()})},_=5,At=e=>e>_?e-_:0,B=e=>e+_<window.innerWidth?e+_:window.innerWidth,J=e=>e+_<window.innerWidth?e+_:window.innerWidth,k=(e,t,r)=>e>=At(t)&&e<=r,De=(e,t,r,o)=>Math.pow(Math.pow(Math.abs(e-t),2)+Math.pow(Math.abs(r-o),2),1/2),Se=({x:e,y:t})=>{for(let r=0;r<u.data.length;r++){const o=u.data[r],n=o.x,s=o.x+o.width,a=o.y,g=o.y+o.height;if(o.isSelected){const d=o.width>0?s:n,m=o.width>0?n:s,w=o.height>0?g:a,T=o.height>0?a:g;if(e>=m&&e<=d&&t>=T&&t<=w)return o.id}if(o.type==="text"&&k(e,n,B(s))&&k(t,a,J(g))||o.type==="rectangle"&&((k(e,n,B(n))||k(e,s,B(s)))&&k(t,a,J(g))||(k(t,a,J(a))||k(t,g,J(g)))&&k(e,n,B(s))))return o.id;if(o.type==="diamond"){const d=o.width*o.height,m=Math.abs(e-(n+o.width/2)),w=Math.abs(t-(a+o.height/2)),T=((m+_)*o.height+(w+_)*o.width)*2,R=((m-_)*o.height+(w-_)*o.width)*2;if(T>=d&&R<=d)return o.id}if(o.type==="circle"){const d=n+o.width/2,m=a+o.height/2,w=Math.abs(o.width/2),T=Math.abs(o.height/2),R=w>T?1/w:1/T;for(let D=0;D<Math.PI*2;D+=R){const M=Math.round(d+w*Math.cos(D)),b=Math.round(m+T*Math.sin(D));if(k(e,M,B(M))&&k(t,b,J(b)))return o.id}}if(o.type==="arrow"){const d=Math.round(De(n,s,a,g)),m=Math.round(De(e,n,t,a)+De(e,s,t,g));if(m>=d-_/2&&m<=d+_/2)return o.id}}return null},_t=(e,t,r,o)=>{const[n,s]=r>0?[e+r,e]:[e,e+r],[a,g]=o>0?[t+o,t]:[t,t+o];return u.data.filter(d=>{if(d.type==="selection")return!1;const[m,w]=d.width>0?[d.x+d.width,d.x]:[d.x,d.x+d.width],[T,R]=d.height>0?[d.y+d.height,d.y]:[d.y,d.y+d.height];return n>=m&&s<=w&&a>=T&&g<=R}).map(({id:d})=>d)},ke=(e,t)=>{const r=u.getSelectionData();if(!r)return!1;const[o,n,s,a]=r;return e<=o&&e>=n&&t<=s&&t>=a},S=(e,t,r)=>r?e>=t+Y&&e<=t+H+Y:e<=t-Y&&e>=t-H-Y,Xe=({x:e,y:t})=>{const r=u.getSelectionData();if(!r)return null;const[o,n,s,a,g]=r;if(g){if(o>=n&&s>a){if(S(e,n,!1)&&S(t,a,!1))return[v.nwseResize,"top"];if(S(e,o,!0)&&S(t,s,!0))return[v.nwseResize,"bottom"]}else if(o>=n&&s<a){if(S(e,n,!1)&&S(t,a,!0))return[v.neswResize,"bottom"];if(S(e,o,!0)&&S(t,s,!1))return[v.neswResize,"top"]}else if(o<n&&s>a){if(S(e,n,!0)&&S(t,a,!1))return[v.neswResize,"top"];if(S(e,o,!1)&&S(t,s,!0))return[v.neswResize,"bottom"]}else{if(S(e,o,!1)&&S(t,s,!1))return[v.nwseResize,"top"];if(S(e,n,!0)&&S(t,a,!0))return[v.nwseResize,"bottom"]}return null}return S(e,n,!1)&&S(t,a,!1)?[v.nwseResize,"top"]:S(e,o,!0)&&S(t,s,!0)?[v.nwseResize,"bottom"]:S(e,n,!1)&&S(t,s,!0)?[v.neswResize,"bottom"]:S(e,o,!0)&&S(t,a,!1)?[v.neswResize,"top"]:null},Ot=({x:e,y:t})=>{const r=u.data.filter(o=>o.type==="text");for(let o=0;o<r.length;o++){const n=r[o];if(e>=n.x&&e<=n.x+n.width&&t>=n.y&&t<=n.y+n.height)return n}return null},Te=e=>{let t=-1/0,r=-1/0,o=1/0,n=1/0;return e.forEach(s=>{const[a,g]=s.width>0?[s.x+s.width,s.x]:[s.x,s.x+s.width],[d,m]=s.height>0?[s.y+s.height,s.y]:[s.y,s.y+s.height];a>t&&(t=a),d>r&&(r=d),g<o&&(o=g),m<n&&(n=m)}),[t,o,r,n]},Ye=e=>e.replace(/\r\n?/g,`
`).split(`
`).filter(t=>!!t.trim()),Ct=e=>{const t="\uFEFF",r=new Blob([t+e],{type:"text/json"});return URL.createObjectURL(r)},Fe=(e,t)=>{const r=document.createElement("a");r.download=t,r.href=e,document.body.appendChild(r),r.click(),document.body.removeChild(r)};var O=at();const Pt="_container_1dwzc_1",Nt="_element_1dwzc_10",kt="_operate_1dwzc_14",Xt="_active_1dwzc_30";var F={container:Pt,element:Nt,operate:kt,"tool-item":"_tool-item_1dwzc_17",active:Xt,"tool-index":"_tool-index_1dwzc_33"};const Yt=({Icon:e,index:t,changeType:r,isActive:o})=>oe("div",{className:ge(F["tool-item"],{[F.active]:o}),onClick:r,children:[I("div",{children:e}),I("div",{className:F["tool-index"],children:t})]}),Ft=(e,t)=>{h.exports.useEffect(()=>{const r=()=>{!e.current||!t.current||(e.current.width=window.innerWidth,e.current.height=window.innerHeight,xe(t.current))};return r(),window.addEventListener("resize",r),()=>document.removeEventListener("resize",r)},[])},We=e=>{h.exports.useEffect(()=>{const t=r=>{const{key:o,metaKey:n}=r;e(o,n)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[])},Ee=h.exports.createContext({}),Wt=({children:e})=>{const[t,r]=h.exports.useState("selection");return I(Ee.Provider,{value:{drawType:t,setDrawType:r},children:e})},Re=h.exports.createContext({}),Ht=({children:e})=>{const[t,r]=h.exports.useState(v.default);return I(Re.Provider,{value:{cursorType:t,setCursorType:r},children:e})},Gt=(e,t)=>{const{drawType:r,setDrawType:o}=h.exports.useContext(Ee),{cursorType:n,setCursorType:s}=h.exports.useContext(Re),a=h.exports.useRef(!1),g=h.exports.useRef(!1),d=h.exports.useRef(!1),m=h.exports.useRef(!1),w=h.exports.useRef(),T=h.exports.useRef(),R=h.exports.useRef(),D=h.exports.useRef({x:0,y:0}),M=h.exports.useRef({x:0,y:0}),b=h.exports.useRef({x:0,y:0}),le=h.exports.useRef([]),K=h.exports.useRef([]),ue=h.exports.useRef({x:0,y:0}),de=h.exports.useRef(!1),A=()=>{e.current&&(e.current.clearRect(0,0,window.innerWidth,window.innerHeight),xe(e.current))},G=()=>{u.data.forEach(c=>c.isSelected=!1)};h.exports.useEffect(()=>{const c=()=>{u.addOperateStack({type:"DELETE",payload:u.data}),u.data=[],u.storageDrawData(),A()},l=()=>{if(u.data.length===0)return;const p=document.createElement("canvas"),[y,x,E,L]=Te(u.data),C=y-x+ie,z=E-L+ie;p.width=C,p.height=z;const P=p.getContext("2d");P.save(),P.fillStyle=yt,P.fillRect(0,0,C,z),P.restore(),xe(P,u.data.map(U=>re(X({},U),{x:U.x-x+ie/2,y:U.y-L+ie/2})));const V=p.toDataURL();Fe(V,wt)},i=()=>{if(u.data.length===0)return;const p=Ct(JSON.stringify(u.data));Fe(p,xt)},f=()=>{const p=document.createElement("input");p.type="file",document.body.appendChild(p),p.click(),p.onchange=y=>{const E=y.target.files[0],L=new FileReader;L.onload=C=>{try{const z=JSON.parse(C.target.result);u.addOperateStack({type:"SET",payload:u.data}),u.data=z,u.storageDrawData(),A()}catch{}},L.readAsText(E),document.body.removeChild(p)}};return O.on("exportImage",l),O.on("exportData",i),O.on("clear",c),O.on("import",f),()=>{O.off("import",f),O.off("exportData",i),O.off("exportImage",l),O.off("clear",c)}},[]),h.exports.useEffect(()=>{const c=()=>{K.current=u.data.filter(i=>i.isSelected)},l=()=>{if(K.current.length>0&&!de.current){const[i,f,p,y]=Te(K.current),[x,E]=[(i+f)/2,(p+y)/2],[L,C]=[ue.current.x-x,ue.current.y-E];G(),K.current.forEach(z=>{u.addDrawData(re(X({},z),{id:se(),x:z.x+L,y:z.y+C,isSelected:!0}))}),u.storageDrawData(),A()}};return document.addEventListener("copy",c),document.addEventListener("paste",l),()=>{document.removeEventListener("copy",c),document.addEventListener("paste",l)}},[]);const He=(c,l,i)=>{c.type==="arrow"?T.current==="head"?(c.width+=l,c.height+=i):(c.x+=l,c.y+=i,c.width-=l,c.height-=i):n==="nesw-resize"?w.current==="top"?(c.y+=i,c.width+=l,c.height-=i):(c.height+=i,c.x+=l,c.width-=l):n==="nwse-resize"&&(w.current==="top"?(c.x+=l,c.y+=i,c.width-=l,c.height-=i):(c.width+=l,c.height+=i))},Ge=(c,l,i)=>{const{x:f,y:p}=M.current,y={x:0,y:0},x=l-f,E=i-p,L=u.getSelectionData(),C=L[0]-L[1],z=L[2]-L[3],P=w.current==="top",V=P&&n==="nesw-resize"||w.current==="bottom"&&n==="nwse-resize",U=w.current==="bottom"&&n==="nesw-resize"||P&&n==="nwse-resize";if(C<=Ce&&(x<=b.current.x&&V||x>=b.current.x&&U)||z<=Ce&&(E<=b.current.y&&w.current==="bottom"||E>=b.current.y&&P))return;let ee=0,te=0;const ve=Math.abs(x)>Math.abs(E);ee=ve?n==="nesw-resize"?-E:E:x,te=ve?E:n==="nesw-resize"?-x:x,y.x=L[V?1:0],y.y=L[P?2:3],c.forEach(N=>{const Le=Math.abs(N.x-y.x)/C,Je=Math.abs(N.x+N.width-y.x)/C,be=Math.abs(N.y-y.y)/z,Ke=Math.abs(N.y+N.height-y.y)/z;N.x+=(ee-b.current.x)*Le,N.y+=(te-b.current.y)*be,N.width+=(ee-b.current.x)*(Je-Le),N.height+=(te-b.current.y)*(Ke-be)}),b.current={x:ee,y:te}},Ue=(c,l,i)=>{c.length===1?He(c[0],l-D.current.x,i-D.current.y):Ge(c,l,i)},je=(c,l,i)=>{c.forEach(f=>{f.x+=l,f.y+=i})},fe=({x:c,y:l},i)=>{de.current=!0,zt({x:c,y:l},f=>{if(de.current=!1,f.trim()){const p=Ye(f);let y=0;p.forEach(E=>{if(e.current){const{width:L}=e.current.measureText(E);L>y&&(y=L)}});const x=se();u.addDrawData({type:"text",id:x,x:c,y:l,content:f,width:Math.floor(y),height:p.length*ae,isSelected:!1}),u.addOperateStack({type:"ADD",selectedIds:x}),u.storageDrawData(),A()}},i)},Z=h.exports.useRef();Z.current=(c,l)=>{if(r==="selection"){const i=Ot({x:c,y:l});G(),i?(u.data=u.data.filter(f=>f.id!==i.id),fe({x:i.x,y:i.y},i.content)):fe({x:c,y:l}),A()}},h.exports.useEffect(()=>{const c=({pageX:l,pageY:i})=>{var f;(f=Z.current)==null||f.call(Z,l,i)};return document.addEventListener("dblclick",c),()=>document.removeEventListener("dblclick",c)},[]),h.exports.useEffect(()=>{s(r==="selection"?v.default:v.crosshair),r!=="selection"&&G()},[r]),We((c,l)=>{l&&c==="z"&&(u.revokeDrawData(),A()),l&&c==="a"&&(u.data.forEach(i=>i.isSelected=!0),u.data.length>1&&(m.current=!0),u.storageDrawData(),A()),c==="Backspace"&&(u.delete(),A())});const Be=()=>{R.current=void 0,d.current=!1,b.current={x:0,y:0},le.current=[]},$=h.exports.useRef();$.current=c=>{if(c.button===2)return;const{pageX:l,pageY:i}=c;if(D.current=M.current={x:l,y:i},r==="text")o("selection"),fe({x:l,y:i});else if(r==="selection"){if(a.current=!0,m.current&&ke(l,i)){g.current=!0;return}const f=Xe({x:l,y:i});if(f){w.current=f[1],g.current=!0;const y=u.data.filter(x=>x.isSelected);if(le.current=y.map(x=>X({},x)),y.length===1&&y[0].type==="arrow"){const x=y[0];T.current=x.height<=0&&w.current==="top"||x.height>0&&w.current==="bottom"?"head":"foot"}return}const p=Se({x:l,y:i});G(),g.current=!1,p?(u.data.find(y=>y.id===p).isSelected=!0,g.current=!0,u.storageDrawData()):(u.addDrawData({type:r,id:se(),x:l,y:i,width:0,height:0,isSelected:!1}),A())}else a.current=!0,u.addDrawData({type:r,id:se(),x:l,y:i,width:0,height:0,isSelected:!1})};const q=h.exports.useRef();q.current=c=>{const{pageX:l,pageY:i}=c;if(ue.current={x:l,y:i},!a.current){const y=Xe({x:l,y:i});if(y){s(y[0]);return}if(r==="selection"){const x=m.current?ke(l,i):Se({x:l,y:i});s(x?v.move:v.default)}return}const f=l-D.current.x,p=i-D.current.y;if(r==="selection"&&g.current){const y=u.data.filter(E=>E.isSelected),x=["nesw-resize","nwse-resize"].includes(n);x?Ue(y,l,i):je(y,f,p),(l!==D.current.x||i!==D.current.y)&&(R.current=x?"resize":"move",D.current={x:l,y:i})}else{const y=u.data[u.data.length-1];if(y.type!=="text"&&(y.width=f,y.height=p),y.type==="selection"){d.current=!0;const x=_t(D.current.x,D.current.y,f,p);m.current=x.length>1,u.data.forEach(E=>{E.isSelected=x.includes(E.id)})}}A()};const Q=h.exports.useRef();Q.current=c=>{if(!a.current)return;a.current=!1;const{pageX:l,pageY:i}=c;if(l===D.current.x&&i===D.current.y)r!=="selection"&&u.popDrawData(),R.current?R.current==="move"?u.addOperateStack({type:"MOVE",selectedIds:u.data.filter(f=>f.isSelected).map(f=>f.id),payload:{x:l-M.current.x,y:i-M.current.y}}):u.addOperateStack({type:"RESIZE",payload:le.current}):m.current=!1;else{if(r!=="selection"){const f=u.data[u.data.length-1];f.isSelected=!0,u.addOperateStack({type:"ADD",selectedIds:f.id}),o("selection")}else u.popDrawData();A()}if(r==="selection"&&!R.current&&!d.current){G();const f=Se({x:l,y:i});f?u.data.find(p=>p.id===f).isSelected=!0:s(v.default),A()}Be(),u.storageDrawData()},h.exports.useEffect(()=>{const c=f=>{var p;(p=q.current)==null||p.call(q,f)},l=f=>{var p;(p=$.current)==null||p.call($,f)},i=f=>{var p;(p=Q.current)==null||p.call(Q,f)};return document.addEventListener("mousedown",l),document.addEventListener("mousemove",c),document.addEventListener("mouseup",i),()=>{document.removeEventListener("mousedown",l),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",i)}},[])},Ut=()=>{const{drawType:e,setDrawType:t}=h.exports.useContext(Ee);We(g=>{const d=+g-1;!isNaN(d)&&d!==-1&&d<me.length&&t(me[d].type)});const r=(g,d)=>I("div",{className:F["tool-item"],onClick:d,children:I(g,X({},_e))}),o=()=>{O.emit("clear")},n=()=>{O.emit("import")},s=()=>{O.emit("exportData")},a=()=>{O.emit("exportImage")};return oe(it,{children:[I("div",{className:ge(F.container,F.element),children:me.map(({Icon:g,type:d},m)=>I(Yt,{isActive:d===e,Icon:I(g,X({},_e)),index:m+1,changeType:()=>t(d)},m))}),oe("div",{className:ge(F.container,F.operate),children:[r(dt,o),r(ct,n),r(lt,s),r(ut,a)]})]})};function jt(){const e=h.exports.useRef(null),t=h.exports.useRef(null),{cursorType:r}=h.exports.useContext(Re);return h.exports.useEffect(()=>{e.current&&(t.current=e.current.getContext("2d"))},[]),Gt(t),Ft(e,t),oe("div",{className:"App",style:{position:"relative",cursor:r},children:[I(Ut,{}),I("canvas",{ref:e,id:"canvas"})]})}ft.render(I(pt.StrictMode,{children:I(Wt,{children:I(Ht,{children:I(jt,{})})})}),document.getElementById("root"));
