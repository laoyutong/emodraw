var V=Object.defineProperty;var C=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var _=(e,t,r)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,F=(e,t)=>{for(var r in t||(t={}))$.call(t,r)&&_(e,r,t[r]);if(C)for(var r of C(t))Z.call(t,r)&&_(e,r,t[r]);return e};var W=(e,t,r)=>(_(e,typeof t!="symbol"?t+"":t,r),r);import{C as Q,R as ee,a as te,D as ne,F as oe,A as re,j as H,c as se,b as D,r as g,n as P,d as ie,e as ae}from"./vendor.779914d6.js";const ce=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}};ce();const le={theme:"outline",size:"20",fill:"#333"},z=[{type:"selection",Icon:Q},{type:"rectangle",Icon:ee},{type:"circle",Icon:te},{type:"diamond",Icon:ne},{type:"text",Icon:oe},{type:"arrow",Icon:re}],ue="_container_zx2b4_1",de="_active_zx2b4_25";var b={container:ue,"tool-item":"_tool-item_zx2b4_12",active:de,"tool-index":"_tool-index_zx2b4_28"};const fe=({Icon:e,index:t,changeType:r,isActive:n})=>H("div",{className:se(b["tool-item"],{[b.active]:n}),onClick:r,children:[D("div",{className:b["tool-icon"],children:e}),D("div",{className:b["tool-index"],children:t})]}),Y="emodraw",j="Segoe UI Emoji",A=15,M={default:"default",crosshair:"crosshair",move:"move",grab:"grab",neswResize:"nesw-resize",nwseResize:"nwse-resize",ewResize:"ew-resize",nsResize:"ns-resize"},he=30,L=(e,t,r,n,o)=>{e.beginPath(),e.moveTo(t,r),e.lineTo(t+n,r),e.lineTo(t+n,r+o),e.lineTo(t,r+o),e.closePath(),e.stroke()},pe=(e,t,r,n,o)=>{e.save(),e.fillStyle="rgba(255,165,0,0.5)",e.fillRect(t,r,n,o),e.restore()},me=(e,t,r,n,o)=>{const s=n>o?1/n:1/o;e.beginPath(),e.moveTo(t+n,r);for(let i=0;i<Math.PI*2;i+=s)e.lineTo(t+n*Math.cos(i),r+o*Math.sin(i));e.closePath(),e.stroke()},ge=(e,t,r,n,o)=>{e.beginPath(),e.moveTo(t+n/2,r+o),e.lineTo(t+n,r+o/2),e.lineTo(t+n/2,r),e.lineTo(t,r+o/2),e.closePath(),e.stroke()},we=(e,t)=>Math.floor(180/(Math.PI/Math.atan(e/t))),B=30,ye=(e,t,r,n,o)=>{const s=Math.min(Math.pow(n*n+o*o,1/2)/2,he),i=o<0?-s:s,h=we(n,o),a=h+B,l=h-B,d=t+n,c=r+o,w=d-i*Math.sin(Math.PI*a/180),f=c-i*Math.cos(Math.PI*a/180),p=d-i*Math.sin(Math.PI*l/180),m=c-i*Math.cos(Math.PI*l/180);e.beginPath(),e.moveTo(t,r),e.lineTo(d,c),e.lineTo(w,f),e.moveTo(d,c),e.lineTo(p,m),e.stroke()},De=(e,t)=>{const{type:r,x:n,y:o,width:s,height:i}=t;switch(r){case"rectangle":L(e,n,o,s,i);return;case"circle":me(e,n+s/2,o+i/2,Math.abs(s/2),Math.abs(i/2));return;case"arrow":ye(e,n,o,s,i);return;case"diamond":ge(e,n,o,s,i);return;case"selection":pe(e,n,o,s,i);return}},Te=(e,t)=>{const{content:r,x:n,y:o}=t;e.textBaseline="bottom",e.font=`${A}px  ${j}`,q(r).forEach((s,i)=>{e.fillText(s,n,o+A*(i+1))})},G=(e,{x:t,y:r,width:n,height:o},s)=>{const i=5,h=8,a=n>0?i:-i,l=o>0?i:-i,d=t-a,c=t+n+a,w=r-l,f=r+o+l;if(e.setLineDash([15,10]),e.beginPath(),e.moveTo(d,w),e.lineTo(c,w),e.lineTo(c,f),e.lineTo(d,f),e.closePath(),e.stroke(),e.setLineDash([]),!s){const p=n>0?h:-h,m=o>0?h:-h;L(e,d,w,-p,-m),L(e,c,w,p,-m),L(e,c,f,p,m),L(e,d,f,-p,m)}},Se=e=>{const[t,r,n,o]=u.getSelectionData();G(e,{x:t,y:n,width:r-t,height:o-n},!1)},K=e=>{let t=!1;u.data.filter(n=>n.isSelected).length>1&&(Se(e),t=!0),u.data.forEach(n=>{n.isSelected&&G(e,n,t),n.type==="text"?Te(e,n):De(e,n)})};class ve{constructor(){W(this,"data");this.data=this._getStorageData()}_getStorageData(){let t;try{t=JSON.parse(localStorage.getItem(Y))||[]}catch{t=[],localStorage.setItem(Y,"[]")}return t}getSelectionData(){let t=-1/0,r=-1/0,n=1/0,o=1/0;return this.data.filter(s=>s.isSelected).forEach(s=>{const[i,h]=s.width>0?[s.x+s.width,s.x]:[s.x,s.x+s.width],[a,l]=s.height>0?[s.y+s.height,s.y]:[s.y,s.y+s.height];i>t&&(t=i),a>r&&(r=a),h<n&&(n=h),l<o&&(o=l)}),[t,n,r,o]}addDrawData(t){this.data.push(t)}revokeDrawData(){this.data.pop()}storageDrawData(){localStorage.setItem(Y,JSON.stringify(this.data))}delete(){this.data=this.data.filter(t=>!t.isSelected),this.storageDrawData()}}var u=new ve;const xe=({x:e,y:t},r)=>{if(document.querySelector("textarea"))return;const o=document.createElement("textarea");Object.assign(o.style,{position:"absolute",margin:0,padding:0,border:0,outline:0,background:"transparent",resize:"none",top:t+"px",left:e+"px",fontSize:A+"px",lineHeight:"1em",fontFamily:j}),o.onkeydown=s=>{s.stopPropagation()},o.oninput=()=>{o.style.height=o.scrollHeight+"px"},o.onblur=()=>{document.body.removeChild(o)},o.onchange=s=>{r(s.target.value)},document.body.appendChild(o),setTimeout(()=>{o.focus()})},T=5,Me=e=>e>T?e-T:0,R=e=>e+T<window.innerWidth?e+T:window.innerWidth,I=e=>e+T<window.innerWidth?e+T:window.innerWidth,x=(e,t,r)=>e>=Me(t)&&e<=r,k=(e,t,r,n)=>Math.pow(Math.pow(Math.abs(e-t),2)+Math.pow(Math.abs(r-n),2),1/2),O=({x:e,y:t})=>{for(let r=0;r<u.data.length;r++){const n=u.data[r],o=n.x,s=n.x+n.width,i=n.y,h=n.y+n.height;if(n.isSelected){const a=n.width>0?s:o,l=n.width>0?o:s,d=n.height>0?h:i,c=n.height>0?i:h;if(e>=l&&e<=a&&t>=c&&t<=d)return n.id}if(n.type==="text"&&x(e,o,R(s))&&x(t,i,I(h))||n.type==="rectangle"&&((x(e,o,R(o))||x(e,s,R(s)))&&x(t,i,I(h))||(x(t,i,I(i))||x(t,h,I(h)))&&x(e,o,R(s))))return n.id;if(n.type==="diamond"){const a=n.width*n.height,l=Math.abs(e-(o+n.width/2)),d=Math.abs(t-(i+n.height/2)),c=((l+T)*n.height+(d+T)*n.width)*2,w=((l-T)*n.height+(d-T)*n.width)*2;if(c>=a&&w<=a)return n.id}if(n.type==="circle"){const a=o+n.width/2,l=i+n.height/2,d=Math.abs(n.width/2),c=Math.abs(n.height/2),w=d>c?1/d:1/c;for(let f=0;f<Math.PI*2;f+=w){const p=Math.round(a+d*Math.cos(f)),m=Math.round(l+c*Math.sin(f));if(x(e,p,R(p))&&x(t,m,I(m)))return n.id}}if(n.type==="arrow"){const a=Math.round(k(o,s,i,h)),l=Math.round(k(e,o,t,i)+k(e,s,t,h));if(l>=a-T/2&&l<=a+T/2)return n.id}}return null},Ee=(e,t,r,n)=>{const[o,s]=r>0?[e+r,e]:[e,e+r],[i,h]=n>0?[t+n,t]:[t,t+n];return u.data.filter(a=>{if(a.type==="selection")return!1;const[l,d]=a.width>0?[a.x+a.width,a.x]:[a.x,a.x+a.width],[c,w]=a.height>0?[a.y+a.height,a.y]:[a.y,a.y+a.height];return o>=l&&s<=d&&i>=c&&h<=w}).map(({id:a})=>a)},U=(e,t)=>{const[r,n,o,s]=u.getSelectionData();return e<=r&&e>=n&&t<=o&&t>=s},q=e=>e.replace(/\r\n?/g,`
`).split(`
`),be=(e,t)=>{g.exports.useEffect(()=>{const r=()=>{!e.current||!t.current||(e.current.width=window.innerWidth,e.current.height=window.innerHeight,K(t.current))};return r(),window.addEventListener("resize",r),()=>document.removeEventListener("resize",r)},[])},J=e=>{g.exports.useEffect(()=>{const t=r=>{const{key:n,metaKey:o}=r;e(n,o)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[])},N=g.exports.createContext({}),Le=({children:e})=>{const[t,r]=g.exports.useState("selection");return D(N.Provider,{value:{drawType:t,setDrawType:r},children:e})},X=g.exports.createContext({}),Re=({children:e})=>{const[t,r]=g.exports.useState(M.default);return D(X.Provider,{value:{cursorType:t,setCursorType:r},children:e})},Ie=e=>{const{drawType:t,setDrawType:r}=g.exports.useContext(N),{setCursorType:n}=g.exports.useContext(X),o=g.exports.useRef(!1),s=g.exports.useRef(!1),i=g.exports.useRef(!1),h=g.exports.useRef(!1),a=g.exports.useRef(!1),l=g.exports.useRef({x:0,y:0}),d=()=>{e.current&&(e.current.clearRect(0,0,window.innerWidth,window.innerHeight),K(e.current))};g.exports.useEffect(()=>{n(t==="selection"?M.default:M.crosshair),t!=="selection"&&u.data.forEach(c=>c.isSelected=!1)},[t]),J((c,w)=>{w&&c==="z"&&(u.revokeDrawData(),u.storageDrawData(),d()),c==="Backspace"&&(u.delete(),d())}),g.exports.useEffect(()=>{const c=w=>{const{offsetX:f,offsetY:p}=w;if(l.current={x:f,y:p},t==="text")r("selection"),xe(l.current,m=>{if(m.trim()){const y=q(m);let S=0;y.forEach(v=>{if(e.current){const{width:E}=e.current.measureText(v);E>S&&(S=E)}}),u.addDrawData({type:t,id:P(),x:f,y:p,content:m,width:Math.floor(S),height:y.length*A,isSelected:!1}),u.storageDrawData(),d()}});else if(t==="selection"){if(h.current&&U(f,p)){s.current=!0,o.current=!0;return}const m=O({x:f,y:p});u.data.forEach(y=>y.isSelected=!1),s.current=!1,o.current=!0,m?(u.data.find(y=>y.id===m).isSelected=!0,s.current=!0,u.storageDrawData()):(u.addDrawData({type:t,id:P(),x:f,y:p,width:0,height:0,isSelected:!1}),d())}else o.current=!0,u.addDrawData({type:t,id:P(),x:f,y:p,width:0,height:0,isSelected:!1})};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[t]),g.exports.useEffect(()=>{const c=w=>{const{offsetX:f,offsetY:p}=w;if(!o.current){if(t==="selection"){const S=h.current?U(f,p):O({x:f,y:p});n(S?M.move:M.default)}return}const m=f-l.current.x,y=p-l.current.y;if(t==="selection"&&s.current)u.data.filter(v=>v.isSelected).forEach(v=>{v.x=v.x+m,v.y=v.y+y}),(f!==l.current.x||p!==l.current.y)&&(a.current=!0,l.current={x:f,y:p});else{const S=u.data[u.data.length-1];if(S.type!=="text"&&(S.width=m,S.height=y),S.type==="selection"){i.current=!0;const v=Ee(l.current.x,l.current.y,m,y);h.current=v.length>1,u.data.forEach(E=>{E.isSelected=v.includes(E.id)})}}d()};return document.addEventListener("mousemove",c),()=>document.removeEventListener("mousemove",c)},[t]),g.exports.useEffect(()=>{const c=w=>{if(!o.current)return;o.current=!1;const{offsetX:f,offsetY:p}=w;if(f===l.current.x&&p===l.current.y?(t!=="selection"&&u.revokeDrawData(),h.current=!1):(t!=="selection"?(u.data[u.data.length-1].isSelected=!0,r("selection")):u.revokeDrawData(),d()),t==="selection"&&!a.current&&!i.current){u.data.forEach(y=>y.isSelected=!1);const m=O({x:f,y:p});m?u.data.find(y=>y.id===m).isSelected=!0:n(M.default),d()}a.current=!1,i.current=!1,u.storageDrawData()};return document.addEventListener("mouseup",c),()=>document.removeEventListener("mouseup",c)},[t])},Ae=()=>{const{drawType:e,setDrawType:t}=g.exports.useContext(N);return J(r=>{const n=+r-1;!isNaN(n)&&n<z.length&&t(z[n].type)}),D("div",{className:b.container,children:z.map(({Icon:r,type:n},o)=>D(fe,{isActive:n===e,Icon:D(r,F({},le)),index:o+1,changeType:()=>t(n)},o))})};function _e(){const e=g.exports.useRef(null),t=g.exports.useRef(null),{cursorType:r}=g.exports.useContext(X);return g.exports.useEffect(()=>{e.current&&(t.current=e.current.getContext("2d"))},[]),Ie(t),be(e,t),H("div",{className:"App",style:{position:"relative",cursor:r},children:[D(Ae,{}),D("canvas",{ref:e,id:"canvas"})]})}ie.render(D(ae.StrictMode,{children:D(Le,{children:D(Re,{children:D(_e,{})})})}),document.getElementById("root"));
