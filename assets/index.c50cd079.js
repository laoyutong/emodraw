var Pe=Object.defineProperty,ke=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var he=Object.getOwnPropertySymbols;var Ne=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable;var V=(e,t,n)=>t in e?Pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,W=(e,t)=>{for(var n in t||(t={}))Ne.call(t,n)&&V(e,n,t[n]);if(he)for(var n of he(t))Xe.call(t,n)&&V(e,n,t[n]);return e},pe=(e,t)=>ke(e,Ce(t));var ye=(e,t,n)=>(V(e,typeof t!="symbol"?t+"":t,n),n),ee=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)};var $=(e,t,n)=>(ee(e,t,"read from private field"),n?n.call(e):t.get(e)),te=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},we=(e,t,n,r)=>(ee(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);var ge=(e,t,n)=>(ee(e,t,"access private method"),n);import{C as Ye,R as We,a as He,D as Fe,F as Ge,A as je,j as me,c as Be,b as v,r as h,n as re,d as Ue,e as Ke}from"./vendor.779914d6.js";const Ze=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}};Ze();const $e={theme:"outline",size:"20",fill:"#333"},ne=[{type:"selection",Icon:Ye},{type:"rectangle",Icon:We},{type:"circle",Icon:He},{type:"diamond",Icon:Fe},{type:"text",Icon:Ge},{type:"arrow",Icon:je}],qe="_container_zx2b4_1",Je="_active_zx2b4_25";var H={container:qe,"tool-item":"_tool-item_zx2b4_12",active:Je,"tool-index":"_tool-index_zx2b4_28"};const Qe=({Icon:e,index:t,changeType:n,isActive:r})=>me("div",{className:Be(H["tool-item"],{[H.active]:r}),onClick:n,children:[v("div",{className:H["tool-icon"],children:e}),v("div",{className:H["tool-index"],children:t})]}),se="emodraw",De="Segoe UI Emoji",q=15,R={default:"default",crosshair:"crosshair",move:"move",grab:"grab",neswResize:"nesw-resize",nwseResize:"nwse-resize"},Ve=30,C=3,X=8,et=[15,10],F=(e,t,n,r,s)=>{e.beginPath(),e.moveTo(t,n),e.lineTo(t+r,n),e.lineTo(t+r,n+s),e.lineTo(t,n+s),e.closePath(),e.stroke()},tt=(e,t,n,r,s)=>{e.save(),e.fillStyle="rgba(255,165,0,0.5)",e.fillRect(t,n,r,s),e.restore()},rt=(e,t,n,r,s)=>{const i=r>s?1/r:1/s;e.beginPath(),e.moveTo(t+r,n);for(let o=0;o<Math.PI*2;o+=i)e.lineTo(t+r*Math.cos(o),n+s*Math.sin(o));e.closePath(),e.stroke()},nt=(e,t,n,r,s)=>{e.beginPath(),e.moveTo(t+r/2,n+s),e.lineTo(t+r,n+s/2),e.lineTo(t+r/2,n),e.lineTo(t,n+s/2),e.closePath(),e.stroke()},st=(e,t)=>Math.floor(180/(Math.PI/Math.atan(e/t))),xe=30,ot=(e,t,n,r,s)=>{const i=Math.min(Math.pow(r*r+s*s,1/2)/2,Ve),o=s<0?-i:i,g=st(r,s),d=g+xe,p=g-xe,w=t+r,m=n+s,D=w-o*Math.sin(Math.PI*d/180),E=m-o*Math.cos(Math.PI*d/180),M=w-o*Math.sin(Math.PI*p/180),P=m-o*Math.cos(Math.PI*p/180);e.beginPath(),e.moveTo(t,n),e.lineTo(w,m),e.lineTo(D,E),e.moveTo(w,m),e.lineTo(M,P),e.stroke()},it=(e,t)=>{const{type:n,x:r,y:s,width:i,height:o}=t;switch(n){case"rectangle":F(e,r,s,i,o);return;case"circle":rt(e,r+i/2,s+o/2,Math.abs(i/2),Math.abs(o/2));return;case"arrow":ot(e,r,s,i,o);return;case"diamond":nt(e,r,s,i,o);return;case"selection":tt(e,r,s,i,o);return}},at=(e,t)=>{const{content:n,x:r,y:s}=t;e.textBaseline="bottom",e.font=`${q}px  ${De}`,Me(n).forEach((i,o)=>{e.fillText(i,r,s+q*(o+1))})},Se=(e,{x:t,y:n,width:r,height:s,type:i},o)=>{const g=r>0?C:-C,d=s>0?C:-C,p=t-g,w=t+r+g,m=n-d,D=n+s+d;if(e.setLineDash(et),e.beginPath(),e.moveTo(p,m),e.lineTo(w,m),e.lineTo(w,D),e.lineTo(p,D),e.closePath(),e.stroke(),e.setLineDash([]),!o){const E=r>0?X:-X,M=s>0?X:-X;i!=="text"&&(F(e,p,m,-E,-M),F(e,w,D,E,M),i!=="arrow"&&(F(e,w,m,E,-M),F(e,p,D,-E,M)))}},ct=e=>{const t=u.getSelectionData();if(!t)return;const[n,r,s,i]=t;Se(e,{x:n,y:s,width:r-n,height:i-s,type:"selection"},!1)},Te=e=>{let t=!1;u.data.filter(r=>r.isSelected).length>1&&(ct(e),t=!0),u.data.forEach(r=>{r.isSelected&&Se(e,r,t),r.type==="text"?at(e,r):it(e,r)})};var N,J,ut;class lt{constructor(){te(this,J);ye(this,"data");te(this,N,void 0);this.data=ge(this,J,ut).call(this),we(this,N,[])}addOperateStack(t){$(this,N).push(t)}getSelectionData(){let t=-1/0,n=-1/0,r=1/0,s=1/0;const i=this.data.filter(o=>o.isSelected);if(i.length===1&&i[0].type==="text")return null;if(i.length===1&&i[0].type==="arrow"){const o=i[0];return[o.x,o.x+o.width,o.y,o.y+o.height,!0]}return i.forEach(o=>{const[g,d]=o.width>0?[o.x+o.width,o.x]:[o.x,o.x+o.width],[p,w]=o.height>0?[o.y+o.height,o.y]:[o.y,o.y+o.height];g>t&&(t=g),p>n&&(n=p),d<r&&(r=d),w<s&&(s=w)}),[t,r,n,s,!1]}addDrawData(t){this.data.push(t)}popDrawData(){this.data.pop()}revokeDrawData(){if($(this,N).length>0){const t=$(this,N).pop();if(t.type==="DELETE"&&this.data.push(...t.payload),t.type==="ADD"&&(this.data=this.data.filter(n=>t.selectedIds!==n.id)),t.type==="MOVE"){const{x:n,y:r}=t.payload;this.data.forEach(s=>s.isSelected=!1),this.data.filter(s=>t.selectedIds.includes(s.id)).forEach(s=>{s.x-=n,s.y-=r,s.isSelected=!0})}if(t.type==="RESIZE"){const n=t.payload,r=n.map(s=>s.id);this.data=this.data.filter(s=>!r.includes(s.id)).concat(n)}this.storageDrawData()}}storageDrawData(){this.data=this.data.filter(t=>t.type!=="selection").map(t=>{if(t.type==="arrow")return t;const n=W({},t);return n.width<0&&(n.x=n.x+n.width,n.width=-n.width),n.height<0&&(n.y=n.y+n.height,n.height=-n.height),n}),localStorage.setItem(se,JSON.stringify(this.data))}delete(){const t=[];this.data=this.data.filter(n=>n.isSelected?(t.push(pe(W({},n),{isSelected:!1})),!1):!0),this.addOperateStack({type:"DELETE",payload:t}),this.storageDrawData()}}N=new WeakMap,J=new WeakSet,ut=function(){let t;try{t=JSON.parse(localStorage.getItem(se))||[]}catch{t=[],localStorage.setItem(se,"[]")}return t};var u=new lt;const dt=({x:e,y:t},n,r)=>{if(document.querySelector("textarea"))return;const i=document.createElement("textarea");Object.assign(i.style,{position:"absolute",margin:0,padding:0,border:0,outline:0,background:"transparent",resize:"none",top:t+"px",left:e+"px",fontSize:q+"px",lineHeight:"1em",fontFamily:De,width:`${window.innerWidth-e}px`,whiteSpace:"nowrap",overflowX:"hidden"}),r&&(i.value=r,i.setSelectionRange(0,r.length)),i.onkeydown=o=>{o.stopPropagation()},i.oninput=()=>{i.style.height=i.scrollHeight+"px"},i.onblur=o=>{n(o.target.value),document.body.removeChild(i)},document.body.appendChild(i),setTimeout(()=>{i.focus()})},z=5,ft=e=>e>z?e-z:0,G=e=>e+z<window.innerWidth?e+z:window.innerWidth,j=e=>e+z<window.innerWidth?e+z:window.innerWidth,O=(e,t,n)=>e>=ft(t)&&e<=n,oe=(e,t,n,r)=>Math.pow(Math.pow(Math.abs(e-t),2)+Math.pow(Math.abs(n-r),2),1/2),ie=({x:e,y:t})=>{for(let n=0;n<u.data.length;n++){const r=u.data[n],s=r.x,i=r.x+r.width,o=r.y,g=r.y+r.height;if(r.isSelected){const d=r.width>0?i:s,p=r.width>0?s:i,w=r.height>0?g:o,m=r.height>0?o:g;if(e>=p&&e<=d&&t>=m&&t<=w)return r.id}if(r.type==="text"&&O(e,s,G(i))&&O(t,o,j(g))||r.type==="rectangle"&&((O(e,s,G(s))||O(e,i,G(i)))&&O(t,o,j(g))||(O(t,o,j(o))||O(t,g,j(g)))&&O(e,s,G(i))))return r.id;if(r.type==="diamond"){const d=r.width*r.height,p=Math.abs(e-(s+r.width/2)),w=Math.abs(t-(o+r.height/2)),m=((p+z)*r.height+(w+z)*r.width)*2,D=((p-z)*r.height+(w-z)*r.width)*2;if(m>=d&&D<=d)return r.id}if(r.type==="circle"){const d=s+r.width/2,p=o+r.height/2,w=Math.abs(r.width/2),m=Math.abs(r.height/2),D=w>m?1/w:1/m;for(let E=0;E<Math.PI*2;E+=D){const M=Math.round(d+w*Math.cos(E)),P=Math.round(p+m*Math.sin(E));if(O(e,M,G(M))&&O(t,P,j(P)))return r.id}}if(r.type==="arrow"){const d=Math.round(oe(s,i,o,g)),p=Math.round(oe(e,s,t,o)+oe(e,i,t,g));if(p>=d-z/2&&p<=d+z/2)return r.id}}return null},ht=(e,t,n,r)=>{const[s,i]=n>0?[e+n,e]:[e,e+n],[o,g]=r>0?[t+r,t]:[t,t+r];return u.data.filter(d=>{if(d.type==="selection")return!1;const[p,w]=d.width>0?[d.x+d.width,d.x]:[d.x,d.x+d.width],[m,D]=d.height>0?[d.y+d.height,d.y]:[d.y,d.y+d.height];return s>=p&&i<=w&&o>=m&&g<=D}).map(({id:d})=>d)},Re=(e,t)=>{const n=u.getSelectionData();if(!n)return!1;const[r,s,i,o]=n;return e<=r&&e>=s&&t<=i&&t>=o},S=(e,t,n)=>n?e>=t+C&&e<=t+X+C:e<=t-C&&e>=t-X-C,Ee=({x:e,y:t})=>{const n=u.getSelectionData();if(!n)return null;const[r,s,i,o,g]=n;if(g){if(r>=s&&i>o){if(S(e,s,!1)&&S(t,o,!1))return[R.nwseResize,"top"];if(S(e,r,!0)&&S(t,i,!0))return[R.nwseResize,"bottom"]}else if(r>=s&&i<o){if(S(e,s,!1)&&S(t,o,!0))return[R.neswResize,"bottom"];if(S(e,r,!0)&&S(t,i,!1))return[R.neswResize,"top"]}else if(r<s&&i>o){if(S(e,s,!0)&&S(t,o,!1))return[R.neswResize,"top"];if(S(e,r,!1)&&S(t,i,!0))return[R.neswResize,"bottom"]}else{if(S(e,r,!1)&&S(t,i,!1))return[R.nwseResize,"top"];if(S(e,s,!0)&&S(t,o,!0))return[R.nwseResize,"bottom"]}return null}return S(e,s,!1)&&S(t,o,!1)?[R.nwseResize,"top"]:S(e,r,!0)&&S(t,i,!0)?[R.nwseResize,"bottom"]:S(e,s,!1)&&S(t,i,!0)?[R.neswResize,"bottom"]:S(e,r,!0)&&S(t,o,!1)?[R.neswResize,"top"]:null},pt=({x:e,y:t})=>{const n=u.data.filter(r=>r.type==="text");for(let r=0;r<n.length;r++){const s=n[r];if(e>=s.x&&e<=s.x+s.width&&t>=s.y&&t<=s.y+s.height)return s}return null},Me=e=>e.replace(/\r\n?/g,`
`).split(`
`).filter(t=>!!t.trim()),yt=(e,t)=>{h.exports.useEffect(()=>{const n=()=>{!e.current||!t.current||(e.current.width=window.innerWidth,e.current.height=window.innerHeight,Te(t.current))};return n(),window.addEventListener("resize",n),()=>document.removeEventListener("resize",n)},[])},ve=e=>{h.exports.useEffect(()=>{const t=n=>{const{key:r,metaKey:s}=n;e(r,s)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[])},ae=h.exports.createContext({}),wt=({children:e})=>{const[t,n]=h.exports.useState("selection");return v(ae.Provider,{value:{drawType:t,setDrawType:n},children:e})},ce=h.exports.createContext({}),gt=({children:e})=>{const[t,n]=h.exports.useState(R.default);return v(ce.Provider,{value:{cursorType:t,setCursorType:n},children:e})},mt=e=>{const{drawType:t,setDrawType:n}=h.exports.useContext(ae),{cursorType:r,setCursorType:s}=h.exports.useContext(ce),i=h.exports.useRef(!1),o=h.exports.useRef(!1),g=h.exports.useRef(!1),d=h.exports.useRef(!1),p=h.exports.useRef(),w=h.exports.useRef(),m=h.exports.useRef(),D=h.exports.useRef({x:0,y:0}),E=h.exports.useRef({x:0,y:0}),M=h.exports.useRef({x:0,y:0}),P=h.exports.useRef([]),_=()=>{e.current&&(e.current.clearRect(0,0,window.innerWidth,window.innerHeight),Te(e.current))},be=(a,l,c)=>{a.type==="arrow"?w.current==="head"?(a.width+=l,a.height+=c):(a.x+=l,a.y+=c,a.width-=l,a.height-=c):r==="nesw-resize"?p.current==="top"?(a.y+=c,a.width+=l,a.height-=c):(a.height+=c,a.x+=l,a.width-=l):r==="nwse-resize"&&(p.current==="top"?(a.x+=l,a.y+=c,a.width-=l,a.height-=c):(a.width+=l,a.height+=c))},Ie=(a,l,c)=>{const{x:f,y:x}=E.current,y=l-f,T=c-x,L=Math.abs(y)>Math.abs(T);let k=0,Y=0;const b={x:0,y:0},I=u.getSelectionData(),le=I[0]-I[1],ue=I[2]-I[3];r==="nesw-resize"?(k=L?-T:y,Y=L?T:-y,p.current==="top"?(b.x=I[1],b.y=I[2]):(b.x=I[0],b.y=I[3])):(k=L?T:y,Y=L?T:y,p.current==="top"?(b.x=I[0],b.y=I[2]):(b.x=I[1],b.y=I[3])),a.forEach(A=>{const de=Math.abs(A.x-b.x)/le,Oe=Math.abs(A.x+A.width-b.x)/le,fe=Math.abs(A.y-b.y)/ue,_e=Math.abs(A.y+A.height-b.y)/ue;A.x+=(k-M.current.x)*de,A.y+=(Y-M.current.y)*fe,A.width+=(k-M.current.x)*(Oe-de),A.height+=(Y-M.current.y)*(_e-fe)}),M.current={x:k,y:Y}},ze=(a,l,c)=>{a.length===1?be(a[0],l-D.current.x,c-D.current.y):Ie(a,l,c)},Le=(a,l,c)=>{a.forEach(f=>{f.x+=l,f.y+=c})},Q=({x:a,y:l},c)=>{dt({x:a,y:l},f=>{if(f.trim()){const x=Me(f);let y=0;x.forEach(L=>{if(e.current){const{width:k}=e.current.measureText(L);k>y&&(y=k)}});const T=re();u.addDrawData({type:"text",id:T,x:a,y:l,content:f,width:Math.floor(y),height:x.length*q,isSelected:!1}),u.addOperateStack({type:"ADD",selectedIds:T}),u.storageDrawData(),_()}},c)},B=h.exports.useRef();B.current=(a,l)=>{if(t==="selection"){const c=pt({x:a,y:l});u.data.forEach(f=>f.isSelected=!1),c?(u.data=u.data.filter(f=>f.id!==c.id),Q({x:c.x,y:c.y},c.content)):Q({x:a,y:l}),_()}},h.exports.useEffect(()=>{const a=({pageX:l,pageY:c})=>{var f;(f=B.current)==null||f.call(B,l,c)};return document.addEventListener("dblclick",a),()=>document.removeEventListener("dblclick",a)},[]),h.exports.useEffect(()=>{s(t==="selection"?R.default:R.crosshair),t!=="selection"&&u.data.forEach(a=>a.isSelected=!1)},[t]),ve((a,l)=>{l&&a==="z"&&(u.revokeDrawData(),_()),l&&a==="a"&&(u.data.forEach(c=>c.isSelected=!0),u.data.length>1&&(d.current=!0),u.storageDrawData(),_()),a==="Backspace"&&(u.delete(),_())});const Ae=()=>{m.current=void 0,g.current=!1,M.current={x:0,y:0},P.current=[]},U=h.exports.useRef();U.current=a=>{const{pageX:l,pageY:c}=a;if(D.current=E.current={x:l,y:c},t==="text")n("selection"),Q({x:l,y:c});else if(t==="selection"){if(i.current=!0,d.current&&Re(l,c)){o.current=!0;return}const f=Ee({x:l,y:c});if(f){p.current=f[1],o.current=!0;const y=u.data.filter(T=>T.isSelected);if(P.current=y.map(T=>W({},T)),y.length===1&&y[0].type==="arrow"){const T=y[0];w.current=T.height<=0&&p.current==="top"||T.height>0&&p.current==="bottom"?"head":"foot"}return}const x=ie({x:l,y:c});u.data.forEach(y=>y.isSelected=!1),o.current=!1,x?(u.data.find(y=>y.id===x).isSelected=!0,o.current=!0,u.storageDrawData()):(u.addDrawData({type:t,id:re(),x:l,y:c,width:0,height:0,isSelected:!1}),_())}else i.current=!0,u.addDrawData({type:t,id:re(),x:l,y:c,width:0,height:0,isSelected:!1})};const K=h.exports.useRef();K.current=a=>{const{pageX:l,pageY:c}=a;if(!i.current){const y=Ee({x:l,y:c});if(y){s(y[0]);return}if(t==="selection"){const T=d.current?Re(l,c):ie({x:l,y:c});s(T?R.move:R.default)}return}const f=l-D.current.x,x=c-D.current.y;if(t==="selection"&&o.current){const y=u.data.filter(L=>L.isSelected),T=["nesw-resize","nwse-resize"].includes(r);T?ze(y,l,c):Le(y,f,x),(l!==D.current.x||c!==D.current.y)&&(m.current=T?"resize":"move",D.current={x:l,y:c})}else{const y=u.data[u.data.length-1];if(y.type!=="text"&&(y.width=f,y.height=x),y.type==="selection"){g.current=!0;const T=ht(D.current.x,D.current.y,f,x);d.current=T.length>1,u.data.forEach(L=>{L.isSelected=T.includes(L.id)})}}_()};const Z=h.exports.useRef();Z.current=a=>{if(!i.current)return;i.current=!1;const{pageX:l,pageY:c}=a;if(l===D.current.x&&c===D.current.y)t!=="selection"&&u.popDrawData(),m.current?m.current==="move"?u.addOperateStack({type:"MOVE",selectedIds:u.data.filter(f=>f.isSelected).map(f=>f.id),payload:{x:l-E.current.x,y:c-E.current.y}}):u.addOperateStack({type:"RESIZE",payload:P.current}):d.current=!1;else{if(t!=="selection"){const f=u.data[u.data.length-1];f.isSelected=!0,u.addOperateStack({type:"ADD",selectedIds:f.id}),n("selection")}else u.popDrawData();_()}if(t==="selection"&&!m.current&&!g.current){u.data.forEach(x=>x.isSelected=!1);const f=ie({x:l,y:c});f?u.data.find(x=>x.id===f).isSelected=!0:s(R.default),_()}Ae(),u.storageDrawData()},h.exports.useEffect(()=>{const a=f=>{var x;(x=K.current)==null||x.call(K,f)},l=f=>{var x;(x=U.current)==null||x.call(U,f)},c=f=>{var x;(x=Z.current)==null||x.call(Z,f)};return document.addEventListener("mousedown",l),document.addEventListener("mousemove",a),document.addEventListener("mouseup",c),()=>{document.removeEventListener("mousedown",l),document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",c)}},[])},Dt=()=>{const{drawType:e,setDrawType:t}=h.exports.useContext(ae);return ve(n=>{const r=+n-1;!isNaN(r)&&r!==-1&&r<ne.length&&t(ne[r].type)}),v("div",{className:H.container,children:ne.map(({Icon:n,type:r},s)=>v(Qe,{isActive:r===e,Icon:v(n,W({},$e)),index:s+1,changeType:()=>t(r)},s))})};function xt(){const e=h.exports.useRef(null),t=h.exports.useRef(null),{cursorType:n}=h.exports.useContext(ce);return h.exports.useEffect(()=>{e.current&&(t.current=e.current.getContext("2d"))},[]),mt(t),yt(e,t),me("div",{className:"App",style:{position:"relative",cursor:n},children:[v(Dt,{}),v("canvas",{ref:e,id:"canvas"})]})}Ue.render(v(Ke.StrictMode,{children:v(wt,{children:v(gt,{children:v(xt,{})})})}),document.getElementById("root"));
