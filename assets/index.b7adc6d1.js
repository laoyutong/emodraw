var nt=Object.defineProperty,rt=Object.defineProperties;var ot=Object.getOwnPropertyDescriptors;var ze=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,it=Object.prototype.propertyIsEnumerable;var he=(e,t,r)=>t in e?nt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,N=(e,t)=>{for(var r in t||(t={}))st.call(t,r)&&he(e,r,t[r]);if(ze)for(var r of ze(t))it.call(t,r)&&he(e,r,t[r]);return e},ne=(e,t)=>rt(e,ot(t));var _e=(e,t,r)=>(he(e,typeof t!="symbol"?t+"":t,r),r),pe=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var re=(e,t,r)=>(pe(e,t,"read from private field"),r?r.call(e):t.get(e)),ye=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},Oe=(e,t,r,o)=>(pe(e,t,"write to private field"),o?o.call(e,r):t.set(e,r),r);var Ce=(e,t,r)=>(pe(e,t,"access private method"),r);import{C as at,R as ct,a as lt,D as dt,F as ut,A as ft,m as ht,j as oe,c as ge,b as M,r as m,n as se,d as pt,L as yt,E as gt,e as wt,f as mt,g as xt,h as Dt}from"./vendor.8922c5b7.js";const Et=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}};Et();const Pe={theme:"outline",size:"20",fill:"#333"},we=[{type:"selection",Icon:at},{type:"rectangle",Icon:ct},{type:"circle",Icon:lt},{type:"diamond",Icon:dt},{type:"text",Icon:ut},{type:"arrow",Icon:ft}],me="emodraw",Ne="Segoe UI Emoji",k=15,xe=k+3,Tt="#fff",L={default:"default",crosshair:"crosshair",move:"move",grab:"grab",neswResize:"nesw-resize",nwseResize:"nwse-resize"},St=30,X=3,B=8,Rt=[15,10],ie=10,ke=20,ae=30,bt="emodraw.png",Lt="emodraw",ce=["rectangle","circle","diamond"],J=(e,t,r,o,n)=>{e.beginPath(),e.moveTo(t,r),e.lineTo(t+o,r),e.lineTo(t+o,r+n),e.lineTo(t,r+n),e.closePath(),e.stroke()},It=(e,t,r,o,n)=>{e.save(),e.fillStyle="rgba(255,165,0,0.5)",e.fillRect(t,r,o,n),e.restore()},vt=(e,t,r,o,n)=>{const s=o>n?1/o:1/n;e.beginPath(),e.moveTo(t+o,r);for(let c=0;c<Math.PI*2;c+=s)e.lineTo(t+o*Math.cos(c),r+n*Math.sin(c));e.closePath(),e.stroke()},At=(e,t,r,o,n)=>{e.beginPath(),e.moveTo(t+o/2,r+n),e.lineTo(t+o,r+n/2),e.lineTo(t+o/2,r),e.lineTo(t,r+n/2),e.closePath(),e.stroke()},Mt=(e,t)=>Math.floor(180/(Math.PI/Math.atan(e/t))),Xe=30,zt=(e,t,r,o,n)=>{const s=Math.min(Math.pow(o*o+n*n,1/2)/2,St),c=n<0?-s:s,p=Mt(o,n),a=p+Xe,y=p-Xe,x=t+o,T=r+n,D=x-c*Math.sin(Math.PI*a/180),A=T-c*Math.cos(Math.PI*a/180),I=x-c*Math.sin(Math.PI*y/180),G=T-c*Math.cos(Math.PI*y/180);e.beginPath(),e.moveTo(t,r),e.lineTo(x,T),e.lineTo(D,A),e.moveTo(x,T),e.lineTo(I,G),e.stroke()},_t=(e,t)=>{const{type:r,x:o,y:n,width:s,height:c}=t;switch(r){case"rectangle":J(e,o,n,s,c);return;case"circle":vt(e,o+s/2,n+c/2,Math.abs(s/2),Math.abs(c/2));return;case"arrow":zt(e,o,n,s,c);return;case"diamond":At(e,o,n,s,c);return;case"selection":It(e,o,n,s,c);return}},Ot=(e,t)=>{const{content:r,x:o,y:n,containerId:s,width:c}=t;e.textBaseline="bottom",e.font=`${k}px  ${Ne}`,Re(r).forEach((a,y)=>{if(s){const x=e.measureText(a).width;e.fillText(a,o+(c-x)/2,n+k*(y+1))}else e.fillText(a,o,n+k*(y+1))})},Ye=(e,{x:t,y:r,width:o,height:n,type:s},c)=>{const p=o>0?X:-X,a=n>0?X:-X,y=t-p,x=t+o+p,T=r-a,D=r+n+a;if(e.setLineDash(Rt),e.beginPath(),e.moveTo(y,T),e.lineTo(x,T),e.lineTo(x,D),e.lineTo(y,D),e.closePath(),e.stroke(),e.setLineDash([]),!c){const A=o>0?B:-B,I=n>0?B:-B;s!=="text"&&(J(e,y,T,-A,-I),J(e,x,D,A,I),s!=="arrow"&&(J(e,x,T,A,-I),J(e,y,D,-A,I)))}},Ct=e=>{const t=d.getSelectionData();if(!t)return;const[r,o,n,s]=t;Ye(e,{x:r,y:n,width:o-r,height:s-n,type:"selection"},!1)},De=(e,t=d.data)=>{let r=!1;d.data.filter(n=>n.isSelected).length>1&&(Ct(e),r=!0),t.forEach(n=>{n.isSelected&&Ye(e,n,r),n.type==="text"?Ot(e,n):_t(e,n)})};var F,ue,Nt;class Pt{constructor(){ye(this,ue);_e(this,"data");ye(this,F,void 0);this.data=Ce(this,ue,Nt).call(this),Oe(this,F,[])}addOperateStack(t){re(this,F).push(t)}getSelectionData(){const t=this.data.filter(r=>r.isSelected);if(t.length===1&&t[0].type==="text")return null;if(t.length===1&&t[0].type==="arrow"){const r=t[0];return[r.x,r.x+r.width,r.y,r.y+r.height,!0]}return[...Se(t),!1]}addDrawData(t){this.data.push(t)}popDrawData(){this.data.pop()}revokeDrawData(){if(re(this,F).length>0){const t=re(this,F).pop();if(t.type==="DELETE"&&this.data.push(...t.payload),t.type==="ADD"&&(this.data=this.data.filter(r=>!t.selectedIds.includes(r.id))),t.type==="MOVE"){const{x:r,y:o}=t.payload;this.data.forEach(n=>n.isSelected=!1),this.data.filter(n=>t.selectedIds.includes(n.id)).forEach(n=>{n.x-=r,n.y-=o,n.isSelected=!0})}if(t.type==="RESIZE"){const r=t.payload,o=r.map(n=>n.id);this.data=this.data.filter(n=>!o.includes(n.id)).concat(r)}t.type==="SET"&&(this.data=t.payload),this.storageDrawData()}}storageDrawData(){this.data=this.data.filter(t=>t.type!=="selection").map(t=>{if(t.type==="arrow")return t;const r=N({},t);return r.width<0&&(r.x=r.x+r.width,r.width=-r.width),r.height<0&&(r.y=r.y+r.height,r.height=-r.height),r}),localStorage.setItem(me,JSON.stringify(this.data))}delete(){const t=[];this.data.forEach(r=>{r.isSelected&&(r.isDeleted=!0,ce.includes(r.type)&&r.boundElement.forEach(o=>{console.log(o,this.data),this.data.find(n=>n.id===o.id).isDeleted=!0}))}),this.data=this.data.filter(r=>r.isDeleted?(t.push(ne(N({},r),{isSelected:!1,isDeleted:!1})),!1):!0),this.addOperateStack({type:"DELETE",payload:t}),this.storageDrawData()}}F=new WeakMap,ue=new WeakSet,Nt=function(){let t;try{t=JSON.parse(localStorage.getItem(me))||[]}catch{t=[],localStorage.setItem(me,"[]")}return t};var d=new Pt;const We=()=>document.querySelector("textarea")?null:document.createElement("textarea"),He=(e,t)=>{Object.assign(e.style,N({position:"absolute",margin:0,padding:0,border:0,outline:0,background:"transparent",resize:"none",fontSize:k+"px",lineHeight:"1em",fontFamily:Ne,overflow:"hidden"},t))},Fe=(e,{oninput:t,onChange:r})=>{e.onkeydown=o=>{o.stopPropagation()},e.oninput=()=>{e.style.height=e.scrollHeight+"px",t==null||t()},e.onblur=o=>{r(o.target.value),document.body.removeChild(e)},setTimeout(()=>{e.focus()})},kt=(e,t,r)=>{const o=We();if(!o)return;if(He(o,{top:e.y+e.height/2-xe+"px",left:e.x+"px",width:e.width+"px",height:xe+"px",textAlign:"center"}),r){const s=r.content;o.value=s,o.setSelectionRange(0,s.length),o.style.height=r.height+"px",o.style.top=e.y+e.height/2-r.height/2+"px"}const n=()=>{const[s]=je(o.value,e.width);return s.length};Fe(o,{oninput:()=>{const s=n();o.style.height=s*xe+"px",o.style.top=e.y+e.height/2-s*k/2+"px"},onChange:s=>{t(s,k*n())}}),document.body.appendChild(o)},Xt=({x:e,y:t},r,o)=>{const n=We();if(!!n){if(o){const s=o.content;n.value=s,n.setSelectionRange(0,s.length),n.style.height=o.height+"px"}He(n,{top:t+"px",left:e+"px",width:`${window.innerWidth-e}px`,whiteSpace:"nowrap"}),Fe(n,{onChange:r}),document.body.appendChild(n)}},R=5,Yt=e=>e>R?e-R:0,le=e=>e+R<window.innerWidth?e+R:window.innerWidth,de=e=>e+R<window.innerWidth?e+R:window.innerWidth,Y=(e,t,r)=>e>=Yt(t)&&e<=r,Ee=(e,t,r,o)=>Math.pow(Math.pow(Math.abs(e-t),2)+Math.pow(Math.abs(r-o),2),1/2),Be=({x:e,y:t})=>{const r=d.data.filter(o=>ce.includes(o.type)&&o.boundElement.length!==0);for(let o=0;o<r.length;o++){const n=r[o];if(n.type==="rectangle"&&e>=n.x-R&&e<=n.x+n.width+R&&t>=n.y-R&&t<=n.y+n.height+R)return n.id;if(n.type==="diamond"){const s=n.width*n.height,c=Math.abs(e-(n.x+n.width/2)),p=Math.abs(t-(n.y+n.height/2)),a=((c+R)*n.height+(p+R)*n.width)*2;if(e>=n.x-R&&e<=n.x+n.width+R&&t>=n.y-R&&t<=n.y+n.height+R&&a<=s)return n.id}if(n.type==="circle"){const s=n.x+n.width/2,c=n.y+n.height/2,p=n.width/2,a=n.height/2;if(Math.pow(e-s,2)/Math.pow(p,2)+Math.pow(t-c,2)/Math.pow(a,2)<=1)return n.id}}return null},Te=({x:e,y:t})=>{for(let o=0;o<d.data.length;o++){const n=d.data[o];if(n.type==="text"&&n.containerId!==null)continue;const s=n.x,c=n.x+n.width,p=n.y,a=n.y+n.height;if(n.isSelected){const y=n.width>0?c:s,x=n.width>0?s:c,T=n.height>0?a:p,D=n.height>0?p:a;if(e>=x&&e<=y&&t>=D&&t<=T)return n.id}if(n.type==="text"&&Y(e,s,le(c))&&Y(t,p,de(a))||n.type==="rectangle"&&((Y(e,s,le(s))||Y(e,c,le(c)))&&Y(t,p,de(a))||(Y(t,p,de(p))||Y(t,a,de(a)))&&Y(e,s,le(c))))return n.id;if(n.type==="diamond"){const y=n.width*n.height,x=Math.abs(e-(s+n.width/2)),T=Math.abs(t-(p+n.height/2)),D=((x+R)*n.height+(T+R)*n.width)*2,A=((x-R)*n.height+(T-R)*n.width)*2;if(D>=y&&A<=y)return n.id}if(n.type==="circle"){const y=s+n.width/2,x=p+n.height/2,T=n.width/2,D=n.height/2,A=Math.pow(e-y,2)/Math.pow(T,2)+Math.pow(t-x,2)/Math.pow(D,2);if(A<=1.1&&A>=.9)return n.id}if(n.type==="arrow"){const y=Math.round(Ee(s,c,p,a)),x=Math.round(Ee(e,s,t,p)+Ee(e,c,t,a));if(x>=y-R/2&&x<=y+R/2)return n.id}}const r=Be({x:e,y:t});return r||null},Wt=(e,t,r,o)=>{const[n,s]=r>0?[e+r,e]:[e,e+r],[c,p]=o>0?[t+o,t]:[t,t+o];return d.data.filter(a=>{if(a.type==="selection"||a.type==="text"&&a.containerId!==null)return!1;const[y,x]=a.width>0?[a.x+a.width,a.x]:[a.x,a.x+a.width],[T,D]=a.height>0?[a.y+a.height,a.y]:[a.y,a.y+a.height];return n>=y&&s<=x&&c>=T&&p<=D}).map(({id:a})=>a)},Ge=(e,t)=>{const r=d.getSelectionData();if(!r)return!1;const[o,n,s,c]=r;return e<=o&&e>=n&&t<=s&&t>=c},S=(e,t,r)=>r?e>=t+X&&e<=t+B+X:e<=t-X&&e>=t-B-X,Ue=({x:e,y:t})=>{const r=d.getSelectionData();if(!r)return null;const[o,n,s,c,p]=r;if(p){if(o>=n&&s>c){if(S(e,n,!1)&&S(t,c,!1))return[L.nwseResize,"top"];if(S(e,o,!0)&&S(t,s,!0))return[L.nwseResize,"bottom"]}else if(o>=n&&s<c){if(S(e,n,!1)&&S(t,c,!0))return[L.neswResize,"bottom"];if(S(e,o,!0)&&S(t,s,!1))return[L.neswResize,"top"]}else if(o<n&&s>c){if(S(e,n,!0)&&S(t,c,!1))return[L.neswResize,"top"];if(S(e,o,!1)&&S(t,s,!0))return[L.neswResize,"bottom"]}else{if(S(e,o,!1)&&S(t,s,!1))return[L.nwseResize,"top"];if(S(e,n,!0)&&S(t,c,!0))return[L.nwseResize,"bottom"]}return null}return S(e,n,!1)&&S(t,c,!1)?[L.nwseResize,"top"]:S(e,o,!0)&&S(t,s,!0)?[L.nwseResize,"bottom"]:S(e,n,!1)&&S(t,s,!0)?[L.neswResize,"bottom"]:S(e,o,!0)&&S(t,c,!1)?[L.neswResize,"top"]:null},Ht=({x:e,y:t})=>{const r=d.data.filter(o=>o.type==="text");for(let o=0;o<r.length;o++){const n=r[o];if(e>=n.x&&e<=n.x+n.width&&t>=n.y&&t<=n.y+n.height)return n}return null},Se=e=>{let t=-1/0,r=-1/0,o=1/0,n=1/0;return e.forEach(s=>{const[c,p]=s.width>0?[s.x+s.width,s.x]:[s.x,s.x+s.width],[a,y]=s.height>0?[s.y+s.height,s.y]:[s.y,s.y+s.height];c>t&&(t=c),a>r&&(r=a),p<o&&(o=p),y<n&&(n=y)}),[t,o,r,n]},Ft=({x:e,y:t})=>{let r=null;return d.data.forEach(o=>{const n=o.x+o.width/2,s=o.y+o.height/2;ce.includes(o.type)&&e<=n+ie&&e>=n-ie&&t<=s+ie&&t>=s-ie&&(r?o.width<r.width&&(r=o):r=o)}),r},Re=e=>e.replace(/\r\n?/g,`
`).split(`
`),Bt=e=>{const t="\uFEFF",r=new Blob([t+e],{type:"text/json"});return URL.createObjectURL(r)},je=(e,t,r)=>{const o=r!=null?r:document.createElement("canvas").getContext("2d"),n=[];Re(e).forEach(p=>{let a="",y=0;for(let x=1;x<=p.length;x++){a=p.substring(y,x);const{width:T}=o.measureText(a);T>t&&(n.push(p.substring(y,x-1)),y=x-1)}n.push(a)});let c=0;return n.forEach(p=>{const{width:a}=o.measureText(p);a>c&&(c=a)}),[n,c]},Je=(e,t)=>{const r=document.createElement("a");r.download=t,r.href=e,document.body.appendChild(r),r.click(),document.body.removeChild(r)};var C=ht();const Gt="_container_1dwzc_1",Ut="_element_1dwzc_10",jt="_operate_1dwzc_14",Jt="_active_1dwzc_30";var W={container:Gt,element:Ut,operate:jt,"tool-item":"_tool-item_1dwzc_17",active:Jt,"tool-index":"_tool-index_1dwzc_33"};const Kt=({Icon:e,index:t,changeType:r,isActive:o})=>oe("div",{className:ge(W["tool-item"],{[W.active]:o}),onClick:r,children:[M("div",{children:e}),M("div",{className:W["tool-index"],children:t})]}),Vt=(e,t)=>{m.exports.useEffect(()=>{const r=()=>{!e.current||!t.current||(e.current.width=window.innerWidth,e.current.height=window.innerHeight,De(t.current))};return r(),window.addEventListener("resize",r),()=>document.removeEventListener("resize",r)},[])},Ke=e=>{m.exports.useEffect(()=>{const t=r=>{const{key:o,metaKey:n}=r;e(o,n)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[])},be=m.exports.createContext({}),Zt=({children:e})=>{const[t,r]=m.exports.useState("selection");return M(be.Provider,{value:{drawType:t,setDrawType:r},children:e})},Le=m.exports.createContext({}),$t=({children:e})=>{const[t,r]=m.exports.useState(L.default);return M(Le.Provider,{value:{cursorType:t,setCursorType:r},children:e})},qt=e=>{const{drawType:t,setDrawType:r}=m.exports.useContext(be),{cursorType:o,setCursorType:n}=m.exports.useContext(Le),s=m.exports.useRef(!1),c=m.exports.useRef(!1),p=m.exports.useRef(!1),a=m.exports.useRef(!1),y=m.exports.useRef(),x=m.exports.useRef(),T=m.exports.useRef(),D=m.exports.useRef({x:0,y:0}),A=m.exports.useRef({x:0,y:0}),I=m.exports.useRef({x:0,y:0}),G=m.exports.useRef([]),K=m.exports.useRef([]),fe=m.exports.useRef({x:0,y:0}),V=m.exports.useRef(!1),O=()=>{e.current&&(e.current.clearRect(0,0,window.innerWidth,window.innerHeight),De(e.current))},U=()=>{d.data.forEach(u=>u.isSelected=!1)};m.exports.useEffect(()=>{const u=()=>{d.addOperateStack({type:"DELETE",payload:d.data}),d.data=[],d.storageDrawData(),O()},l=()=>{if(d.data.length===0)return;const f=document.createElement("canvas"),[h,w,E,b]=Se(d.data),v=h-w+ae,z=E-b+ae;f.width=v,f.height=z;const _=f.getContext("2d");_.save(),_.fillStyle=Tt,_.fillRect(0,0,v,z),_.restore(),De(_,d.data.map(j=>ne(N({},j),{x:j.x-w+ae/2,y:j.y-b+ae/2})));const H=f.toDataURL();Je(H,bt)},i=()=>{if(d.data.length===0)return;const f=Bt(JSON.stringify(d.data));Je(f,Lt)},g=()=>{const f=document.createElement("input");f.type="file",document.body.appendChild(f),f.click(),f.onchange=h=>{const E=h.target.files[0],b=new FileReader;b.onload=v=>{try{const z=JSON.parse(v.target.result);d.addOperateStack({type:"SET",payload:d.data}),d.data=z,d.storageDrawData(),O()}catch{}},b.readAsText(E),document.body.removeChild(f)}};return C.on("exportImage",l),C.on("exportData",i),C.on("clear",u),C.on("import",g),()=>{C.off("import",g),C.off("exportData",i),C.off("exportImage",l),C.off("clear",u)}},[]),m.exports.useEffect(()=>{const u=()=>{K.current=d.data.filter(i=>i.isSelected)},l=()=>{if(K.current.length>0&&!V.current){const[i,g,f,h]=Se(K.current),[w,E]=[(i+g)/2,(f+h)/2],[b,v]=[fe.current.x-w,fe.current.y-E];U();const z=[];K.current.forEach(_=>{const H=se();d.addDrawData(ne(N({},_),{id:H,x:_.x+b,y:_.y+v,isSelected:!0})),z.push(H)}),d.addOperateStack({type:"ADD",selectedIds:z}),d.storageDrawData(),O()}};return document.addEventListener("copy",u),document.addEventListener("paste",l),()=>{document.removeEventListener("copy",u),document.addEventListener("paste",l)}},[]);const Ve=(u,l,i)=>{u.type==="arrow"?x.current==="head"?(u.width+=l,u.height+=i):(u.x+=l,u.y+=i,u.width-=l,u.height-=i):o==="nesw-resize"?y.current==="top"?(u.y+=i,u.width+=l,u.height-=i):(u.height+=i,u.x+=l,u.width-=l):o==="nwse-resize"&&(y.current==="top"?(u.x+=l,u.y+=i,u.width-=l,u.height-=i):(u.width+=l,u.height+=i))},Ze=(u,l,i)=>{const{x:g,y:f}=A.current,h={x:0,y:0},w=l-g,E=i-f,b=d.getSelectionData(),v=b[0]-b[1],z=b[2]-b[3],_=y.current==="top",H=_&&o==="nesw-resize"||y.current==="bottom"&&o==="nwse-resize",j=y.current==="bottom"&&o==="nesw-resize"||_&&o==="nwse-resize";if(v<=ke&&(w<=I.current.x&&H||w>=I.current.x&&j)||z<=ke&&(E<=I.current.y&&y.current==="bottom"||E>=I.current.y&&_))return;let ee=0,te=0;const ve=Math.abs(w)>Math.abs(E);ee=ve?o==="nesw-resize"?-E:E:w,te=ve?E:o==="nesw-resize"?-w:w,h.x=b[H?1:0],h.y=b[_?2:3],u.forEach(P=>{const Ae=Math.abs(P.x-h.x)/v,et=Math.abs(P.x+P.width-h.x)/v,Me=Math.abs(P.y-h.y)/z,tt=Math.abs(P.y+P.height-h.y)/z;P.x+=(ee-I.current.x)*Ae,P.y+=(te-I.current.y)*Me,P.type!=="text"&&(P.width+=(ee-I.current.x)*(et-Ae),P.height+=(te-I.current.y)*(tt-Me))}),I.current={x:ee,y:te}},$e=(u,l,i)=>{u.length===1?Ve(u[0],l-D.current.x,i-D.current.y):Ze(u,l,i)},qe=(u,l,i)=>{u.forEach(g=>{g.x+=l,g.y+=i})},Ie=u=>{V.current=!0;let l=Ht(u),i=null;if(l){const f=l.containerId;f&&(i=d.data.find(h=>h.id===f),i.boundElement=i.boundElement.filter(h=>h.id!==l.id))}else{const f=Be(u);if(f){i=d.data.find(w=>w.id===f);const h=i.boundElement.find(w=>w.type==="text");l=d.data.find(w=>w.id===h.id),i.boundElement=i.boundElement.filter(w=>w.id!==h.id)}}l&&(d.data=d.data.filter(f=>f.id!==l.id),O()),!i&&!l&&(i=Ft(u));const g=se();if(i)kt(i,(f,h)=>{if(i=i,V.current=!1,f.trim()&&e.current){const[w,E]=je(f,i.width,e.current),b=i.y+i.height/2-h/2;d.addDrawData({type:"text",id:g,x:i.x+(i.width-E)/2,y:b,content:w.join(`
`),width:E,height:h,isSelected:!1,isDeleted:!1,containerId:i.id}),i.boundElement.push({type:"text",id:g}),d.addOperateStack({type:"ADD",selectedIds:[g]}),d.storageDrawData(),O()}},l);else{const f=l?{x:l.x,y:l.y}:u;Xt(f,h=>{if(V.current=!1,h.trim()){const w=Re(h);let E=0;w.forEach(b=>{if(e.current){const{width:v}=e.current.measureText(b);v>E&&(E=v)}}),d.addDrawData({type:"text",id:g,x:f.x,y:f.y,content:h,width:E,height:w.length*k,isSelected:!1,isDeleted:!1,containerId:null}),d.addOperateStack({type:"ADD",selectedIds:[g]}),d.storageDrawData(),O()}},l)}},Z=m.exports.useRef();Z.current=(u,l)=>{t==="selection"&&(U(),Ie({x:u,y:l}))},m.exports.useEffect(()=>{const u=({pageX:l,pageY:i})=>{var g;(g=Z.current)==null||g.call(Z,l,i)};return document.addEventListener("dblclick",u),()=>document.removeEventListener("dblclick",u)},[]),m.exports.useEffect(()=>{n(t==="selection"?L.default:L.crosshair),t!=="selection"&&U()},[t]),Ke((u,l)=>{l&&u==="z"&&(d.revokeDrawData(),O()),l&&u==="a"&&(d.data.forEach(i=>i.isSelected=!0),d.data.length>1&&(a.current=!0),d.storageDrawData(),O()),u==="Backspace"&&(d.delete(),O())});const Qe=()=>{T.current=void 0,p.current=!1,I.current={x:0,y:0},G.current=[]},$=m.exports.useRef();$.current=u=>{if(u.button===2)return;const{pageX:l,pageY:i}=u;if(D.current=A.current={x:l,y:i},t==="text")r("selection"),Ie({x:l,y:i});else if(t==="selection"){if(s.current=!0,a.current&&Ge(l,i)){c.current=!0;return}const g=Ue({x:l,y:i});if(g){y.current=g[1],c.current=!0;const h=d.data.filter(w=>w.isSelected);if(G.current=h.map(w=>N({},w)),h.length===1&&h[0].type==="arrow"){const w=h[0];x.current=w.height<=0&&y.current==="top"||w.height>0&&y.current==="bottom"?"head":"foot"}return}const f=Te({x:l,y:i});U(),c.current=!1,f?(d.data.find(h=>h.id===f).isSelected=!0,c.current=!0,d.storageDrawData()):(d.addDrawData({type:t,id:se(),x:l,y:i,width:0,height:0,isSelected:!1,isDeleted:!1}),O())}else s.current=!0,d.addDrawData({type:t,id:se(),x:l,y:i,width:0,height:0,isSelected:!1,isDeleted:!1,boundElement:[]})};const q=m.exports.useRef();q.current=u=>{const{pageX:l,pageY:i}=u;if(fe.current={x:l,y:i},!s.current){const h=Ue({x:l,y:i});if(h){n(h[0]);return}if(t==="selection"){const w=a.current?Ge(l,i):Te({x:l,y:i});n(w?L.move:L.default)}return}const g=l-D.current.x,f=i-D.current.y;if(t==="selection"&&c.current){const h=d.data.filter(E=>E.isSelected);h.forEach(E=>{ce.includes(E.type)&&E.boundElement.filter(v=>v.type==="text").forEach(v=>{h.push(d.data.find(z=>z.id===v.id))})});const w=["nesw-resize","nwse-resize"].includes(o);w?$e(h,l,i):qe(h,g,f),(l!==D.current.x||i!==D.current.y)&&(T.current=w?"resize":"move",D.current={x:l,y:i})}else{const h=d.data[d.data.length-1];if(h.type!=="text"&&(h.width=g,h.height=f),h.type==="selection"){p.current=!0;const w=Wt(D.current.x,D.current.y,g,f);a.current=w.length>1,d.data.forEach(E=>{E.isSelected=w.includes(E.id)})}}O()};const Q=m.exports.useRef();Q.current=u=>{if(!s.current)return;s.current=!1;const{pageX:l,pageY:i}=u;if(l===D.current.x&&i===D.current.y)t!=="selection"&&d.popDrawData(),T.current?T.current==="move"?d.addOperateStack({type:"MOVE",selectedIds:d.data.filter(g=>g.isSelected).map(g=>g.id),payload:{x:l-A.current.x,y:i-A.current.y}}):d.addOperateStack({type:"RESIZE",payload:G.current}):a.current=!1;else{if(t!=="selection"){const g=d.data[d.data.length-1];g.isSelected=!0,d.addOperateStack({type:"ADD",selectedIds:[g.id]}),r("selection")}else d.popDrawData();O()}if(t==="selection"&&!T.current&&!p.current){U();const g=Te({x:l,y:i});g?d.data.find(f=>f.id===g).isSelected=!0:n(L.default),O()}Qe(),d.storageDrawData()},m.exports.useEffect(()=>{const u=g=>{var f;(f=q.current)==null||f.call(q,g)},l=g=>{var f;(f=$.current)==null||f.call($,g)},i=g=>{var f;(f=Q.current)==null||f.call(Q,g)};return document.addEventListener("mousedown",l),document.addEventListener("mousemove",u),document.addEventListener("mouseup",i),()=>{document.removeEventListener("mousedown",l),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",i)}},[])},Qt=()=>{const{drawType:e,setDrawType:t}=m.exports.useContext(be);Ke(p=>{const a=+p-1;!isNaN(a)&&a!==-1&&a<we.length&&t(we[a].type)});const r=(p,a)=>M("div",{className:W["tool-item"],onClick:a,children:M(p,N({},Pe))}),o=()=>{C.emit("clear")},n=()=>{C.emit("import")},s=()=>{C.emit("exportData")},c=()=>{C.emit("exportImage")};return oe(pt,{children:[M("div",{className:ge(W.container,W.element),children:we.map(({Icon:p,type:a},y)=>M(Kt,{isActive:a===e,Icon:M(p,N({},Pe)),index:y+1,changeType:()=>t(a)},y))}),oe("div",{className:ge(W.container,W.operate),children:[r(mt,o),r(yt,n),r(gt,s),r(wt,c)]})]})};function en(){const e=m.exports.useRef(null),t=m.exports.useRef(null),{cursorType:r}=m.exports.useContext(Le);return m.exports.useEffect(()=>{e.current&&(t.current=e.current.getContext("2d"))},[]),qt(t),Vt(e,t),oe("div",{className:"App",style:{position:"relative",cursor:r},children:[M(Qt,{}),M("canvas",{ref:e,id:"canvas"})]})}xt.render(M(Dt.StrictMode,{children:M(Zt,{children:M($t,{children:M(en,{})})})}),document.getElementById("root"));
