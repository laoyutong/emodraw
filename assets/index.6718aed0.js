var nt=Object.defineProperty,rt=Object.defineProperties;var ot=Object.getOwnPropertyDescriptors;var ze=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,it=Object.prototype.propertyIsEnumerable;var pe=(e,t,r)=>t in e?nt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,W=(e,t)=>{for(var r in t||(t={}))st.call(t,r)&&pe(e,r,t[r]);if(ze)for(var r of ze(t))it.call(t,r)&&pe(e,r,t[r]);return e},oe=(e,t)=>rt(e,ot(t));var _e=(e,t,r)=>(pe(e,typeof t!="symbol"?t+"":t,r),r),ye=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var se=(e,t,r)=>(ye(e,t,"read from private field"),r?r.call(e):t.get(e)),ge=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},Oe=(e,t,r,o)=>(ye(e,t,"write to private field"),o?o.call(e,r):t.set(e,r),r);var Ce=(e,t,r)=>(ye(e,t,"access private method"),r);import{C as at,R as ct,a as lt,D as dt,F as ut,A as ft,m as ht,j as ue,c as Te,b as z,r as w,n as ie,d as pt,e as yt,L as gt,E as mt,f as wt,g as xt,h as Dt,i as Et}from"./vendor.cf674247.js";const Tt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}};Tt();const Pe={theme:"outline",size:"20",fill:"#333"},me=[{type:"selection",Icon:at},{type:"rectangle",Icon:ct},{type:"circle",Icon:lt},{type:"diamond",Icon:dt},{type:"text",Icon:ut},{type:"arrow",Icon:ft}],we="emodraw",Be="Segoe UI Emoji",G=15,xe=G+3,St="#fff",L={default:"default",crosshair:"crosshair",move:"move",grab:"grab",neswResize:"nesw-resize",nwseResize:"nwse-resize"},Rt=30,F=3,J=8,bt=[15,10],ae=10,Ne=20,ce=30,It="emodraw.png",Lt="emodraw",K=["rectangle","circle","diamond"],$=(e,t,r,o,n)=>{e.beginPath(),e.moveTo(t,r),e.lineTo(t+o,r),e.lineTo(t+o,r+n),e.lineTo(t,r+n),e.closePath(),e.stroke()},vt=(e,t,r,o,n)=>{e.save(),e.fillStyle="rgba(255,165,0,0.5)",e.fillRect(t,r,o,n),e.restore()},At=(e,t,r,o,n)=>{const s=o>n?1/o:1/n;e.beginPath(),e.moveTo(t+o,r);for(let l=0;l<Math.PI*2;l+=s)e.lineTo(t+o*Math.cos(l),r+n*Math.sin(l));e.closePath(),e.stroke()},Mt=(e,t,r,o,n)=>{e.beginPath(),e.moveTo(t+o/2,r+n),e.lineTo(t+o,r+n/2),e.lineTo(t+o/2,r),e.lineTo(t,r+n/2),e.closePath(),e.stroke()},zt=(e,t)=>Math.floor(180/(Math.PI/Math.atan(e/t))),ke=30,_t=(e,t,r,o,n)=>{const s=Math.min(Math.pow(o*o+n*n,.5)/2,Rt),l=n<0?-s:s,y=zt(o,n),a=y+ke,g=y-ke,x=t+o,T=r+n,D=x-l*Math.sin(Math.PI*a/180),M=T-l*Math.cos(Math.PI*a/180),v=x-l*Math.sin(Math.PI*g/180),V=T-l*Math.cos(Math.PI*g/180);e.beginPath(),e.moveTo(t,r),e.lineTo(x,T),e.lineTo(D,M),e.moveTo(x,T),e.lineTo(v,V),e.stroke()},Ot=(e,t)=>{const{type:r,x:o,y:n,width:s,height:l}=t;switch(r){case"rectangle":$(e,o,n,s,l);return;case"circle":At(e,o+s/2,n+l/2,Math.abs(s/2),Math.abs(l/2));return;case"arrow":_t(e,o,n,s,l);return;case"diamond":Mt(e,o,n,s,l);return;case"selection":vt(e,o,n,s,l);return}},Ct=(e,t)=>{const{content:r,x:o,y:n,containerId:s,width:l}=t;e.textBaseline="bottom",e.font=`${G}px  ${Be}`,be(r).forEach((a,g)=>{if(s){const x=e.measureText(a).width;e.fillText(a,o+(l-x)/2,n+G*(g+1))}else e.fillText(a,o,n+G*(g+1))})},He=(e,{x:t,y:r,width:o,height:n,type:s},l)=>{const y=o>0?F:-F,a=n>0?F:-F,g=t-y,x=t+o+y,T=r-a,D=r+n+a;if(e.setLineDash(bt),e.beginPath(),e.moveTo(g,T),e.lineTo(x,T),e.lineTo(x,D),e.lineTo(g,D),e.closePath(),e.stroke(),e.setLineDash([]),!l){const M=o>0?J:-J,v=n>0?J:-J;s!=="text"&&($(e,g,T,-M,-v),$(e,x,D,M,v),s!=="arrow"&&($(e,x,T,M,-v),$(e,g,D,-M,v)))}},Pt=e=>{const t=c.getSelectionData();if(!t)return;const[r,o,n,s]=t;He(e,{x:r,y:n,width:o-r,height:s-n,type:"selection"},!1)},Se=(e,t=c.data)=>{let r=!1;c.data.filter(n=>n.isSelected).length>1&&(Pt(e),r=!0),t.forEach(n=>{n.isSelected&&He(e,n,r),n.type==="text"?Ct(e,n):Ot(e,n)})};var U,fe,kt;class Nt{constructor(){ge(this,fe);_e(this,"data");ge(this,U,void 0);this.data=Ce(this,fe,kt).call(this),Oe(this,U,[])}addOperateStack(t){se(this,U).push(t)}getSelectionData(){const t=this.data.filter(r=>r.isSelected);if(t.length===1&&t[0].type==="text")return null;if(t.length===1&&t[0].type==="arrow"){const r=t[0];return[r.x,r.x+r.width,r.y,r.y+r.height,!0]}return[...Re(t),!1]}addDrawData(t){this.data.push(t)}popDrawData(){this.data.pop()}revokeDrawData(){if(se(this,U).length>0){const t=se(this,U).pop();if(t.type==="DELETE"&&this.data.push(...t.payload),t.type==="ADD"&&(this.data=this.data.filter(r=>!t.selectedIds.includes(r.id))),t.type==="MOVE"){const{x:r,y:o}=t.payload;this.data.forEach(n=>n.isSelected=!1),this.data.filter(n=>t.selectedIds.includes(n.id)).forEach(n=>{n.x-=r,n.y-=o,n.isSelected=!0})}if(t.type==="RESIZE"){const r=t.payload,o=r.map(n=>n.id);this.data=this.data.filter(n=>!o.includes(n.id)).concat(r)}t.type==="SET"&&(this.data=t.payload),this.storageDrawData()}}storageDrawData(){this.data=this.data.filter(t=>t.type!=="selection").map(t=>{if(t.type==="arrow")return t;const r=W({},t);return r.width<0&&(r.x=r.x+r.width,r.width=-r.width),r.height<0&&(r.y=r.y+r.height,r.height=-r.height),r}),localStorage.setItem(we,JSON.stringify(this.data))}delete(){const t=[];this.data.forEach(r=>{r.isSelected&&(r.isDeleted=!0,K.includes(r.type)&&r.boundElement.forEach(o=>{this.data.find(n=>n.id===o.id).isDeleted=!0}))}),this.data=this.data.filter(r=>r.isDeleted?(t.push(oe(W({},r),{isSelected:!1,isDeleted:!1})),!1):!0),this.addOperateStack({type:"DELETE",payload:t}),this.storageDrawData()}}U=new WeakMap,fe=new WeakSet,kt=function(){let t;try{t=JSON.parse(localStorage.getItem(we))||[]}catch{t=[],localStorage.setItem(we,"[]")}return t};var c=new Nt;const Fe=()=>document.querySelector("textarea")?null:document.createElement("textarea"),Ge=(e,t)=>{Object.assign(e.style,W({position:"absolute",margin:0,padding:0,border:0,outline:0,background:"transparent",resize:"none",fontSize:G+"px",lineHeight:"1em",fontFamily:Be,overflow:"hidden"},t))},Ue=(e,{oninput:t,onChange:r})=>{e.onkeydown=o=>{o.stopPropagation()},e.oninput=()=>{e.style.height=e.scrollHeight+"px",t==null||t()},e.onblur=o=>{r(o.target.value),document.body.removeChild(e)},setTimeout(()=>{e.focus()})},Xt=(e,t,r)=>{const o=Fe();if(!o)return;if(Ge(o,{top:e.y+e.height/2-xe+"px",left:e.x+"px",width:e.width+"px",height:xe+"px",textAlign:"center"}),r){const s=r.content;o.value=s,o.setSelectionRange(0,s.length),o.style.height=r.height+"px",o.style.top=e.y+e.height/2-r.height/2+"px"}const n=()=>{const[s]=Je(o.value,e.width);return s.length};Ue(o,{oninput:()=>{const s=n();o.style.height=s*xe+"px",o.style.top=e.y+e.height/2-s*G/2+"px"},onChange:s=>{t(s,G*n())}}),document.body.appendChild(o)},Yt=({x:e,y:t},r,o)=>{const n=Fe();if(!!n){if(o){const s=o.content;n.value=s,n.setSelectionRange(0,s.length),n.style.height=o.height+"px"}Ge(n,{top:t+"px",left:e+"px",width:`${window.innerWidth-e}px`,whiteSpace:"nowrap"}),Ue(n,{onChange:r}),document.body.appendChild(n)}},R=5,Wt=e=>e>R?e-R:0,le=e=>e+R<window.innerWidth?e+R:window.innerWidth,de=e=>e+R<window.innerWidth?e+R:window.innerWidth,B=(e,t,r)=>e>=Wt(t)&&e<=r,De=(e,t,r,o)=>Math.pow(Math.pow(Math.abs(e-t),2)+Math.pow(Math.abs(r-o),2),1/2),je=({x:e,y:t})=>{const r=c.data.filter(o=>K.includes(o.type)&&o.boundElement.length!==0);for(let o=0;o<r.length;o++){const n=r[o];if(n.type==="rectangle"&&e>=n.x-R&&e<=n.x+n.width+R&&t>=n.y-R&&t<=n.y+n.height+R)return n.id;if(n.type==="diamond"){const s=n.width*n.height,l=Math.abs(e-(n.x+n.width/2)),y=Math.abs(t-(n.y+n.height/2)),a=((l+R)*n.height+(y+R)*n.width)*2;if(e>=n.x-R&&e<=n.x+n.width+R&&t>=n.y-R&&t<=n.y+n.height+R&&a<=s)return n.id}if(n.type==="circle"){const s=n.x+n.width/2,l=n.y+n.height/2,y=n.width/2,a=n.height/2;if(Math.pow(e-s,2)/Math.pow(y,2)+Math.pow(t-l,2)/Math.pow(a,2)<=1)return n.id}}return null},Ee=({x:e,y:t})=>{for(let o=0;o<c.data.length;o++){const n=c.data[o];if(n.type==="text"&&n.containerId!==null)continue;const s=n.x,l=n.x+n.width,y=n.y,a=n.y+n.height;if(n.isSelected){const g=n.width>0?l:s,x=n.width>0?s:l,T=n.height>0?a:y,D=n.height>0?y:a;if(e>=x&&e<=g&&t>=D&&t<=T)return n.id}if(n.type==="text"&&B(e,s,le(l))&&B(t,y,de(a))||n.type==="rectangle"&&((B(e,s,le(s))||B(e,l,le(l)))&&B(t,y,de(a))||(B(t,y,de(y))||B(t,a,de(a)))&&B(e,s,le(l))))return n.id;if(n.type==="diamond"){const g=n.width*n.height,x=Math.abs(e-(s+n.width/2)),T=Math.abs(t-(y+n.height/2)),D=((x+R)*n.height+(T+R)*n.width)*2,M=((x-R)*n.height+(T-R)*n.width)*2;if(D>=g&&M<=g)return n.id}if(n.type==="circle"){const g=s+n.width/2,x=y+n.height/2,T=n.width/2,D=n.height/2,M=Math.pow(e-g,2)/Math.pow(T,2)+Math.pow(t-x,2)/Math.pow(D,2);if(M<=1.1&&M>=.9)return n.id}if(n.type==="arrow"){const g=Math.round(De(s,l,y,a)),x=Math.round(De(e,s,t,y)+De(e,l,t,a));if(x>=g-R/2&&x<=g+R/2)return n.id}}const r=je({x:e,y:t});return r||null},Bt=(e,t,r,o)=>{const[n,s]=r>0?[e+r,e]:[e,e+r],[l,y]=o>0?[t+o,t]:[t,t+o];return c.data.filter(a=>{if(a.type==="selection"||a.type==="text"&&a.containerId!==null)return!1;const[g,x]=a.width>0?[a.x+a.width,a.x]:[a.x,a.x+a.width],[T,D]=a.height>0?[a.y+a.height,a.y]:[a.y,a.y+a.height];return n>=g&&s<=x&&l>=T&&y<=D}).map(({id:a})=>a)},Xe=(e,t)=>{const r=c.getSelectionData();if(!r)return!1;const[o,n,s,l]=r;return e<=o&&e>=n&&t<=s&&t>=l},S=(e,t,r)=>r?e>=t+F&&e<=t+J+F:e<=t-F&&e>=t-J-F,Ye=({x:e,y:t})=>{const r=c.getSelectionData();if(!r)return null;const[o,n,s,l,y]=r;if(y){if(o>=n&&s>l){if(S(e,n,!1)&&S(t,l,!1))return[L.nwseResize,"top"];if(S(e,o,!0)&&S(t,s,!0))return[L.nwseResize,"bottom"]}else if(o>=n&&s<l){if(S(e,n,!1)&&S(t,l,!0))return[L.neswResize,"bottom"];if(S(e,o,!0)&&S(t,s,!1))return[L.neswResize,"top"]}else if(o<n&&s>l){if(S(e,n,!0)&&S(t,l,!1))return[L.neswResize,"top"];if(S(e,o,!1)&&S(t,s,!0))return[L.neswResize,"bottom"]}else{if(S(e,o,!1)&&S(t,s,!1))return[L.nwseResize,"top"];if(S(e,n,!0)&&S(t,l,!0))return[L.nwseResize,"bottom"]}return null}return S(e,n,!1)&&S(t,l,!1)?[L.nwseResize,"top"]:S(e,o,!0)&&S(t,s,!0)?[L.nwseResize,"bottom"]:S(e,n,!1)&&S(t,s,!0)?[L.neswResize,"bottom"]:S(e,o,!0)&&S(t,l,!1)?[L.neswResize,"top"]:null},Ht=({x:e,y:t})=>{const r=c.data.filter(o=>o.type==="text");for(let o=0;o<r.length;o++){const n=r[o];if(e>=n.x&&e<=n.x+n.width&&t>=n.y&&t<=n.y+n.height)return n}return null},Re=e=>{let t=-1/0,r=-1/0,o=1/0,n=1/0;return e.forEach(s=>{const[l,y]=s.width>0?[s.x+s.width,s.x]:[s.x,s.x+s.width],[a,g]=s.height>0?[s.y+s.height,s.y]:[s.y,s.y+s.height];l>t&&(t=l),a>r&&(r=a),y<o&&(o=y),g<n&&(n=g)}),[t,o,r,n]},Ft=({x:e,y:t})=>{let r=null;return c.data.forEach(o=>{const n=o.x+o.width/2,s=o.y+o.height/2;K.includes(o.type)&&e<=n+ae&&e>=n-ae&&t<=s+ae&&t>=s-ae&&(r?o.width<r.width&&(r=o):r=o)}),r},be=e=>e.replace(/\r\n?/g,`
`).split(`
`),Gt=e=>{const t="\uFEFF",r=new Blob([t+e],{type:"text/json"});return URL.createObjectURL(r)},Je=(e,t,r)=>{const o=r!=null?r:document.createElement("canvas").getContext("2d"),n=[];be(e).forEach(y=>{let a="",g=0;for(let x=1;x<=y.length;x++){a=y.substring(g,x);const{width:T}=o.measureText(a);T>t&&(n.push(y.substring(g,x-1)),g=x-1)}n.push(a)});let l=0;return n.forEach(y=>{const{width:a}=o.measureText(y);a>l&&(l=a)}),[n,l]},We=(e,t)=>{const r=document.createElement("a");r.download=t,r.href=e,document.body.appendChild(r),r.click(),document.body.removeChild(r)};var N=ht();const Ut="_container_1dwzc_1",jt="_element_1dwzc_10",Jt="_operate_1dwzc_14",Kt="_active_1dwzc_30";var H={container:Ut,element:jt,operate:Jt,"tool-item":"_tool-item_1dwzc_17",active:Kt,"tool-index":"_tool-index_1dwzc_33"};const Vt=({Icon:e,index:t,changeType:r,isActive:o})=>ue("div",{className:Te(H["tool-item"],{[H.active]:o}),onClick:r,children:[z("div",{children:e}),z("div",{className:H["tool-index"],children:t})]}),Zt=(e,t)=>{w.exports.useEffect(()=>{const r=()=>{!e.current||!t.current||(e.current.width=window.innerWidth,e.current.height=window.innerHeight,Se(t.current))};return r(),window.addEventListener("resize",r),()=>document.removeEventListener("resize",r)},[])},Ke=e=>{w.exports.useEffect(()=>{const t=r=>{const{key:o,metaKey:n}=r;e(o,n)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[])},Ie=w.exports.createContext({}),$t=({children:e})=>{const[t,r]=w.exports.useState("selection");return z(Ie.Provider,{value:{drawType:t,setDrawType:r},children:e})},Le=w.exports.createContext({}),qt=({children:e})=>{const[t,r]=w.exports.useState(L.default);return z(Le.Provider,{value:{cursorType:t,setCursorType:r},children:e})},Qt=e=>{const{drawType:t,setDrawType:r}=w.exports.useContext(Ie),{cursorType:o,setCursorType:n}=w.exports.useContext(Le),s=w.exports.useRef(!1),l=w.exports.useRef(!1),y=w.exports.useRef(!1),a=w.exports.useRef(!1),g=w.exports.useRef(),x=w.exports.useRef(),T=w.exports.useRef(),D=w.exports.useRef({x:0,y:0}),M=w.exports.useRef({x:0,y:0}),v=w.exports.useRef({x:0,y:0}),V=w.exports.useRef([]),j=w.exports.useRef([]),he=w.exports.useRef({x:0,y:0}),q=w.exports.useRef(!1),O=()=>{e.current&&(e.current.clearRect(0,0,window.innerWidth,window.innerHeight),Se(e.current))},Z=()=>{c.data.forEach(u=>u.isSelected=!1)};w.exports.useEffect(()=>{const u=()=>{c.addOperateStack({type:"DELETE",payload:c.data}),c.data=[],c.storageDrawData(),O()},d=()=>{if(c.data.length===0)return;const f=document.createElement("canvas"),[h,m,E,b]=Re(c.data),A=h-m+ce,_=E-b+ce;f.width=A,f.height=_;const C=f.getContext("2d");C.save(),C.fillStyle=St,C.fillRect(0,0,A,_),C.restore(),Se(C,c.data.map(I=>oe(W({},I),{x:I.x-m+ce/2,y:I.y-b+ce/2})));const Y=f.toDataURL();We(Y,It)},i=()=>{if(c.data.length===0)return;const f=Gt(JSON.stringify(c.data));We(f,Lt)},p=()=>{const f=document.createElement("input");f.type="file",document.body.appendChild(f),f.click(),f.onchange=h=>{const E=h.target.files[0],b=new FileReader;b.onload=A=>{try{const _=JSON.parse(A.target.result);c.addOperateStack({type:"SET",payload:c.data}),c.data=_,c.storageDrawData(),O()}catch{}},b.readAsText(E),document.body.removeChild(f)}};return N.on("exportImage",d),N.on("exportData",i),N.on("clear",u),N.on("import",p),()=>{N.off("import",p),N.off("exportData",i),N.off("exportImage",d),N.off("clear",u)}},[]),w.exports.useEffect(()=>{const u=()=>{j.current=[],c.data.forEach(i=>{if(i.isSelected&&(j.current.push(i),K.includes(i.type))){const p=i.boundElement.find(f=>f.type==="text");if(p){const f=c.data.find(h=>h.id===p.id);j.current.push(f)}}})},d=()=>{if(j.current.length>0&&!q.current){const[i,p,f,h]=Re(j.current),[m,E]=[(i+p)/2,(f+h)/2],[b,A]=[he.current.x-m,he.current.y-E];Z();const _=[],C={},Y=[];j.current.forEach(I=>{const P=ie();let k=!0;I.type==="text"&&I.containerId&&(C[I.id]=P,k=!1),Y.push(oe(W({},pt(I)),{id:P,x:I.x+b,y:I.y+A,isSelected:k})),_.push(P)}),Y.filter(I=>K.includes(I.type)).forEach(I=>{const P=I.boundElement.find(k=>k.type==="text");if(P){P.id=C[P.id];const k=Y.find(re=>re.id===P.id);k.containerId=I.id}}),Y.forEach(I=>c.addDrawData(I)),Y.length>1&&(a.current=!0),c.addOperateStack({type:"ADD",selectedIds:_}),c.storageDrawData(),O()}};return document.addEventListener("copy",u),document.addEventListener("paste",d),()=>{document.removeEventListener("copy",u),document.addEventListener("paste",d)}},[]);const Ve=(u,d,i)=>{u.type==="arrow"?x.current==="head"?(u.width+=d,u.height+=i):(u.x+=d,u.y+=i,u.width-=d,u.height-=i):o==="nesw-resize"?g.current==="top"?(u.y+=i,u.width+=d,u.height-=i):(u.height+=i,u.x+=d,u.width-=d):o==="nwse-resize"&&(g.current==="top"?(u.x+=d,u.y+=i,u.width-=d,u.height-=i):(u.width+=d,u.height+=i))},Ze=(u,d,i)=>{const{x:p,y:f}=M.current,h={x:0,y:0},m=d-p,E=i-f,b=c.getSelectionData(),A=b[0]-b[1],_=b[2]-b[3],C=g.current==="top",Y=C&&o==="nesw-resize"||g.current==="bottom"&&o==="nwse-resize",I=g.current==="bottom"&&o==="nesw-resize"||C&&o==="nwse-resize";if(A<=Ne&&(m<=v.current.x&&Y||m>=v.current.x&&I)||_<=Ne&&(E<=v.current.y&&g.current==="bottom"||E>=v.current.y&&C))return;let P=0,k=0;const re=Math.abs(m)>Math.abs(E);P=re?o==="nesw-resize"?-E:E:m,k=re?E:o==="nesw-resize"?-m:m,h.x=b[Y?1:0],h.y=b[C?2:3],u.forEach(X=>{const Ae=Math.abs(X.x-h.x)/A,et=Math.abs(X.x+X.width-h.x)/A,Me=Math.abs(X.y-h.y)/_,tt=Math.abs(X.y+X.height-h.y)/_;X.x+=(P-v.current.x)*Ae,X.y+=(k-v.current.y)*Me,X.type!=="text"&&(X.width+=(P-v.current.x)*(et-Ae),X.height+=(k-v.current.y)*(tt-Me))}),v.current={x:P,y:k}},$e=(u,d,i)=>{u.length===1?Ve(u[0],d-D.current.x,i-D.current.y):Ze(u,d,i)},qe=(u,d,i)=>{u.forEach(p=>{p.x+=d,p.y+=i})},ve=u=>{q.current=!0;let d=Ht(u),i=null;if(d){const f=d.containerId;f&&(i=c.data.find(h=>h.id===f),i.boundElement=i.boundElement.filter(h=>h.id!==d.id))}else{const f=je(u);if(f){i=c.data.find(m=>m.id===f);const h=i.boundElement.find(m=>m.type==="text");d=c.data.find(m=>m.id===h.id),i.boundElement=i.boundElement.filter(m=>m.id!==h.id)}}d&&(c.data=c.data.filter(f=>f.id!==d.id),O()),!i&&!d&&(i=Ft(u));const p=ie();if(i)Xt(i,(f,h)=>{if(i=i,q.current=!1,f.trim()&&e.current){const[m,E]=Je(f,i.width,e.current),b=i.y+i.height/2-h/2;c.addDrawData({type:"text",id:p,x:i.x+(i.width-E)/2,y:b,content:m.join(`
`),width:E,height:h,isSelected:!1,isDeleted:!1,containerId:i.id}),i.boundElement.push({type:"text",id:p}),c.addOperateStack({type:"ADD",selectedIds:[p]}),c.storageDrawData(),O()}},d);else{const f=d?{x:d.x,y:d.y}:u;Yt(f,h=>{if(q.current=!1,h.trim()){const m=be(h);let E=0;m.forEach(b=>{if(e.current){const{width:A}=e.current.measureText(b);A>E&&(E=A)}}),c.addDrawData({type:"text",id:p,x:f.x,y:f.y,content:h,width:E,height:m.length*G,isSelected:!1,isDeleted:!1,containerId:null}),c.addOperateStack({type:"ADD",selectedIds:[p]}),c.storageDrawData(),O()}},d)}},Q=w.exports.useRef();Q.current=(u,d)=>{t==="selection"&&(Z(),ve({x:u,y:d}))},w.exports.useEffect(()=>{const u=({pageX:d,pageY:i})=>{var p;(p=Q.current)==null||p.call(Q,d,i)};return document.addEventListener("dblclick",u),()=>document.removeEventListener("dblclick",u)},[]),w.exports.useEffect(()=>{n(t==="selection"?L.default:L.crosshair),t!=="selection"&&Z()},[t]),Ke((u,d)=>{d&&u==="z"&&(c.revokeDrawData(),O()),d&&u==="a"&&(c.data.forEach(i=>i.isSelected=!0),c.data.length>1&&(a.current=!0),c.storageDrawData(),O()),u==="Backspace"&&(c.delete(),O())});const Qe=()=>{T.current=void 0,y.current=!1,v.current={x:0,y:0},V.current=[]},ee=w.exports.useRef();ee.current=u=>{if(u.button===2)return;const{pageX:d,pageY:i}=u;if(D.current=M.current={x:d,y:i},t==="text")r("selection"),ve({x:d,y:i});else if(t==="selection"){if(s.current=!0,a.current&&Xe(d,i)){l.current=!0;return}const p=Ye({x:d,y:i});if(p){g.current=p[1],l.current=!0;const h=c.data.filter(m=>m.isSelected);if(V.current=h.map(m=>W({},m)),h.length===1&&h[0].type==="arrow"){const m=h[0];x.current=m.height<=0&&g.current==="top"||m.height>0&&g.current==="bottom"?"head":"foot"}return}const f=Ee({x:d,y:i});Z(),l.current=!1,f?(c.data.find(h=>h.id===f).isSelected=!0,l.current=!0,c.storageDrawData()):(c.addDrawData({type:t,id:ie(),x:d,y:i,width:0,height:0,isSelected:!1,isDeleted:!1}),O())}else s.current=!0,c.addDrawData({type:t,id:ie(),x:d,y:i,width:0,height:0,isSelected:!1,isDeleted:!1,boundElement:[]})};const te=w.exports.useRef();te.current=u=>{const{pageX:d,pageY:i}=u;if(he.current={x:d,y:i},!s.current){const h=Ye({x:d,y:i});if(h){n(h[0]);return}if(t==="selection"){const m=a.current?Xe(d,i):Ee({x:d,y:i});n(m?L.move:L.default)}return}const p=d-D.current.x,f=i-D.current.y;if(t==="selection"&&l.current){const h=c.data.filter(E=>E.isSelected);h.forEach(E=>{K.includes(E.type)&&E.boundElement.filter(A=>A.type==="text").forEach(A=>{h.push(c.data.find(_=>_.id===A.id))})});const m=["nesw-resize","nwse-resize"].includes(o);m?$e(h,d,i):qe(h,p,f),(d!==D.current.x||i!==D.current.y)&&(T.current=m?"resize":"move",D.current={x:d,y:i})}else{const h=c.data[c.data.length-1];if(h.type!=="text"&&(h.width=p,h.height=f),h.type==="selection"){y.current=!0;const m=Bt(D.current.x,D.current.y,p,f);a.current=m.length>1,c.data.forEach(E=>{E.isSelected=m.includes(E.id)})}}O()};const ne=w.exports.useRef();ne.current=u=>{if(!s.current)return;s.current=!1;const{pageX:d,pageY:i}=u;if(d===D.current.x&&i===D.current.y)t!=="selection"&&c.popDrawData(),T.current?T.current==="move"?c.addOperateStack({type:"MOVE",selectedIds:c.data.filter(p=>p.isSelected).map(p=>p.id),payload:{x:d-M.current.x,y:i-M.current.y}}):c.addOperateStack({type:"RESIZE",payload:V.current}):a.current=!1;else{const p=c.data[c.data.length-1];t!=="selection"?(p.isSelected=!0,c.addOperateStack({type:"ADD",selectedIds:[p.id]}),r("selection")):p.type==="selection"&&c.popDrawData(),O()}if(t==="selection"&&!T.current&&!y.current){Z();const p=Ee({x:d,y:i});p?c.data.find(f=>f.id===p).isSelected=!0:n(L.default),O()}Qe(),c.storageDrawData()},w.exports.useEffect(()=>{const u=p=>{var f;(f=te.current)==null||f.call(te,p)},d=p=>{var f;(f=ee.current)==null||f.call(ee,p)},i=p=>{var f;(f=ne.current)==null||f.call(ne,p)};return document.addEventListener("mousedown",d),document.addEventListener("mousemove",u),document.addEventListener("mouseup",i),()=>{document.removeEventListener("mousedown",d),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",i)}},[])},en=()=>{const{drawType:e,setDrawType:t}=w.exports.useContext(Ie);Ke(y=>{const a=+y-1;!isNaN(a)&&a!==-1&&a<me.length&&t(me[a].type)});const r=(y,a)=>z("div",{className:H["tool-item"],onClick:a,children:z(y,W({},Pe))}),o=()=>{N.emit("clear")},n=()=>{N.emit("import")},s=()=>{N.emit("exportData")},l=()=>{N.emit("exportImage")};return ue(yt,{children:[z("div",{className:Te(H.container,H.element),children:me.map(({Icon:y,type:a},g)=>z(Vt,{isActive:a===e,Icon:z(y,W({},Pe)),index:g+1,changeType:()=>t(a)},g))}),ue("div",{className:Te(H.container,H.operate),children:[r(xt,o),r(gt,n),r(mt,s),r(wt,l)]})]})};function tn(){const e=w.exports.useRef(null),t=w.exports.useRef(null),{cursorType:r}=w.exports.useContext(Le);return w.exports.useEffect(()=>{e.current&&(t.current=e.current.getContext("2d"))},[]),Qt(t),Zt(e,t),ue("div",{className:"App",style:{position:"relative",cursor:r},children:[z(en,{}),z("canvas",{ref:e,id:"canvas"})]})}Dt.render(z(Et.StrictMode,{children:z($t,{children:z(qt,{children:z(tn,{})})})}),document.getElementById("root"));
