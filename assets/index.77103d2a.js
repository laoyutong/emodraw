var me=Object.defineProperty,ye=Object.defineProperties;var De=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var K=(e,t,n)=>t in e?me(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,H=(e,t)=>{for(var n in t||(t={}))Se.call(t,n)&&K(e,n,t[n]);if(re)for(var n of re(t))Te.call(t,n)&&K(e,n,t[n]);return e},se=(e,t)=>ye(e,De(t));var oe=(e,t,n)=>(K(e,typeof t!="symbol"?t+"":t,n),n),U=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)};var G=(e,t,n)=>(U(e,t,"read from private field"),n?n.call(e):t.get(e)),$=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},ie=(e,t,n,r)=>(U(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);var ae=(e,t,n)=>(U(e,t,"access private method"),n);import{C as Ee,R as xe,a as Re,D as ve,F as Me,A as Ie,j as ce,c as be,b as M,r as p,n as q,d as Le,e as ze}from"./vendor.779914d6.js";const Ae=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}};Ae();const Oe={theme:"outline",size:"20",fill:"#333"},J=[{type:"selection",Icon:Ee},{type:"rectangle",Icon:xe},{type:"circle",Icon:Re},{type:"diamond",Icon:ve},{type:"text",Icon:Me},{type:"arrow",Icon:Ie}],_e="_container_zx2b4_1",Pe="_active_zx2b4_25";var _={container:_e,"tool-item":"_tool-item_zx2b4_12",active:Pe,"tool-index":"_tool-index_zx2b4_28"};const ke=({Icon:e,index:t,changeType:n,isActive:r})=>ce("div",{className:be(_["tool-item"],{[_.active]:r}),onClick:n,children:[M("div",{className:_["tool-icon"],children:e}),M("div",{className:_["tool-index"],children:t})]}),Z="emodraw",le="Segoe UI Emoji",j=15,R={default:"default",crosshair:"crosshair",move:"move",grab:"grab",neswResize:"nesw-resize",nwseResize:"nwse-resize"},Ce=30,z=3,O=8,Ne=[15,10],P=(e,t,n,r,s)=>{e.beginPath(),e.moveTo(t,n),e.lineTo(t+r,n),e.lineTo(t+r,n+s),e.lineTo(t,n+s),e.closePath(),e.stroke()},Ye=(e,t,n,r,s)=>{e.save(),e.fillStyle="rgba(255,165,0,0.5)",e.fillRect(t,n,r,s),e.restore()},Xe=(e,t,n,r,s)=>{const o=r>s?1/r:1/s;e.beginPath(),e.moveTo(t+r,n);for(let i=0;i<Math.PI*2;i+=o)e.lineTo(t+r*Math.cos(i),n+s*Math.sin(i));e.closePath(),e.stroke()},We=(e,t,n,r,s)=>{e.beginPath(),e.moveTo(t+r/2,n+s),e.lineTo(t+r,n+s/2),e.lineTo(t+r/2,n),e.lineTo(t,n+s/2),e.closePath(),e.stroke()},Fe=(e,t)=>Math.floor(180/(Math.PI/Math.atan(e/t))),de=30,He=(e,t,n,r,s)=>{const o=Math.min(Math.pow(r*r+s*s,1/2)/2,Ce),i=s<0?-o:o,D=Fe(r,s),c=D+de,w=D-de,g=t+r,m=n+s,S=g-i*Math.sin(Math.PI*c/180),v=m-i*Math.cos(Math.PI*c/180),x=g-i*Math.sin(Math.PI*w/180),L=m-i*Math.cos(Math.PI*w/180);e.beginPath(),e.moveTo(t,n),e.lineTo(g,m),e.lineTo(S,v),e.moveTo(g,m),e.lineTo(x,L),e.stroke()},Ge=(e,t)=>{const{type:n,x:r,y:s,width:o,height:i}=t;switch(n){case"rectangle":P(e,r,s,o,i);return;case"circle":Xe(e,r+o/2,s+i/2,Math.abs(o/2),Math.abs(i/2));return;case"arrow":He(e,r,s,o,i);return;case"diamond":We(e,r,s,o,i);return;case"selection":Ye(e,r,s,o,i);return}},je=(e,t)=>{const{content:n,x:r,y:s}=t;e.textBaseline="bottom",e.font=`${j}px  ${le}`,we(n).forEach((o,i)=>{e.fillText(o,r,s+j*(i+1))})},ue=(e,{x:t,y:n,width:r,height:s,type:o},i)=>{const D=r>0?z:-z,c=s>0?z:-z,w=t-D,g=t+r+D,m=n-c,S=n+s+c;if(e.setLineDash(Ne),e.beginPath(),e.moveTo(w,m),e.lineTo(g,m),e.lineTo(g,S),e.lineTo(w,S),e.closePath(),e.stroke(),e.setLineDash([]),!i){const v=r>0?O:-O,x=s>0?O:-O;o!=="text"&&(P(e,w,m,-v,-x),P(e,g,S,v,x),o!=="arrow"&&(P(e,g,m,v,-x),P(e,w,S,-v,x)))}},Be=e=>{const[t,n,r,s]=l.getSelectionData();ue(e,{x:t,y:r,width:n-t,height:s-r,type:"selection"},!1)},fe=e=>{let t=!1;l.data.filter(r=>r.isSelected).length>1&&(Be(e),t=!0),l.data.forEach(r=>{r.isSelected&&ue(e,r,t),r.type==="text"?je(e,r):Ge(e,r)})};var A,B,Ue;class Ke{constructor(){$(this,B);oe(this,"data");$(this,A,void 0);this.data=ae(this,B,Ue).call(this),ie(this,A,[])}addOperateStack(t){G(this,A).push(t)}getSelectionData(){let t=-1/0,n=-1/0,r=1/0,s=1/0;const o=this.data.filter(i=>i.isSelected);if(o.length===1&&o[0].type==="arrow"){const i=o[0];return[i.x,i.x+i.width,i.y,i.y+i.height,!0]}return o.forEach(i=>{const[D,c]=i.width>0?[i.x+i.width,i.x]:[i.x,i.x+i.width],[w,g]=i.height>0?[i.y+i.height,i.y]:[i.y,i.y+i.height];D>t&&(t=D),w>n&&(n=w),c<r&&(r=c),g<s&&(s=g)}),[t,r,n,s,!1]}addDrawData(t){this.data.push(t)}popDrawData(){this.data.pop()}revokeDrawData(){if(G(this,A).length>0){const t=G(this,A).pop();if(t.type==="DELETE"&&this.data.push(...t.payload),t.type==="ADD"&&(this.data=this.data.filter(n=>t.selectedIds!==n.id)),t.type==="MOVE"){const{x:n,y:r}=t.payload;this.data.forEach(s=>s.isSelected=!1),this.data.filter(s=>t.selectedIds.includes(s.id)).forEach(s=>{s.x-=n,s.y-=r,s.isSelected=!0})}t.type==="RESIZE",this.storageDrawData()}}storageDrawData(){this.data=this.data.filter(t=>t.type!=="selection").map(t=>{if(t.type==="arrow")return t;const n=H({},t);return n.width<0&&(n.x=n.x+n.width,n.width=-n.width),n.height<0&&(n.y=n.y+n.height,n.height=-n.height),n}),localStorage.setItem(Z,JSON.stringify(this.data))}delete(){const t=[];this.data=this.data.filter(n=>n.isSelected?(t.push(se(H({},n),{isSelected:!1})),!1):!0),this.addOperateStack({type:"DELETE",payload:t}),this.storageDrawData()}}A=new WeakMap,B=new WeakSet,Ue=function(){let t;try{t=JSON.parse(localStorage.getItem(Z))||[]}catch{t=[],localStorage.setItem(Z,"[]")}return t};var l=new Ke;const $e=({x:e,y:t},n,r)=>{if(document.querySelector("textarea"))return;const o=document.createElement("textarea");Object.assign(o.style,{position:"absolute",margin:0,padding:0,border:0,outline:0,background:"transparent",resize:"none",top:t+"px",left:e+"px",fontSize:j+"px",lineHeight:"1em",fontFamily:le,width:`${window.innerWidth-e}px`,whiteSpace:"nowrap",overflowX:"hidden"}),r&&(o.value=r,o.setSelectionRange(0,r.length)),o.onkeydown=i=>{i.stopPropagation()},o.oninput=()=>{o.style.height=o.scrollHeight+"px"},o.onblur=i=>{n(i.target.value),document.body.removeChild(o)},document.body.appendChild(o),setTimeout(()=>{o.focus()})},I=5,qe=e=>e>I?e-I:0,k=e=>e+I<window.innerWidth?e+I:window.innerWidth,C=e=>e+I<window.innerWidth?e+I:window.innerWidth,b=(e,t,n)=>e>=qe(t)&&e<=n,Q=(e,t,n,r)=>Math.pow(Math.pow(Math.abs(e-t),2)+Math.pow(Math.abs(n-r),2),1/2),V=({x:e,y:t})=>{for(let n=0;n<l.data.length;n++){const r=l.data[n],s=r.x,o=r.x+r.width,i=r.y,D=r.y+r.height;if(r.isSelected){const c=r.width>0?o:s,w=r.width>0?s:o,g=r.height>0?D:i,m=r.height>0?i:D;if(e>=w&&e<=c&&t>=m&&t<=g)return r.id}if(r.type==="text"&&b(e,s,k(o))&&b(t,i,C(D))||r.type==="rectangle"&&((b(e,s,k(s))||b(e,o,k(o)))&&b(t,i,C(D))||(b(t,i,C(i))||b(t,D,C(D)))&&b(e,s,k(o))))return r.id;if(r.type==="diamond"){const c=r.width*r.height,w=Math.abs(e-(s+r.width/2)),g=Math.abs(t-(i+r.height/2)),m=((w+I)*r.height+(g+I)*r.width)*2,S=((w-I)*r.height+(g-I)*r.width)*2;if(m>=c&&S<=c)return r.id}if(r.type==="circle"){const c=s+r.width/2,w=i+r.height/2,g=Math.abs(r.width/2),m=Math.abs(r.height/2),S=g>m?1/g:1/m;for(let v=0;v<Math.PI*2;v+=S){const x=Math.round(c+g*Math.cos(v)),L=Math.round(w+m*Math.sin(v));if(b(e,x,k(x))&&b(t,L,C(L)))return r.id}}if(r.type==="arrow"){const c=Math.round(Q(s,o,i,D)),w=Math.round(Q(e,s,t,i)+Q(e,o,t,D));if(w>=c-I/2&&w<=c+I/2)return r.id}}return null},Je=(e,t,n,r)=>{const[s,o]=n>0?[e+n,e]:[e,e+n],[i,D]=r>0?[t+r,t]:[t,t+r];return l.data.filter(c=>{if(c.type==="selection")return!1;const[w,g]=c.width>0?[c.x+c.width,c.x]:[c.x,c.x+c.width],[m,S]=c.height>0?[c.y+c.height,c.y]:[c.y,c.y+c.height];return s>=w&&o<=g&&i>=m&&D<=S}).map(({id:c})=>c)},he=(e,t)=>{const[n,r,s,o]=l.getSelectionData();return e<=n&&e>=r&&t<=s&&t>=o},y=(e,t,n)=>n?e>=t+z&&e<=t+O+z:e<=t-z&&e>=t-O-z,pe=({x:e,y:t})=>{const[n,r,s,o,i]=l.getSelectionData();if(i){if(n>=r&&s>o){if(y(e,r,!1)&&y(t,o,!1))return[R.nwseResize,"top"];if(y(e,n,!0)&&y(t,s,!0))return[R.nwseResize,"bottom"]}else if(n>=r&&s<o){if(y(e,r,!1)&&y(t,o,!0))return[R.neswResize,"bottom"];if(y(e,n,!0)&&y(t,s,!1))return[R.neswResize,"top"]}else if(n<r&&s>o){if(y(e,r,!0)&&y(t,o,!1))return[R.neswResize,"top"];if(y(e,n,!1)&&y(t,s,!0))return[R.neswResize,"bottom"]}else{if(y(e,n,!1)&&y(t,s,!1))return[R.nwseResize,"top"];if(y(e,r,!0)&&y(t,o,!0))return[R.nwseResize,"bottom"]}return null}return y(e,r,!1)&&y(t,o,!1)?[R.nwseResize,"top"]:y(e,n,!0)&&y(t,s,!0)?[R.nwseResize,"bottom"]:y(e,r,!1)&&y(t,s,!0)?[R.neswResize,"bottom"]:y(e,n,!0)&&y(t,o,!1)?[R.neswResize,"top"]:null},Ze=({x:e,y:t})=>{const n=l.data.filter(r=>r.type==="text");for(let r=0;r<n.length;r++){const s=n[r];if(e>=s.x&&e<=s.x+s.width&&t>=s.y&&t<=s.y+s.height)return s}return null},we=e=>e.replace(/\r\n?/g,`
`).split(`
`).filter(t=>!!t.trim()),Qe=(e,t)=>{p.exports.useEffect(()=>{const n=()=>{!e.current||!t.current||(e.current.width=window.innerWidth,e.current.height=window.innerHeight,fe(t.current))};return n(),window.addEventListener("resize",n),()=>document.removeEventListener("resize",n)},[])},ge=e=>{p.exports.useEffect(()=>{const t=n=>{const{key:r,metaKey:s}=n;e(r,s)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[])},ee=p.exports.createContext({}),Ve=({children:e})=>{const[t,n]=p.exports.useState("selection");return M(ee.Provider,{value:{drawType:t,setDrawType:n},children:e})},te=p.exports.createContext({}),et=({children:e})=>{const[t,n]=p.exports.useState(R.default);return M(te.Provider,{value:{cursorType:t,setCursorType:n},children:e})},tt=e=>{const{drawType:t,setDrawType:n}=p.exports.useContext(ee),{cursorType:r,setCursorType:s}=p.exports.useContext(te),o=p.exports.useRef(!1),i=p.exports.useRef(!1),D=p.exports.useRef(!1),c=p.exports.useRef(!1),w=p.exports.useRef(),g=p.exports.useRef(),m=p.exports.useRef(!1),S=p.exports.useRef({x:0,y:0}),v=p.exports.useRef({x:0,y:0}),x=()=>{e.current&&(e.current.clearRect(0,0,window.innerWidth,window.innerHeight),fe(e.current))},L=({x:E,y:u},f)=>{$e({x:E,y:u},a=>{if(a.trim()){const h=we(a);let T=0;h.forEach(F=>{if(e.current){const{width:ne}=e.current.measureText(F);ne>T&&(T=ne)}});const d=q();l.addDrawData({type:"text",id:d,x:E,y:u,content:a,width:Math.floor(T),height:h.length*j,isSelected:!1}),l.addOperateStack({type:"ADD",selectedIds:d}),l.storageDrawData(),x()}},f)},N=p.exports.useRef();N.current=(E,u)=>{if(t==="selection"){const f=Ze({x:E,y:u});l.data.forEach(a=>a.isSelected=!1),f?(l.data=l.data.filter(a=>a.id!==f.id),L({x:f.x,y:f.y},f.content)):L({x:E,y:u}),x()}},p.exports.useEffect(()=>{const E=({offsetX:u,offsetY:f})=>{var a;(a=N.current)==null||a.call(N,u,f)};return document.addEventListener("dblclick",E),()=>document.removeEventListener("dblclick",E)},[]),p.exports.useEffect(()=>{s(t==="selection"?R.default:R.crosshair),t!=="selection"&&l.data.forEach(E=>E.isSelected=!1)},[t]),ge((E,u)=>{u&&E==="z"&&(l.revokeDrawData(),x()),E==="Backspace"&&(l.delete(),x())});const Y=p.exports.useRef();Y.current=E=>{const{offsetX:u,offsetY:f}=E;if(S.current=v.current={x:u,y:f},t==="text")n("selection"),L({x:u,y:f});else if(t==="selection"){if(o.current=!0,c.current&&he(u,f)){i.current=!0;return}const a=pe({x:u,y:f});if(a){w.current=a[1],i.current=!0;const T=l.data.filter(d=>d.isSelected);if(T.length===1&&T[0].type==="arrow"){const d=T[0];g.current=d.height<=0&&w.current==="top"||d.height>0&&w.current==="bottom"?"head":"foot"}return}const h=V({x:u,y:f});l.data.forEach(T=>T.isSelected=!1),i.current=!1,h?(l.data.find(T=>T.id===h).isSelected=!0,i.current=!0,l.storageDrawData()):(l.addDrawData({type:t,id:q(),x:u,y:f,width:0,height:0,isSelected:!1}),x())}else o.current=!0,l.addDrawData({type:t,id:q(),x:u,y:f,width:0,height:0,isSelected:!1})};const X=p.exports.useRef();X.current=E=>{const{offsetX:u,offsetY:f}=E;if(!o.current){const T=pe({x:u,y:f});if(T){s(T[0]);return}if(t==="selection"){const d=c.current?he(u,f):V({x:u,y:f});s(d?R.move:R.default)}return}const a=u-S.current.x,h=f-S.current.y;if(t==="selection"&&i.current){const T=l.data.filter(d=>d.isSelected);if(["nesw-resize","nwse-resize"].includes(r)){if(T.length===1){const d=T[0];d.type==="arrow"?g.current==="head"?(d.width+=a,d.height+=h):(d.x+=a,d.y+=h,d.width-=a,d.height-=h):r==="nesw-resize"?w.current==="top"?(d.y+=h,d.width+=a,d.height-=h):(d.height+=h,d.x+=a,d.width-=a):r==="nwse-resize"&&(w.current==="top"?(d.x+=a,d.y+=h,d.width-=a,d.height-=h):(d.width+=a,d.height+=h))}}else T.forEach(d=>{d.x+=a,d.y+=h});(u!==S.current.x||f!==S.current.y)&&(m.current=!0,S.current={x:u,y:f})}else{const T=l.data[l.data.length-1];if(T.type!=="text"&&(T.width=a,T.height=h),T.type==="selection"){D.current=!0;const d=Je(S.current.x,S.current.y,a,h);c.current=d.length>1,l.data.forEach(F=>{F.isSelected=d.includes(F.id)})}}x()};const W=p.exports.useRef();W.current=E=>{if(!o.current)return;o.current=!1;const{offsetX:u,offsetY:f}=E;if(u===S.current.x&&f===S.current.y)t!=="selection"&&l.popDrawData(),m.current?l.addOperateStack({type:"MOVE",selectedIds:l.data.filter(a=>a.isSelected).map(a=>a.id),payload:{x:u-v.current.x,y:f-v.current.y}}):c.current=!1;else{if(t!=="selection"){const a=l.data[l.data.length-1];a.isSelected=!0,l.addOperateStack({type:"ADD",selectedIds:a.id}),n("selection")}else l.popDrawData();x()}if(t==="selection"&&!m.current&&!D.current){l.data.forEach(h=>h.isSelected=!1);const a=V({x:u,y:f});a?l.data.find(h=>h.id===a).isSelected=!0:s(R.default),x()}m.current=!1,D.current=!1,l.storageDrawData()},p.exports.useEffect(()=>{const E=a=>{var h;(h=X.current)==null||h.call(X,a)},u=a=>{var h;(h=Y.current)==null||h.call(Y,a)},f=a=>{var h;(h=W.current)==null||h.call(W,a)};return document.addEventListener("mousedown",u),document.addEventListener("mousemove",E),document.addEventListener("mouseup",f),()=>{document.removeEventListener("mousedown",u),document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",f)}},[])},nt=()=>{const{drawType:e,setDrawType:t}=p.exports.useContext(ee);return ge(n=>{const r=+n-1;!isNaN(r)&&r!==-1&&r<J.length&&t(J[r].type)}),M("div",{className:_.container,children:J.map(({Icon:n,type:r},s)=>M(ke,{isActive:r===e,Icon:M(n,H({},Oe)),index:s+1,changeType:()=>t(r)},s))})};function rt(){const e=p.exports.useRef(null),t=p.exports.useRef(null),{cursorType:n}=p.exports.useContext(te);return p.exports.useEffect(()=>{e.current&&(t.current=e.current.getContext("2d"))},[]),tt(t),Qe(e,t),ce("div",{className:"App",style:{position:"relative",cursor:n},children:[M(nt,{}),M("canvas",{ref:e,id:"canvas"})]})}Le.render(M(ze.StrictMode,{children:M(Ve,{children:M(et,{children:M(rt,{})})})}),document.getElementById("root"));
