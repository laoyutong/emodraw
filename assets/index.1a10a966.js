var re=Object.defineProperty;var K=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var Y=(e,t,r)=>t in e?re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,k=(e,t)=>{for(var r in t||(t={}))oe.call(t,r)&&Y(e,r,t[r]);if(K)for(var r of K(t))se.call(t,r)&&Y(e,r,t[r]);return e};var U=(e,t,r)=>(Y(e,typeof t!="symbol"?t+"":t,r),r);import{C as ie,R as ae,a as ce,D as le,F as ue,A as de,j as q,c as fe,b as v,r as f,n as X,d as he,e as pe}from"./vendor.779914d6.js";const we=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}};we();const ge={theme:"outline",size:"20",fill:"#333"},F=[{type:"selection",Icon:ie},{type:"rectangle",Icon:ae},{type:"circle",Icon:ce},{type:"diamond",Icon:le},{type:"text",Icon:ue},{type:"arrow",Icon:de}],me="_container_zx2b4_1",ye="_active_zx2b4_25";var _={container:me,"tool-item":"_tool-item_zx2b4_12",active:ye,"tool-index":"_tool-index_zx2b4_28"};const De=({Icon:e,index:t,changeType:r,isActive:n})=>q("div",{className:fe(_["tool-item"],{[_.active]:n}),onClick:r,children:[v("div",{className:_["tool-icon"],children:e}),v("div",{className:_["tool-index"],children:t})]}),W="emodraw",J="Segoe UI Emoji",C=15,E={default:"default",crosshair:"crosshair",move:"move",grab:"grab",neswResize:"nesw-resize",nwseResize:"nwse-resize"},Te=30,z=3,L=8,Se=[15,10],P=(e,t,r,n,o)=>{e.beginPath(),e.moveTo(t,r),e.lineTo(t+n,r),e.lineTo(t+n,r+o),e.lineTo(t,r+o),e.closePath(),e.stroke()},Ee=(e,t,r,n,o)=>{e.save(),e.fillStyle="rgba(255,165,0,0.5)",e.fillRect(t,r,n,o),e.restore()},Re=(e,t,r,n,o)=>{const i=n>o?1/n:1/o;e.beginPath(),e.moveTo(t+n,r);for(let s=0;s<Math.PI*2;s+=i)e.lineTo(t+n*Math.cos(s),r+o*Math.sin(s));e.closePath(),e.stroke()},xe=(e,t,r,n,o)=>{e.beginPath(),e.moveTo(t+n/2,r+o),e.lineTo(t+n,r+o/2),e.lineTo(t+n/2,r),e.lineTo(t,r+o/2),e.closePath(),e.stroke()},ve=(e,t)=>Math.floor(180/(Math.PI/Math.atan(e/t))),$=30,Me=(e,t,r,n,o)=>{const i=Math.min(Math.pow(n*n+o*o,1/2)/2,Te),s=o<0?-i:i,g=ve(n,o),a=g+$,u=g-$,d=t+n,h=r+o,p=d-s*Math.sin(Math.PI*a/180),S=h-s*Math.cos(Math.PI*a/180),m=d-s*Math.sin(Math.PI*u/180),M=h-s*Math.cos(Math.PI*u/180);e.beginPath(),e.moveTo(t,r),e.lineTo(d,h),e.lineTo(p,S),e.moveTo(d,h),e.lineTo(m,M),e.stroke()},be=(e,t)=>{const{type:r,x:n,y:o,width:i,height:s}=t;switch(r){case"rectangle":P(e,n,o,i,s);return;case"circle":Re(e,n+i/2,o+s/2,Math.abs(i/2),Math.abs(s/2));return;case"arrow":Me(e,n,o,i,s);return;case"diamond":xe(e,n,o,i,s);return;case"selection":Ee(e,n,o,i,s);return}},Ie=(e,t)=>{const{content:r,x:n,y:o}=t;e.textBaseline="bottom",e.font=`${C}px  ${J}`,te(r).forEach((i,s)=>{e.fillText(i,n,o+C*(s+1))})},Z=(e,{x:t,y:r,width:n,height:o,type:i},s)=>{const g=n>0?z:-z,a=o>0?z:-z,u=t-g,d=t+n+g,h=r-a,p=r+o+a;if(e.setLineDash(Se),e.beginPath(),e.moveTo(u,h),e.lineTo(d,h),e.lineTo(d,p),e.lineTo(u,p),e.closePath(),e.stroke(),e.setLineDash([]),!s){const S=n>0?L:-L,m=o>0?L:-L;i!=="text"&&(P(e,u,h,-S,-m),P(e,d,p,S,m),i!=="arrow"&&(P(e,d,h,S,-m),P(e,u,p,-S,m)))}},ze=e=>{const[t,r,n,o]=l.getSelectionData();Z(e,{x:t,y:n,width:r-t,height:o-n,type:"selection"},!1)},Q=e=>{let t=!1;l.data.filter(n=>n.isSelected).length>1&&(ze(e),t=!0),l.data.forEach(n=>{n.isSelected&&Z(e,n,t),n.type==="text"?Ie(e,n):be(e,n)})};class Le{constructor(){U(this,"data");this.data=this._getStorageData()}_getStorageData(){let t;try{t=JSON.parse(localStorage.getItem(W))||[]}catch{t=[],localStorage.setItem(W,"[]")}return t}getSelectionData(){let t=-1/0,r=-1/0,n=1/0,o=1/0;const i=this.data.filter(s=>s.isSelected);if(i.length===1&&i[0].type==="arrow"){const s=i[0];return[s.x,s.x+s.width,s.y,s.y+s.height,!0]}return i.forEach(s=>{const[g,a]=s.width>0?[s.x+s.width,s.x]:[s.x,s.x+s.width],[u,d]=s.height>0?[s.y+s.height,s.y]:[s.y,s.y+s.height];g>t&&(t=g),u>r&&(r=u),a<n&&(n=a),d<o&&(o=d)}),[t,n,r,o,!1]}addDrawData(t){this.data.push(t)}revokeDrawData(){this.data.pop()}storageDrawData(){this.data=this.data.filter(t=>t.type!=="selection").map(t=>{if(t.type==="arrow")return t;const r=k({},t);return r.width<0&&(r.x=r.x+r.width,r.width=-r.width),r.height<0&&(r.y=r.y+r.height,r.height=-r.height),r}),localStorage.setItem(W,JSON.stringify(this.data))}delete(){this.data=this.data.filter(t=>!t.isSelected),this.storageDrawData()}}var l=new Le;const Ae=({x:e,y:t},r)=>{if(document.querySelector("textarea"))return;const o=document.createElement("textarea");Object.assign(o.style,{position:"absolute",margin:0,padding:0,border:0,outline:0,background:"transparent",resize:"none",top:t+"px",left:e+"px",fontSize:C+"px",lineHeight:"1em",fontFamily:J}),o.onkeydown=i=>{i.stopPropagation()},o.oninput=()=>{o.style.height=o.scrollHeight+"px"},o.onblur=()=>{document.body.removeChild(o)},o.onchange=i=>{r(i.target.value)},document.body.appendChild(o),setTimeout(()=>{o.focus()})},b=5,_e=e=>e>b?e-b:0,N=e=>e+b<window.innerWidth?e+b:window.innerWidth,O=e=>e+b<window.innerWidth?e+b:window.innerWidth,I=(e,t,r)=>e>=_e(t)&&e<=r,H=(e,t,r,n)=>Math.pow(Math.pow(Math.abs(e-t),2)+Math.pow(Math.abs(r-n),2),1/2),G=({x:e,y:t})=>{for(let r=0;r<l.data.length;r++){const n=l.data[r],o=n.x,i=n.x+n.width,s=n.y,g=n.y+n.height;if(n.isSelected){const a=n.width>0?i:o,u=n.width>0?o:i,d=n.height>0?g:s,h=n.height>0?s:g;if(e>=u&&e<=a&&t>=h&&t<=d)return n.id}if(n.type==="text"&&I(e,o,N(i))&&I(t,s,O(g))||n.type==="rectangle"&&((I(e,o,N(o))||I(e,i,N(i)))&&I(t,s,O(g))||(I(t,s,O(s))||I(t,g,O(g)))&&I(e,o,N(i))))return n.id;if(n.type==="diamond"){const a=n.width*n.height,u=Math.abs(e-(o+n.width/2)),d=Math.abs(t-(s+n.height/2)),h=((u+b)*n.height+(d+b)*n.width)*2,p=((u-b)*n.height+(d-b)*n.width)*2;if(h>=a&&p<=a)return n.id}if(n.type==="circle"){const a=o+n.width/2,u=s+n.height/2,d=Math.abs(n.width/2),h=Math.abs(n.height/2),p=d>h?1/d:1/h;for(let S=0;S<Math.PI*2;S+=p){const m=Math.round(a+d*Math.cos(S)),M=Math.round(u+h*Math.sin(S));if(I(e,m,N(m))&&I(t,M,O(M)))return n.id}}if(n.type==="arrow"){const a=Math.round(H(o,i,s,g)),u=Math.round(H(e,o,t,s)+H(e,i,t,g));if(u>=a-b/2&&u<=a+b/2)return n.id}}return null},Pe=(e,t,r,n)=>{const[o,i]=r>0?[e+r,e]:[e,e+r],[s,g]=n>0?[t+n,t]:[t,t+n];return l.data.filter(a=>{if(a.type==="selection")return!1;const[u,d]=a.width>0?[a.x+a.width,a.x]:[a.x,a.x+a.width],[h,p]=a.height>0?[a.y+a.height,a.y]:[a.y,a.y+a.height];return o>=u&&i<=d&&s>=h&&g<=p}).map(({id:a})=>a)},V=(e,t)=>{const[r,n,o,i]=l.getSelectionData();return e<=r&&e>=n&&t<=o&&t>=i},w=(e,t,r)=>r?e>=t+z&&e<=t+L+z:e<=t-z&&e>=t-L-z,ee=({x:e,y:t})=>{const[r,n,o,i,s]=l.getSelectionData();if(s){if(r>=n&&o>i){if(w(e,n,!1)&&w(t,i,!1))return[E.nwseResize,"top"];if(w(e,r,!0)&&w(t,o,!0))return[E.nwseResize,"bottom"]}else if(r>=n&&o<i){if(w(e,n,!1)&&w(t,i,!0))return[E.neswResize,"bottom"];if(w(e,r,!0)&&w(t,o,!1))return[E.neswResize,"top"]}else if(r<n&&o>i){if(w(e,n,!0)&&w(t,i,!1))return[E.neswResize,"top"];if(w(e,r,!1)&&w(t,o,!0))return[E.neswResize,"bottom"]}else{if(w(e,r,!1)&&w(t,o,!1))return[E.nwseResize,"top"];if(w(e,n,!0)&&w(t,i,!0))return[E.nwseResize,"bottom"]}return null}return w(e,n,!1)&&w(t,i,!1)?[E.nwseResize,"top"]:w(e,r,!0)&&w(t,o,!0)?[E.nwseResize,"bottom"]:w(e,n,!1)&&w(t,o,!0)?[E.neswResize,"bottom"]:w(e,r,!0)&&w(t,i,!1)?[E.neswResize,"top"]:null},te=e=>e.replace(/\r\n?/g,`
`).split(`
`).filter(t=>!!t.trim()),Ne=(e,t)=>{f.exports.useEffect(()=>{const r=()=>{!e.current||!t.current||(e.current.width=window.innerWidth,e.current.height=window.innerHeight,Q(t.current))};return r(),window.addEventListener("resize",r),()=>document.removeEventListener("resize",r)},[])},ne=e=>{f.exports.useEffect(()=>{const t=r=>{const{key:n,metaKey:o}=r;e(n,o)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[])},j=f.exports.createContext({}),Oe=({children:e})=>{const[t,r]=f.exports.useState("selection");return v(j.Provider,{value:{drawType:t,setDrawType:r},children:e})},B=f.exports.createContext({}),Ce=({children:e})=>{const[t,r]=f.exports.useState(E.default);return v(B.Provider,{value:{cursorType:t,setCursorType:r},children:e})},Ye=e=>{const{drawType:t,setDrawType:r}=f.exports.useContext(j),{cursorType:n,setCursorType:o}=f.exports.useContext(B),i=f.exports.useRef(!1),s=f.exports.useRef(!1),g=f.exports.useRef(!1),a=f.exports.useRef(!1),u=f.exports.useRef(),d=f.exports.useRef(),h=f.exports.useRef(!1),p=f.exports.useRef({x:0,y:0}),S=()=>{e.current&&(e.current.clearRect(0,0,window.innerWidth,window.innerHeight),Q(e.current))};f.exports.useEffect(()=>{o(t==="selection"?E.default:E.crosshair),t!=="selection"&&l.data.forEach(m=>m.isSelected=!1)},[t]),ne((m,M)=>{M&&m==="z"&&(l.revokeDrawData(),l.storageDrawData(),S()),m==="Backspace"&&(l.delete(),S())}),f.exports.useEffect(()=>{const m=M=>{const{offsetX:R,offsetY:x}=M;if(p.current={x:R,y:x},t==="text")r("selection"),Ae(p.current,D=>{if(D.trim()){const T=te(D);let y=0;T.forEach(c=>{if(e.current){const{width:A}=e.current.measureText(c);A>y&&(y=A)}}),l.addDrawData({type:t,id:X(),x:R,y:x,content:D,width:Math.floor(y),height:T.length*C,isSelected:!1}),l.storageDrawData(),S()}});else if(t==="selection"){if(i.current=!0,a.current&&V(R,x)){s.current=!0;return}const D=ee({x:R,y:x});if(D){u.current=D[1],s.current=!0;const y=l.data.filter(c=>c.isSelected);if(y.length===1&&y[0].type==="arrow"){const c=y[0];d.current=c.height<=0&&u.current==="top"||c.height>0&&u.current==="bottom"?"head":"foot"}return}const T=G({x:R,y:x});l.data.forEach(y=>y.isSelected=!1),s.current=!1,T?(l.data.find(y=>y.id===T).isSelected=!0,s.current=!0,l.storageDrawData()):(l.addDrawData({type:t,id:X(),x:R,y:x,width:0,height:0,isSelected:!1}),S())}else i.current=!0,l.addDrawData({type:t,id:X(),x:R,y:x,width:0,height:0,isSelected:!1})};return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[t]),f.exports.useEffect(()=>{const m=M=>{const{offsetX:R,offsetY:x}=M;if(!i.current){const y=ee({x:R,y:x});if(y){o(y[0]);return}if(t==="selection"){const c=a.current?V(R,x):G({x:R,y:x});o(c?E.move:E.default)}return}const D=R-p.current.x,T=x-p.current.y;if(t==="selection"&&s.current){const y=l.data.filter(c=>c.isSelected);if(["nesw-resize","nwse-resize"].includes(n)){if(y.length===1){const c=y[0];c.type==="arrow"?d.current==="head"?(c.width+=D,c.height+=T):(c.x+=D,c.y+=T,c.width-=D,c.height-=T):n==="nesw-resize"?u.current==="top"?(c.y+=T,c.width+=D,c.height-=T):(c.height+=T,c.x+=D,c.width-=D):n==="nwse-resize"&&(u.current==="top"?(c.x+=D,c.y+=T,c.width-=D,c.height-=T):(c.width+=D,c.height+=T))}}else y.forEach(c=>{c.x+=D,c.y+=T});(R!==p.current.x||x!==p.current.y)&&(h.current=!0,p.current={x:R,y:x})}else{const y=l.data[l.data.length-1];if(y.type!=="text"&&(y.width=D,y.height=T),y.type==="selection"){g.current=!0;const c=Pe(p.current.x,p.current.y,D,T);a.current=c.length>1,l.data.forEach(A=>{A.isSelected=c.includes(A.id)})}}S()};return document.addEventListener("mousemove",m),()=>document.removeEventListener("mousemove",m)},[t,n]),f.exports.useEffect(()=>{const m=M=>{if(!i.current)return;i.current=!1;const{offsetX:R,offsetY:x}=M;if(R===p.current.x&&x===p.current.y?(t!=="selection"&&l.revokeDrawData(),h.current||(a.current=!1)):(t!=="selection"?(l.data[l.data.length-1].isSelected=!0,r("selection")):l.revokeDrawData(),S()),t==="selection"&&!h.current&&!g.current){l.data.forEach(T=>T.isSelected=!1);const D=G({x:R,y:x});D?l.data.find(T=>T.id===D).isSelected=!0:o(E.default),S()}h.current=!1,g.current=!1,l.storageDrawData()};return document.addEventListener("mouseup",m),()=>document.removeEventListener("mouseup",m)},[t])},ke=()=>{const{drawType:e,setDrawType:t}=f.exports.useContext(j);return ne(r=>{const n=+r-1;!isNaN(n)&&n<F.length&&t(F[n].type)}),v("div",{className:_.container,children:F.map(({Icon:r,type:n},o)=>v(De,{isActive:n===e,Icon:v(r,k({},ge)),index:o+1,changeType:()=>t(n)},o))})};function Xe(){const e=f.exports.useRef(null),t=f.exports.useRef(null),{cursorType:r}=f.exports.useContext(B);return f.exports.useEffect(()=>{e.current&&(t.current=e.current.getContext("2d"))},[]),Ye(t),Ne(e,t),q("div",{className:"App",style:{position:"relative",cursor:r},children:[v(ke,{}),v("canvas",{ref:e,id:"canvas"})]})}he.render(v(pe.StrictMode,{children:v(Oe,{children:v(Ce,{children:v(Xe,{})})})}),document.getElementById("root"));
