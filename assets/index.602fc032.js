var Oe=Object.defineProperty,_e=Object.defineProperties;var Pe=Object.getOwnPropertyDescriptors;var fe=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var Q=(e,t,n)=>t in e?Oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,U=(e,t)=>{for(var n in t||(t={}))ke.call(t,n)&&Q(e,n,t[n]);if(fe)for(var n of fe(t))Ce.call(t,n)&&Q(e,n,t[n]);return e},he=(e,t)=>_e(e,Pe(t));var pe=(e,t,n)=>(Q(e,typeof t!="symbol"?t+"":t,n),n),V=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)};var $=(e,t,n)=>(V(e,t,"read from private field"),n?n.call(e):t.get(e)),ee=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},ye=(e,t,n,r)=>(V(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);var we=(e,t,n)=>(V(e,t,"access private method"),n);import{C as Ne,R as Xe,a as Ye,D as We,F as He,A as Fe,j as ge,c as Ge,b as v,r as p,n as te,d as je,e as Be}from"./vendor.779914d6.js";const Ke=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}};Ke();const Ue={theme:"outline",size:"20",fill:"#333"},re=[{type:"selection",Icon:Ne},{type:"rectangle",Icon:Xe},{type:"circle",Icon:Ye},{type:"diamond",Icon:We},{type:"text",Icon:He},{type:"arrow",Icon:Fe}],$e="_container_zx2b4_1",qe="_active_zx2b4_25";var Y={container:$e,"tool-item":"_tool-item_zx2b4_12",active:qe,"tool-index":"_tool-index_zx2b4_28"};const Je=({Icon:e,index:t,changeType:n,isActive:r})=>ge("div",{className:Ge(Y["tool-item"],{[Y.active]:r}),onClick:n,children:[v("div",{className:Y["tool-icon"],children:e}),v("div",{className:Y["tool-index"],children:t})]}),ne="emodraw",me="Segoe UI Emoji",q=15,R={default:"default",crosshair:"crosshair",move:"move",grab:"grab",neswResize:"nesw-resize",nwseResize:"nwse-resize"},Ze=30,k=3,N=8,Qe=[15,10],W=(e,t,n,r,s)=>{e.beginPath(),e.moveTo(t,n),e.lineTo(t+r,n),e.lineTo(t+r,n+s),e.lineTo(t,n+s),e.closePath(),e.stroke()},Ve=(e,t,n,r,s)=>{e.save(),e.fillStyle="rgba(255,165,0,0.5)",e.fillRect(t,n,r,s),e.restore()},et=(e,t,n,r,s)=>{const i=r>s?1/r:1/s;e.beginPath(),e.moveTo(t+r,n);for(let o=0;o<Math.PI*2;o+=i)e.lineTo(t+r*Math.cos(o),n+s*Math.sin(o));e.closePath(),e.stroke()},tt=(e,t,n,r,s)=>{e.beginPath(),e.moveTo(t+r/2,n+s),e.lineTo(t+r,n+s/2),e.lineTo(t+r/2,n),e.lineTo(t,n+s/2),e.closePath(),e.stroke()},rt=(e,t)=>Math.floor(180/(Math.PI/Math.atan(e/t))),De=30,nt=(e,t,n,r,s)=>{const i=Math.min(Math.pow(r*r+s*s,1/2)/2,Ze),o=s<0?-i:i,g=rt(r,s),u=g+De,h=g-De,w=t+r,D=n+s,m=w-o*Math.sin(Math.PI*u/180),M=D-o*Math.cos(Math.PI*u/180),E=w-o*Math.sin(Math.PI*h/180),b=D-o*Math.cos(Math.PI*h/180);e.beginPath(),e.moveTo(t,n),e.lineTo(w,D),e.lineTo(m,M),e.moveTo(w,D),e.lineTo(E,b),e.stroke()},st=(e,t)=>{const{type:n,x:r,y:s,width:i,height:o}=t;switch(n){case"rectangle":W(e,r,s,i,o);return;case"circle":et(e,r+i/2,s+o/2,Math.abs(i/2),Math.abs(o/2));return;case"arrow":nt(e,r,s,i,o);return;case"diamond":tt(e,r,s,i,o);return;case"selection":Ve(e,r,s,i,o);return}},ot=(e,t)=>{const{content:n,x:r,y:s}=t;e.textBaseline="bottom",e.font=`${q}px  ${me}`,Me(n).forEach((i,o)=>{e.fillText(i,r,s+q*(o+1))})},xe=(e,{x:t,y:n,width:r,height:s,type:i},o)=>{const g=r>0?k:-k,u=s>0?k:-k,h=t-g,w=t+r+g,D=n-u,m=n+s+u;if(e.setLineDash(Qe),e.beginPath(),e.moveTo(h,D),e.lineTo(w,D),e.lineTo(w,m),e.lineTo(h,m),e.closePath(),e.stroke(),e.setLineDash([]),!o){const M=r>0?N:-N,E=s>0?N:-N;i!=="text"&&(W(e,h,D,-M,-E),W(e,w,m,M,E),i!=="arrow"&&(W(e,w,D,M,-E),W(e,h,m,-M,E)))}},it=e=>{const t=d.getSelectionData();if(!t)return;const[n,r,s,i]=t;xe(e,{x:n,y:s,width:r-n,height:i-s,type:"selection"},!1)},Se=e=>{let t=!1;d.data.filter(r=>r.isSelected).length>1&&(it(e),t=!0),d.data.forEach(r=>{r.isSelected&&xe(e,r,t),r.type==="text"?ot(e,r):st(e,r)})};var C,J,ct;class at{constructor(){ee(this,J);pe(this,"data");ee(this,C,void 0);this.data=we(this,J,ct).call(this),ye(this,C,[])}addOperateStack(t){$(this,C).push(t)}getSelectionData(){let t=-1/0,n=-1/0,r=1/0,s=1/0;const i=this.data.filter(o=>o.isSelected);if(i.length===1&&i[0].type==="text")return null;if(i.length===1&&i[0].type==="arrow"){const o=i[0];return[o.x,o.x+o.width,o.y,o.y+o.height,!0]}return i.forEach(o=>{const[g,u]=o.width>0?[o.x+o.width,o.x]:[o.x,o.x+o.width],[h,w]=o.height>0?[o.y+o.height,o.y]:[o.y,o.y+o.height];g>t&&(t=g),h>n&&(n=h),u<r&&(r=u),w<s&&(s=w)}),[t,r,n,s,!1]}addDrawData(t){this.data.push(t)}popDrawData(){this.data.pop()}revokeDrawData(){if($(this,C).length>0){const t=$(this,C).pop();if(t.type==="DELETE"&&this.data.push(...t.payload),t.type==="ADD"&&(this.data=this.data.filter(n=>t.selectedIds!==n.id)),t.type==="MOVE"){const{x:n,y:r}=t.payload;this.data.forEach(s=>s.isSelected=!1),this.data.filter(s=>t.selectedIds.includes(s.id)).forEach(s=>{s.x-=n,s.y-=r,s.isSelected=!0})}t.type==="RESIZE",this.storageDrawData()}}storageDrawData(){this.data=this.data.filter(t=>t.type!=="selection").map(t=>{if(t.type==="arrow")return t;const n=U({},t);return n.width<0&&(n.x=n.x+n.width,n.width=-n.width),n.height<0&&(n.y=n.y+n.height,n.height=-n.height),n}),localStorage.setItem(ne,JSON.stringify(this.data))}delete(){const t=[];this.data=this.data.filter(n=>n.isSelected?(t.push(he(U({},n),{isSelected:!1})),!1):!0),this.addOperateStack({type:"DELETE",payload:t}),this.storageDrawData()}}C=new WeakMap,J=new WeakSet,ct=function(){let t;try{t=JSON.parse(localStorage.getItem(ne))||[]}catch{t=[],localStorage.setItem(ne,"[]")}return t};var d=new at;const lt=({x:e,y:t},n,r)=>{if(document.querySelector("textarea"))return;const i=document.createElement("textarea");Object.assign(i.style,{position:"absolute",margin:0,padding:0,border:0,outline:0,background:"transparent",resize:"none",top:t+"px",left:e+"px",fontSize:q+"px",lineHeight:"1em",fontFamily:me,width:`${window.innerWidth-e}px`,whiteSpace:"nowrap",overflowX:"hidden"}),r&&(i.value=r,i.setSelectionRange(0,r.length)),i.onkeydown=o=>{o.stopPropagation()},i.oninput=()=>{i.style.height=i.scrollHeight+"px"},i.onblur=o=>{n(o.target.value),document.body.removeChild(i)},document.body.appendChild(i),setTimeout(()=>{i.focus()})},z=5,ut=e=>e>z?e-z:0,H=e=>e+z<window.innerWidth?e+z:window.innerWidth,F=e=>e+z<window.innerWidth?e+z:window.innerWidth,O=(e,t,n)=>e>=ut(t)&&e<=n,se=(e,t,n,r)=>Math.pow(Math.pow(Math.abs(e-t),2)+Math.pow(Math.abs(n-r),2),1/2),oe=({x:e,y:t})=>{for(let n=0;n<d.data.length;n++){const r=d.data[n],s=r.x,i=r.x+r.width,o=r.y,g=r.y+r.height;if(r.isSelected){const u=r.width>0?i:s,h=r.width>0?s:i,w=r.height>0?g:o,D=r.height>0?o:g;if(e>=h&&e<=u&&t>=D&&t<=w)return r.id}if(r.type==="text"&&O(e,s,H(i))&&O(t,o,F(g))||r.type==="rectangle"&&((O(e,s,H(s))||O(e,i,H(i)))&&O(t,o,F(g))||(O(t,o,F(o))||O(t,g,F(g)))&&O(e,s,H(i))))return r.id;if(r.type==="diamond"){const u=r.width*r.height,h=Math.abs(e-(s+r.width/2)),w=Math.abs(t-(o+r.height/2)),D=((h+z)*r.height+(w+z)*r.width)*2,m=((h-z)*r.height+(w-z)*r.width)*2;if(D>=u&&m<=u)return r.id}if(r.type==="circle"){const u=s+r.width/2,h=o+r.height/2,w=Math.abs(r.width/2),D=Math.abs(r.height/2),m=w>D?1/w:1/D;for(let M=0;M<Math.PI*2;M+=m){const E=Math.round(u+w*Math.cos(M)),b=Math.round(h+D*Math.sin(M));if(O(e,E,H(E))&&O(t,b,F(b)))return r.id}}if(r.type==="arrow"){const u=Math.round(se(s,i,o,g)),h=Math.round(se(e,s,t,o)+se(e,i,t,g));if(h>=u-z/2&&h<=u+z/2)return r.id}}return null},dt=(e,t,n,r)=>{const[s,i]=n>0?[e+n,e]:[e,e+n],[o,g]=r>0?[t+r,t]:[t,t+r];return d.data.filter(u=>{if(u.type==="selection")return!1;const[h,w]=u.width>0?[u.x+u.width,u.x]:[u.x,u.x+u.width],[D,m]=u.height>0?[u.y+u.height,u.y]:[u.y,u.y+u.height];return s>=h&&i<=w&&o>=D&&g<=m}).map(({id:u})=>u)},Te=(e,t)=>{const n=d.getSelectionData();if(!n)return!1;const[r,s,i,o]=n;return e<=r&&e>=s&&t<=i&&t>=o},S=(e,t,n)=>n?e>=t+k&&e<=t+N+k:e<=t-k&&e>=t-N-k,Re=({x:e,y:t})=>{const n=d.getSelectionData();if(!n)return null;const[r,s,i,o,g]=n;if(g){if(r>=s&&i>o){if(S(e,s,!1)&&S(t,o,!1))return[R.nwseResize,"top"];if(S(e,r,!0)&&S(t,i,!0))return[R.nwseResize,"bottom"]}else if(r>=s&&i<o){if(S(e,s,!1)&&S(t,o,!0))return[R.neswResize,"bottom"];if(S(e,r,!0)&&S(t,i,!1))return[R.neswResize,"top"]}else if(r<s&&i>o){if(S(e,s,!0)&&S(t,o,!1))return[R.neswResize,"top"];if(S(e,r,!1)&&S(t,i,!0))return[R.neswResize,"bottom"]}else{if(S(e,r,!1)&&S(t,i,!1))return[R.nwseResize,"top"];if(S(e,s,!0)&&S(t,o,!0))return[R.nwseResize,"bottom"]}return null}return S(e,s,!1)&&S(t,o,!1)?[R.nwseResize,"top"]:S(e,r,!0)&&S(t,i,!0)?[R.nwseResize,"bottom"]:S(e,s,!1)&&S(t,i,!0)?[R.neswResize,"bottom"]:S(e,r,!0)&&S(t,o,!1)?[R.neswResize,"top"]:null},ft=({x:e,y:t})=>{const n=d.data.filter(r=>r.type==="text");for(let r=0;r<n.length;r++){const s=n[r];if(e>=s.x&&e<=s.x+s.width&&t>=s.y&&t<=s.y+s.height)return s}return null},Me=e=>e.replace(/\r\n?/g,`
`).split(`
`).filter(t=>!!t.trim()),ht=(e,t)=>{p.exports.useEffect(()=>{const n=()=>{!e.current||!t.current||(e.current.width=window.innerWidth,e.current.height=window.innerHeight,Se(t.current))};return n(),window.addEventListener("resize",n),()=>document.removeEventListener("resize",n)},[])},Ee=e=>{p.exports.useEffect(()=>{const t=n=>{const{key:r,metaKey:s}=n;e(r,s)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[])},ie=p.exports.createContext({}),pt=({children:e})=>{const[t,n]=p.exports.useState("selection");return v(ie.Provider,{value:{drawType:t,setDrawType:n},children:e})},ae=p.exports.createContext({}),yt=({children:e})=>{const[t,n]=p.exports.useState(R.default);return v(ae.Provider,{value:{cursorType:t,setCursorType:n},children:e})},wt=e=>{const{drawType:t,setDrawType:n}=p.exports.useContext(ie),{cursorType:r,setCursorType:s}=p.exports.useContext(ae),i=p.exports.useRef(!1),o=p.exports.useRef(!1),g=p.exports.useRef(!1),u=p.exports.useRef(!1),h=p.exports.useRef(),w=p.exports.useRef(),D=p.exports.useRef(!1),m=p.exports.useRef({x:0,y:0}),M=p.exports.useRef({x:0,y:0}),E=p.exports.useRef({x:0,y:0}),b=()=>{e.current&&(e.current.clearRect(0,0,window.innerWidth,window.innerHeight),Se(e.current))},be=(a,c,l)=>{a.type==="arrow"?w.current==="head"?(a.width+=c,a.height+=l):(a.x+=c,a.y+=l,a.width-=c,a.height-=l):r==="nesw-resize"?h.current==="top"?(a.y+=l,a.width+=c,a.height-=l):(a.height+=l,a.x+=c,a.width-=c):r==="nwse-resize"&&(h.current==="top"?(a.x+=c,a.y+=l,a.width-=c,a.height-=l):(a.width+=c,a.height+=l))},ve=(a,c,l)=>{const{x:f,y:x}=M.current,y=c-f,T=l-x,_=Math.abs(y)>Math.abs(T);let P=0,X=0;const I={x:0,y:0},L=d.getSelectionData(),ce=L[0]-L[1],le=L[2]-L[3];r==="nesw-resize"?(P=_?-T:y,X=_?T:-y,h.current==="top"?(I.x=L[1],I.y=L[2]):(I.x=L[0],I.y=L[3])):(P=_?T:y,X=_?T:y,h.current==="top"?(I.x=L[0],I.y=L[2]):(I.x=L[1],I.y=L[3])),a.forEach(A=>{const ue=Math.abs(A.x-I.x)/ce,ze=Math.abs(A.x+A.width-I.x)/ce,de=Math.abs(A.y-I.y)/le,Ae=Math.abs(A.y+A.height-I.y)/le;A.x+=(P-E.current.x)*ue,A.y+=(X-E.current.y)*de,A.width+=(P-E.current.x)*(ze-ue),A.height+=(X-E.current.y)*(Ae-de)}),E.current={x:P,y:X}},Ie=(a,c,l)=>{a.length===1?be(a[0],c-m.current.x,l-m.current.y):ve(a,c,l)},Le=(a,c,l)=>{a.forEach(f=>{f.x+=c,f.y+=l})},Z=({x:a,y:c},l)=>{lt({x:a,y:c},f=>{if(f.trim()){const x=Me(f);let y=0;x.forEach(_=>{if(e.current){const{width:P}=e.current.measureText(_);P>y&&(y=P)}});const T=te();d.addDrawData({type:"text",id:T,x:a,y:c,content:f,width:Math.floor(y),height:x.length*q,isSelected:!1}),d.addOperateStack({type:"ADD",selectedIds:T}),d.storageDrawData(),b()}},l)},G=p.exports.useRef();G.current=(a,c)=>{if(t==="selection"){const l=ft({x:a,y:c});d.data.forEach(f=>f.isSelected=!1),l?(d.data=d.data.filter(f=>f.id!==l.id),Z({x:l.x,y:l.y},l.content)):Z({x:a,y:c}),b()}},p.exports.useEffect(()=>{const a=({pageX:c,pageY:l})=>{var f;(f=G.current)==null||f.call(G,c,l)};return document.addEventListener("dblclick",a),()=>document.removeEventListener("dblclick",a)},[]),p.exports.useEffect(()=>{s(t==="selection"?R.default:R.crosshair),t!=="selection"&&d.data.forEach(a=>a.isSelected=!1)},[t]),Ee((a,c)=>{c&&a==="z"&&(d.revokeDrawData(),b()),a==="Backspace"&&(d.delete(),b())});const j=p.exports.useRef();j.current=a=>{const{pageX:c,pageY:l}=a;if(m.current=M.current={x:c,y:l},t==="text")n("selection"),Z({x:c,y:l});else if(t==="selection"){if(i.current=!0,u.current&&Te(c,l)){o.current=!0;return}const f=Re({x:c,y:l});if(f){h.current=f[1],o.current=!0;const y=d.data.filter(T=>T.isSelected);if(y.length===1&&y[0].type==="arrow"){const T=y[0];w.current=T.height<=0&&h.current==="top"||T.height>0&&h.current==="bottom"?"head":"foot"}return}const x=oe({x:c,y:l});d.data.forEach(y=>y.isSelected=!1),o.current=!1,x?(d.data.find(y=>y.id===x).isSelected=!0,o.current=!0,d.storageDrawData()):(d.addDrawData({type:t,id:te(),x:c,y:l,width:0,height:0,isSelected:!1}),b())}else i.current=!0,d.addDrawData({type:t,id:te(),x:c,y:l,width:0,height:0,isSelected:!1})};const B=p.exports.useRef();B.current=a=>{const{pageX:c,pageY:l}=a;if(!i.current){const y=Re({x:c,y:l});if(y){s(y[0]);return}if(t==="selection"){const T=u.current?Te(c,l):oe({x:c,y:l});s(T?R.move:R.default)}return}const f=c-m.current.x,x=l-m.current.y;if(t==="selection"&&o.current){const y=d.data.filter(T=>T.isSelected);["nesw-resize","nwse-resize"].includes(r)?Ie(y,c,l):Le(y,f,x),(c!==m.current.x||l!==m.current.y)&&(D.current=!0,m.current={x:c,y:l})}else{const y=d.data[d.data.length-1];if(y.type!=="text"&&(y.width=f,y.height=x),y.type==="selection"){g.current=!0;const T=dt(m.current.x,m.current.y,f,x);u.current=T.length>1,d.data.forEach(_=>{_.isSelected=T.includes(_.id)})}}b()};const K=p.exports.useRef();K.current=a=>{if(!i.current)return;i.current=!1;const{pageX:c,pageY:l}=a;if(c===m.current.x&&l===m.current.y)t!=="selection"&&d.popDrawData(),D.current?d.addOperateStack({type:"MOVE",selectedIds:d.data.filter(f=>f.isSelected).map(f=>f.id),payload:{x:c-M.current.x,y:l-M.current.y}}):u.current=!1;else{if(t!=="selection"){const f=d.data[d.data.length-1];f.isSelected=!0,d.addOperateStack({type:"ADD",selectedIds:f.id}),n("selection")}else d.popDrawData();b()}if(t==="selection"&&!D.current&&!g.current){d.data.forEach(x=>x.isSelected=!1);const f=oe({x:c,y:l});f?d.data.find(x=>x.id===f).isSelected=!0:s(R.default),b()}D.current=!1,g.current=!1,E.current={x:0,y:0},d.storageDrawData()},p.exports.useEffect(()=>{const a=f=>{var x;(x=B.current)==null||x.call(B,f)},c=f=>{var x;(x=j.current)==null||x.call(j,f)},l=f=>{var x;(x=K.current)==null||x.call(K,f)};return document.addEventListener("mousedown",c),document.addEventListener("mousemove",a),document.addEventListener("mouseup",l),()=>{document.removeEventListener("mousedown",c),document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",l)}},[])},gt=()=>{const{drawType:e,setDrawType:t}=p.exports.useContext(ie);return Ee(n=>{const r=+n-1;!isNaN(r)&&r!==-1&&r<re.length&&t(re[r].type)}),v("div",{className:Y.container,children:re.map(({Icon:n,type:r},s)=>v(Je,{isActive:r===e,Icon:v(n,U({},Ue)),index:s+1,changeType:()=>t(r)},s))})};function mt(){const e=p.exports.useRef(null),t=p.exports.useRef(null),{cursorType:n}=p.exports.useContext(ae);return p.exports.useEffect(()=>{e.current&&(t.current=e.current.getContext("2d"))},[]),wt(t),ht(e,t),ge("div",{className:"App",style:{position:"relative",cursor:n},children:[v(gt,{}),v("canvas",{ref:e,id:"canvas"})]})}je.render(v(Be.StrictMode,{children:v(pt,{children:v(yt,{children:v(mt,{})})})}),document.getElementById("root"));
