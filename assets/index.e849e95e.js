var K=Object.defineProperty;var O=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var L=(e,t,r)=>t in e?K(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,k=(e,t)=>{for(var r in t||(t={}))U.call(t,r)&&L(e,r,t[r]);if(O)for(var r of O(t))q.call(t,r)&&L(e,r,t[r]);return e};var N=(e,t,r)=>(L(e,typeof t!="symbol"?t+"":t,r),r);import{C as J,R as V,a as $,D as Z,F as Q,A as ee,j as F,c as te,b as w,r as m,n as Y,d as oe,e as ne}from"./vendor.779914d6.js";const re=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}};re();const se={theme:"outline",size:"20",fill:"#333"},_=[{type:"selection",Icon:J},{type:"rectangle",Icon:V},{type:"circle",Icon:$},{type:"diamond",Icon:Z},{type:"text",Icon:Q},{type:"arrow",Icon:ee}],ae="_container_zx2b4_1",ie="_active_zx2b4_25";var M={container:ae,"tool-item":"_tool-item_zx2b4_12",active:ie,"tool-index":"_tool-index_zx2b4_28"};const ce=({Icon:e,index:t,changeType:r,isActive:n})=>F("div",{className:te(M["tool-item"],{[M.active]:n}),onClick:r,children:[w("div",{className:M["tool-icon"],children:e}),w("div",{className:M["tool-index"],children:t})]}),I="emodraw",X="Segoe UI Emoji",x=15,D={default:"default",crosshair:"crosshair",move:"move",grab:"grab",neswResize:"nesw-resize",nwseResize:"nwse-resize",ewResize:"ew-resize",nsResize:"ns-resize"},le=30,E=(e,t,r,n,o)=>{e.beginPath(),e.moveTo(t,r),e.lineTo(t+n,r),e.lineTo(t+n,r+o),e.lineTo(t,r+o),e.closePath(),e.stroke()},de=(e,t,r,n,o)=>{const s=n>o?1/n:1/o;e.beginPath(),e.moveTo(t+n,r);for(let a=0;a<Math.PI*2;a+=s)e.lineTo(t+n*Math.cos(a),r+o*Math.sin(a));e.closePath(),e.stroke()},ue=(e,t,r,n,o)=>{e.beginPath(),e.moveTo(t+n/2,r+o),e.lineTo(t+n,r+o/2),e.lineTo(t+n/2,r),e.lineTo(t,r+o/2),e.closePath(),e.stroke()},fe=(e,t)=>Math.floor(180/(Math.PI/Math.atan(e/t))),W=30,he=(e,t,r,n,o)=>{const s=Math.min(Math.pow(n*n+o*o,1/2)/2,le),a=o<0?-s:s,d=fe(n,o),h=d+W,l=d-W,u=t+n,c=r+o,f=u-a*Math.sin(Math.PI*h/180),i=c-a*Math.cos(Math.PI*h/180),p=u-a*Math.sin(Math.PI*l/180),v=c-a*Math.cos(Math.PI*l/180);e.beginPath(),e.moveTo(t,r),e.lineTo(u,c),e.lineTo(f,i),e.moveTo(u,c),e.lineTo(p,v),e.stroke()},pe=(e,t)=>{const{type:r,x:n,y:o,width:s,height:a}=t;switch(r){case"rectangle":E(e,n,o,s,a);return;case"circle":de(e,n+s/2,o+a/2,Math.abs(s/2),Math.abs(a/2));return;case"arrow":he(e,n,o,s,a);return;case"diamond":ue(e,n,o,s,a);return}},me=(e,t)=>{const{content:r,x:n,y:o}=t;e.textBaseline="bottom",e.font=`${x}px  ${X}`,j(r).forEach((s,a)=>{e.fillText(s,n,o+x*(a+1))})},ge=(e,{x:t,y:r,width:n,height:o})=>{const s=5,a=8,d=n>0?s:-s,h=o>0?s:-s,l=n>0?a:-a,u=o>0?a:-a,c=t-d,f=t+n+d,i=r-h,p=r+o+h;e.setLineDash([15,10]),e.beginPath(),e.moveTo(c,i),e.lineTo(f,i),e.lineTo(f,p),e.lineTo(c,p),e.closePath(),e.stroke(),e.setLineDash([]),E(e,c,i,-l,-u),E(e,f,i,l,-u),E(e,f,p,l,u),E(e,c,p,-l,u)},H=e=>{g.data.forEach(t=>{t.isSelected&&ge(e,t),t.type==="text"?me(e,t):pe(e,t)})};class we{constructor(){N(this,"data");this.data=this._getStorageData()}_getStorageData(){let t;try{t=JSON.parse(localStorage.getItem(I))||[]}catch{t=[],localStorage.setItem(I,"[]")}return t}addDrawData(t){this.data.push(t)}revokeDrawData(){this.data.pop()}storageDrawData(){localStorage.setItem(I,JSON.stringify(this.data))}delete(){this.data=this.data.filter(t=>!t.isSelected),this.storageDrawData()}}var g=new we;const ye=({x:e,y:t},r)=>{if(document.querySelector("textarea"))return;const o=document.createElement("textarea");Object.assign(o.style,{position:"absolute",margin:0,padding:0,border:0,outline:0,background:"transparent",resize:"none",top:t+"px",left:e+"px",fontSize:x+"px",lineHeight:"1em",fontFamily:X}),o.onkeydown=s=>{s.stopPropagation()},o.oninput=()=>{o.style.height=o.scrollHeight+"px"},o.onblur=()=>{document.body.removeChild(o)},o.onchange=s=>{r(s.target.value)},document.body.appendChild(o),setTimeout(()=>{o.focus()})},y=5,Te=e=>e>y?e-y:0,S=e=>e+y<window.innerWidth?e+y:window.innerWidth,b=e=>e+y<window.innerWidth?e+y:window.innerWidth,T=(e,t,r)=>e>=Te(t)&&e<=r,P=(e,t,r,n)=>Math.pow(Math.pow(Math.abs(e-t),2)+Math.pow(Math.abs(r-n),2),1/2),A=({x:e,y:t})=>{for(let r=0;r<g.data.length;r++){const n=g.data[r],o=n.x,s=n.x+n.width,a=n.y,d=n.y+n.height;if(n.isSelected){const h=n.width>0?s:o,l=n.width>0?o:s,u=n.height>0?d:a,c=n.height>0?a:d;if(e>=l&&e<=h&&t>=c&&t<=u)return n.id}if(n.type==="text"&&T(e,o,S(s))&&T(t,a,b(d)))return console.log("text"),n.id;if(n.type==="rectangle"&&(T(e,o,S(o))||T(e,s,S(s)))&&T(t,a,b(d))||(T(t,a,b(a))||T(t,d,b(d)))&&T(e,o,S(s)))return console.log("rectangle"),n.id;if(n.type==="diamond"){const h=n.width*n.height,l=Math.abs(e-(o+n.width/2)),u=Math.abs(t-(a+n.height/2)),c=((l+y)*n.height+(u+y)*n.width)*2,f=((l-y)*n.height+(u-y)*n.width)*2;if(c>=h&&f<=h)return console.log("diamond"),n.id}if(n.type==="circle"){const h=o+n.width/2,l=a+n.height/2,u=Math.abs(n.width/2),c=Math.abs(n.height/2),f=u>c?1/u:1/c;for(let i=0;i<Math.PI*2;i+=f){const p=Math.round(h+u*Math.cos(i)),v=Math.round(l+c*Math.sin(i));if(T(e,p,S(p))&&T(t,v,b(v)))return console.log("circle"),n.id}}if(n.type==="arrow"){const h=Math.round(P(o,s,a,d)),l=Math.round(P(e,o,t,a)+P(e,s,t,d));if(l>=h-y/2&&l<=h+y/2)return console.log("arrow"),n.id}}return null},j=e=>e.replace(/\r\n?/g,`
`).split(`
`),ve=(e,t)=>{m.exports.useEffect(()=>{const r=()=>{!e.current||!t.current||(e.current.width=window.innerWidth,e.current.height=window.innerHeight,H(t.current))};return r(),window.addEventListener("resize",r),()=>document.removeEventListener("resize",r)},[])},B=e=>{m.exports.useEffect(()=>{const t=r=>{const{key:n,metaKey:o}=r;e(n,o)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[])},z=m.exports.createContext({}),De=({children:e})=>{const[t,r]=m.exports.useState("selection");return w(z.Provider,{value:{drawType:t,setDrawType:r},children:e})},R=m.exports.createContext({}),Me=({children:e})=>{const[t,r]=m.exports.useState(D.default);return w(R.Provider,{value:{cursorType:t,setCursorType:r},children:e})},Ee=e=>{const{drawType:t,setDrawType:r}=m.exports.useContext(z),{setCursorType:n}=m.exports.useContext(R),o=m.exports.useRef(!1),s=m.exports.useRef(!1),a=m.exports.useRef(!1),d=m.exports.useRef({x:0,y:0}),h=()=>{e.current&&(e.current.clearRect(0,0,window.innerWidth,window.innerHeight),H(e.current))};B((l,u)=>{u&&l==="z"&&(g.revokeDrawData(),g.storageDrawData(),h()),l==="Backspace"&&(g.delete(),h())}),m.exports.useEffect(()=>{const l=u=>{const{offsetX:c,offsetY:f}=u;if(d.current={x:c,y:f},t==="text")r("selection"),ye(d.current,i=>{if(i.trim()){const p=j(i);let v=0;p.forEach(G=>{if(e.current){const{width:C}=e.current.measureText(G);C>v&&(v=C)}}),g.addDrawData({type:t,id:Y(),x:c,y:f,content:i,width:Math.floor(v),height:p.length*x,isSelected:!1}),g.storageDrawData(),h()}});else if(t==="selection"){const i=A({x:c,y:f});g.data.forEach(p=>p.isSelected=!1),s.current=!1,i&&(g.data.find(p=>p.id===i).isSelected=!0,s.current=!0,g.storageDrawData(),o.current=!0),h()}else o.current=!0,g.addDrawData({type:t,id:Y(),x:c,y:f,width:0,height:0,isSelected:!1})};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[t]),m.exports.useEffect(()=>{const l=u=>{const{offsetX:c,offsetY:f}=u;if(!o.current){if(t==="selection"){const i=A({x:c,y:f});n(i?D.move:D.default)}return}if(t==="selection"){if(s.current){const i=g.data.find(p=>p.isSelected);i.x=i.x+c-d.current.x,i.y=i.y+f-d.current.y,(c!==d.current.x||f!==d.current.y)&&(a.current=!0,d.current={x:c,y:f})}}else{const i=g.data[g.data.length-1];i.type!=="text"&&(i.width=c-d.current.x,i.height=f-d.current.y)}h()};return document.addEventListener("mousemove",l),()=>document.removeEventListener("mousemove",l)},[t]),m.exports.useEffect(()=>{const l=u=>{if(!o.current)return;o.current=!1;const{offsetX:c,offsetY:f}=u;if(c===d.current.x&&f===d.current.y&&t!=="selection"?g.revokeDrawData():t!=="selection"&&(g.data[g.data.length-1].isSelected=!0,r("selection"),h()),t==="selection"&&!a.current){g.data.forEach(p=>p.isSelected=!1);const i=A({x:c,y:f});i?g.data.find(p=>p.id===i).isSelected=!0:n(D.default),h()}a.current=!1,g.storageDrawData()};return document.addEventListener("mouseup",l),()=>document.removeEventListener("mouseup",l)},[t])},Se=()=>{const{drawType:e,setDrawType:t}=m.exports.useContext(z),{setCursorType:r}=m.exports.useContext(R);return B(n=>{const o=+n-1;!isNaN(o)&&o<_.length&&t(_[o].type)}),m.exports.useEffect(()=>{r(e==="selection"?D.default:D.crosshair)},[e]),w("div",{className:M.container,children:_.map(({Icon:n,type:o},s)=>w(ce,{isActive:o===e,Icon:w(n,k({},se)),index:s+1,changeType:()=>t(o)},s))})};function be(){const e=m.exports.useRef(null),t=m.exports.useRef(null),{cursorType:r}=m.exports.useContext(R);return m.exports.useEffect(()=>{e.current&&(t.current=e.current.getContext("2d"))},[]),Ee(t),ve(e,t),F("div",{className:"App",style:{position:"relative",cursor:r},children:[w(Se,{}),w("canvas",{ref:e,id:"canvas"})]})}oe.render(w(ne.StrictMode,{children:w(De,{children:w(Me,{children:w(be,{})})})}),document.getElementById("root"));
