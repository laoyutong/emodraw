var Qe=Object.defineProperty,Ve=Object.defineProperties;var et=Object.getOwnPropertyDescriptors;var Ae=Object.getOwnPropertySymbols;var tt=Object.prototype.hasOwnProperty,rt=Object.prototype.propertyIsEnumerable;var pe=(e,t,r)=>t in e?Qe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,W=(e,t)=>{for(var r in t||(t={}))tt.call(t,r)&&pe(e,r,t[r]);if(Ae)for(var r of Ae(t))rt.call(t,r)&&pe(e,r,t[r]);return e},oe=(e,t)=>Ve(e,et(t));var Me=(e,t,r)=>(pe(e,typeof t!="symbol"?t+"":t,r),r),ye=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var ae=(e,t,r)=>(ye(e,t,"read from private field"),r?r.call(e):t.get(e)),ge=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},ze=(e,t,r,n)=>(ye(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);var _e=(e,t,r)=>(ye(e,t,"access private method"),r);import{C as nt,R as st,a as ot,D as at,F as it,A as ct,m as lt,j as ie,c as we,b as z,r as g,n as Z,d as dt,L as ut,E as ft,e as ht,f as pt,g as yt,h as gt}from"./vendor.8922c5b7.js";const wt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}};wt();const Oe={theme:"outline",size:"20",fill:"#333"},me=[{type:"selection",Icon:nt},{type:"rectangle",Icon:st},{type:"circle",Icon:ot},{type:"diamond",Icon:at},{type:"text",Icon:it},{type:"arrow",Icon:ct}],xe="emodraw",Ce="Segoe UI Emoji",U=15,mt="#fff",I={default:"default",crosshair:"crosshair",move:"move",grab:"grab",neswResize:"nesw-resize",nwseResize:"nwse-resize"},xt=30,H=3,J=8,Dt=[15,10],ce=10,Pe=20,le=30,St="emodraw.png",Tt="emodraw",$=(e,t,r,n,s)=>{e.beginPath(),e.moveTo(t,r),e.lineTo(t+n,r),e.lineTo(t+n,r+s),e.lineTo(t,r+s),e.closePath(),e.stroke()},Rt=(e,t,r,n,s)=>{e.save(),e.fillStyle="rgba(255,165,0,0.5)",e.fillRect(t,r,n,s),e.restore()},Et=(e,t,r,n,s)=>{const o=n>s?1/n:1/s;e.beginPath(),e.moveTo(t+n,r);for(let c=0;c<Math.PI*2;c+=o)e.lineTo(t+n*Math.cos(c),r+s*Math.sin(c));e.closePath(),e.stroke()},bt=(e,t,r,n,s)=>{e.beginPath(),e.moveTo(t+n/2,r+s),e.lineTo(t+n,r+s/2),e.lineTo(t+n/2,r),e.lineTo(t,r+s/2),e.closePath(),e.stroke()},vt=(e,t)=>Math.floor(180/(Math.PI/Math.atan(e/t))),ke=30,It=(e,t,r,n,s)=>{const o=Math.min(Math.pow(n*n+s*s,1/2)/2,xt),c=s<0?-o:o,m=vt(n,s),u=m+ke,p=m-ke,x=t+n,D=r+s,S=x-c*Math.sin(Math.PI*u/180),L=D-c*Math.cos(Math.PI*u/180),b=x-c*Math.sin(Math.PI*p/180),F=D-c*Math.cos(Math.PI*p/180);e.beginPath(),e.moveTo(t,r),e.lineTo(x,D),e.lineTo(S,L),e.moveTo(x,D),e.lineTo(b,F),e.stroke()},Lt=(e,t)=>{const{type:r,x:n,y:s,width:o,height:c}=t;switch(r){case"rectangle":$(e,n,s,o,c);return;case"circle":Et(e,n+o/2,s+c/2,Math.abs(o/2),Math.abs(c/2));return;case"arrow":It(e,n,s,o,c);return;case"diamond":bt(e,n,s,o,c);return;case"selection":Rt(e,n,s,o,c);return}},At=(e,t)=>{const{content:r,x:n,y:s,containerId:o,width:c}=t;e.textBaseline="bottom",e.font=`${U}px  ${Ce}`,de(r).forEach((u,p)=>{if(o){const x=e.measureText(u).width;e.fillText(u,n+(c-x)/2,s+U*(p+1))}else e.fillText(u,n,s+U*(p+1))})},Ne=(e,{x:t,y:r,width:n,height:s,type:o},c)=>{const m=n>0?H:-H,u=s>0?H:-H,p=t-m,x=t+n+m,D=r-u,S=r+s+u;if(e.setLineDash(Dt),e.beginPath(),e.moveTo(p,D),e.lineTo(x,D),e.lineTo(x,S),e.lineTo(p,S),e.closePath(),e.stroke(),e.setLineDash([]),!c){const L=n>0?J:-J,b=s>0?J:-J;o!=="text"&&($(e,p,D,-L,-b),$(e,x,S,L,b),o!=="arrow"&&($(e,x,D,L,-b),$(e,p,S,-L,b)))}},Mt=e=>{const t=i.getSelectionData();if(!t)return;const[r,n,s,o]=t;Ne(e,{x:r,y:s,width:n-r,height:o-s,type:"selection"},!1)},De=(e,t=i.data)=>{let r=!1;i.data.filter(s=>s.isSelected).length>1&&(Mt(e),r=!0),t.forEach(s=>{s.isSelected&&Ne(e,s,r),s.type==="text"?At(e,s):Lt(e,s)})};var B,ue,_t;class zt{constructor(){ge(this,ue);Me(this,"data");ge(this,B,void 0);this.data=_e(this,ue,_t).call(this),ze(this,B,[])}addOperateStack(t){ae(this,B).push(t)}getSelectionData(){const t=this.data.filter(r=>r.isSelected);if(t.length===1&&t[0].type==="text")return null;if(t.length===1&&t[0].type==="arrow"){const r=t[0];return[r.x,r.x+r.width,r.y,r.y+r.height,!0]}return[...Re(t),!1]}addDrawData(t){this.data.push(t)}popDrawData(){this.data.pop()}revokeDrawData(){if(ae(this,B).length>0){const t=ae(this,B).pop();if(t.type==="DELETE"&&this.data.push(...t.payload),t.type==="ADD"&&(this.data=this.data.filter(r=>!t.selectedIds.includes(r.id))),t.type==="MOVE"){const{x:r,y:n}=t.payload;this.data.forEach(s=>s.isSelected=!1),this.data.filter(s=>t.selectedIds.includes(s.id)).forEach(s=>{s.x-=r,s.y-=n,s.isSelected=!0})}if(t.type==="RESIZE"){const r=t.payload,n=r.map(s=>s.id);this.data=this.data.filter(s=>!n.includes(s.id)).concat(r)}t.type==="SET"&&(this.data=t.payload),this.storageDrawData()}}storageDrawData(){this.data=this.data.filter(t=>t.type!=="selection").map(t=>{if(t.type==="arrow")return t;const r=W({},t);return r.width<0&&(r.x=r.x+r.width,r.width=-r.width),r.height<0&&(r.y=r.y+r.height,r.height=-r.height),r}),localStorage.setItem(xe,JSON.stringify(this.data))}delete(){const t=[];this.data=this.data.filter(r=>r.isSelected?(t.push(oe(W({},r),{isSelected:!1})),!1):!0),this.addOperateStack({type:"DELETE",payload:t}),this.storageDrawData()}}B=new WeakMap,ue=new WeakSet,_t=function(){let t;try{t=JSON.parse(localStorage.getItem(xe))||[]}catch{t=[],localStorage.setItem(xe,"[]")}return t};var i=new zt;const Xe=()=>document.querySelector("textarea")?null:document.createElement("textarea"),Ye=(e,t)=>{Object.assign(e.style,W({position:"absolute",margin:0,padding:0,border:0,outline:0,background:"transparent",resize:"none",fontSize:U+"px",lineHeight:"1em",fontFamily:Ce,overflow:"hidden"},t))},We=(e,{oninput:t,onChange:r})=>{e.onkeydown=n=>{n.stopPropagation()},e.oninput=()=>{e.style.height=e.scrollHeight+"px",t==null||t()},e.onblur=n=>{r(n.target.value),document.body.removeChild(e)},setTimeout(()=>{e.focus()})},Ot=(e,t,r)=>{const n=Xe();if(!!n){if(Ye(n,{top:e.y+e.height/2-U+"px",left:e.x+"px",width:e.width+"px",textAlign:"center"}),r){const s=r.content;n.value=s,n.setSelectionRange(0,s.length),n.style.height=r.height+"px",n.style.top=e.y+e.height/2-r.height/2+"px"}We(n,{oninput:()=>{n.style.top=e.y+e.height/2-n.scrollHeight/2+"px"},onChange:s=>{t(s,n.scrollHeight)}}),document.body.appendChild(n)}},Ct=({x:e,y:t},r,n)=>{const s=Xe();!s||(n&&(s.value=n,s.setSelectionRange(0,n.length),s.style.height=U*de(n).length+"px"),Ye(s,{top:t+"px",left:e+"px",width:`${window.innerWidth-e}px`,whiteSpace:"nowrap"}),We(s,{onChange:r}),document.body.appendChild(s))},P=5,Pt=e=>e>P?e-P:0,q=e=>e+P<window.innerWidth?e+P:window.innerWidth,Q=e=>e+P<window.innerWidth?e+P:window.innerWidth,Y=(e,t,r)=>e>=Pt(t)&&e<=r,Se=(e,t,r,n)=>Math.pow(Math.pow(Math.abs(e-t),2)+Math.pow(Math.abs(r-n),2),1/2),Te=({x:e,y:t})=>{for(let r=0;r<i.data.length;r++){const n=i.data[r],s=n.x,o=n.x+n.width,c=n.y,m=n.y+n.height;if(n.isSelected){const u=n.width>0?o:s,p=n.width>0?s:o,x=n.height>0?m:c,D=n.height>0?c:m;if(e>=p&&e<=u&&t>=D&&t<=x)return n.id}if(n.type==="text"&&Y(e,s,q(o))&&Y(t,c,Q(m))||n.type==="rectangle"&&((Y(e,s,q(s))||Y(e,o,q(o)))&&Y(t,c,Q(m))||(Y(t,c,Q(c))||Y(t,m,Q(m)))&&Y(e,s,q(o))))return n.id;if(n.type==="diamond"){const u=n.width*n.height,p=Math.abs(e-(s+n.width/2)),x=Math.abs(t-(c+n.height/2)),D=((p+P)*n.height+(x+P)*n.width)*2,S=((p-P)*n.height+(x-P)*n.width)*2;if(D>=u&&S<=u)return n.id}if(n.type==="circle"){const u=s+n.width/2,p=c+n.height/2,x=Math.abs(n.width/2),D=Math.abs(n.height/2),S=x>D?1/x:1/D;for(let L=0;L<Math.PI*2;L+=S){const b=Math.round(u+x*Math.cos(L)),F=Math.round(p+D*Math.sin(L));if(Y(e,b,q(b))&&Y(t,F,Q(F)))return n.id}}if(n.type==="arrow"){const u=Math.round(Se(s,o,c,m)),p=Math.round(Se(e,s,t,c)+Se(e,o,t,m));if(p>=u-P/2&&p<=u+P/2)return n.id}}return null},kt=(e,t,r,n)=>{const[s,o]=r>0?[e+r,e]:[e,e+r],[c,m]=n>0?[t+n,t]:[t,t+n];return i.data.filter(u=>{if(u.type==="selection")return!1;const[p,x]=u.width>0?[u.x+u.width,u.x]:[u.x,u.x+u.width],[D,S]=u.height>0?[u.y+u.height,u.y]:[u.y,u.y+u.height];return s>=p&&o<=x&&c>=D&&m<=S}).map(({id:u})=>u)},Fe=(e,t)=>{const r=i.getSelectionData();if(!r)return!1;const[n,s,o,c]=r;return e<=n&&e>=s&&t<=o&&t>=c},T=(e,t,r)=>r?e>=t+H&&e<=t+J+H:e<=t-H&&e>=t-J-H,He=({x:e,y:t})=>{const r=i.getSelectionData();if(!r)return null;const[n,s,o,c,m]=r;if(m){if(n>=s&&o>c){if(T(e,s,!1)&&T(t,c,!1))return[I.nwseResize,"top"];if(T(e,n,!0)&&T(t,o,!0))return[I.nwseResize,"bottom"]}else if(n>=s&&o<c){if(T(e,s,!1)&&T(t,c,!0))return[I.neswResize,"bottom"];if(T(e,n,!0)&&T(t,o,!1))return[I.neswResize,"top"]}else if(n<s&&o>c){if(T(e,s,!0)&&T(t,c,!1))return[I.neswResize,"top"];if(T(e,n,!1)&&T(t,o,!0))return[I.neswResize,"bottom"]}else{if(T(e,n,!1)&&T(t,o,!1))return[I.nwseResize,"top"];if(T(e,s,!0)&&T(t,c,!0))return[I.nwseResize,"bottom"]}return null}return T(e,s,!1)&&T(t,c,!1)?[I.nwseResize,"top"]:T(e,n,!0)&&T(t,o,!0)?[I.nwseResize,"bottom"]:T(e,s,!1)&&T(t,o,!0)?[I.neswResize,"bottom"]:T(e,n,!0)&&T(t,c,!1)?[I.neswResize,"top"]:null},Nt=({x:e,y:t})=>{const r=i.data.filter(n=>n.type==="text");for(let n=0;n<r.length;n++){const s=r[n];if(e>=s.x&&e<=s.x+s.width&&t>=s.y&&t<=s.y+s.height)return s}return null},Re=e=>{let t=-1/0,r=-1/0,n=1/0,s=1/0;return e.forEach(o=>{const[c,m]=o.width>0?[o.x+o.width,o.x]:[o.x,o.x+o.width],[u,p]=o.height>0?[o.y+o.height,o.y]:[o.y,o.y+o.height];c>t&&(t=c),u>r&&(r=u),m<n&&(n=m),p<s&&(s=p)}),[t,n,r,s]},Xt=({x:e,y:t})=>{let r=null;return i.data.forEach(n=>{const s=n.x+n.width/2,o=n.y+n.height/2;["rectangle","circle","diamond"].includes(n.type)&&e<=s+ce&&e>=s-ce&&t<=o+ce&&t>=o-ce&&(r?n.width<r.width&&(r=n):r=n)}),r},de=e=>e.replace(/\r\n?/g,`
`).split(`
`).filter(t=>!!t.trim()),Yt=e=>{const t="\uFEFF",r=new Blob([t+e],{type:"text/json"});return URL.createObjectURL(r)},Ge=(e,t)=>{const r=document.createElement("a");r.download=t,r.href=e,document.body.appendChild(r),r.click(),document.body.removeChild(r)};var k=lt();const Wt="_container_1dwzc_1",Ft="_element_1dwzc_10",Ht="_operate_1dwzc_14",Gt="_active_1dwzc_30";var G={container:Wt,element:Ft,operate:Ht,"tool-item":"_tool-item_1dwzc_17",active:Gt,"tool-index":"_tool-index_1dwzc_33"};const Ut=({Icon:e,index:t,changeType:r,isActive:n})=>ie("div",{className:we(G["tool-item"],{[G.active]:n}),onClick:r,children:[z("div",{children:e}),z("div",{className:G["tool-index"],children:t})]}),Bt=(e,t)=>{g.exports.useEffect(()=>{const r=()=>{!e.current||!t.current||(e.current.width=window.innerWidth,e.current.height=window.innerHeight,De(t.current))};return r(),window.addEventListener("resize",r),()=>document.removeEventListener("resize",r)},[])},Ue=e=>{g.exports.useEffect(()=>{const t=r=>{const{key:n,metaKey:s}=r;e(n,s)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[])},Ee=g.exports.createContext({}),jt=({children:e})=>{const[t,r]=g.exports.useState("selection");return z(Ee.Provider,{value:{drawType:t,setDrawType:r},children:e})},be=g.exports.createContext({}),Jt=({children:e})=>{const[t,r]=g.exports.useState(I.default);return z(be.Provider,{value:{cursorType:t,setCursorType:r},children:e})},Kt=e=>{const{drawType:t,setDrawType:r}=g.exports.useContext(Ee),{cursorType:n,setCursorType:s}=g.exports.useContext(be),o=g.exports.useRef(!1),c=g.exports.useRef(!1),m=g.exports.useRef(!1),u=g.exports.useRef(!1),p=g.exports.useRef(),x=g.exports.useRef(),D=g.exports.useRef(),S=g.exports.useRef({x:0,y:0}),L=g.exports.useRef({x:0,y:0}),b=g.exports.useRef({x:0,y:0}),F=g.exports.useRef([]),V=g.exports.useRef([]),fe=g.exports.useRef({x:0,y:0}),ee=g.exports.useRef(!1),_=()=>{e.current&&(e.current.clearRect(0,0,window.innerWidth,window.innerHeight),De(e.current))},K=()=>{i.data.forEach(l=>l.isSelected=!1)};g.exports.useEffect(()=>{const l=()=>{i.addOperateStack({type:"DELETE",payload:i.data}),i.data=[],i.storageDrawData(),_()},d=()=>{if(i.data.length===0)return;const h=document.createElement("canvas"),[y,w,R,E]=Re(i.data),v=y-w+le,A=R-E+le;h.width=v,h.height=A;const M=h.getContext("2d");M.save(),M.fillStyle=mt,M.fillRect(0,0,v,A),M.restore(),De(M,i.data.map(C=>oe(W({},C),{x:C.x-w+le/2,y:C.y-E+le/2})));const O=h.toDataURL();Ge(O,St)},a=()=>{if(i.data.length===0)return;const h=Yt(JSON.stringify(i.data));Ge(h,Tt)},f=()=>{const h=document.createElement("input");h.type="file",document.body.appendChild(h),h.click(),h.onchange=y=>{const R=y.target.files[0],E=new FileReader;E.onload=v=>{try{const A=JSON.parse(v.target.result);i.addOperateStack({type:"SET",payload:i.data}),i.data=A,i.storageDrawData(),_()}catch{}},E.readAsText(R),document.body.removeChild(h)}};return k.on("exportImage",d),k.on("exportData",a),k.on("clear",l),k.on("import",f),()=>{k.off("import",f),k.off("exportData",a),k.off("exportImage",d),k.off("clear",l)}},[]),g.exports.useEffect(()=>{const l=()=>{V.current=i.data.filter(a=>a.isSelected)},d=()=>{if(V.current.length>0&&!ee.current){const[a,f,h,y]=Re(V.current),[w,R]=[(a+f)/2,(h+y)/2],[E,v]=[fe.current.x-w,fe.current.y-R];K();const A=[];V.current.forEach(M=>{const O=Z();i.addDrawData(oe(W({},M),{id:O,x:M.x+E,y:M.y+v,isSelected:!0})),A.push(O)}),i.addOperateStack({type:"ADD",selectedIds:A}),i.storageDrawData(),_()}};return document.addEventListener("copy",l),document.addEventListener("paste",d),()=>{document.removeEventListener("copy",l),document.addEventListener("paste",d)}},[]);const Be=(l,d,a)=>{l.type==="arrow"?x.current==="head"?(l.width+=d,l.height+=a):(l.x+=d,l.y+=a,l.width-=d,l.height-=a):n==="nesw-resize"?p.current==="top"?(l.y+=a,l.width+=d,l.height-=a):(l.height+=a,l.x+=d,l.width-=d):n==="nwse-resize"&&(p.current==="top"?(l.x+=d,l.y+=a,l.width-=d,l.height-=a):(l.width+=d,l.height+=a))},je=(l,d,a)=>{const{x:f,y:h}=L.current,y={x:0,y:0},w=d-f,R=a-h,E=i.getSelectionData(),v=E[0]-E[1],A=E[2]-E[3],M=p.current==="top",O=M&&n==="nesw-resize"||p.current==="bottom"&&n==="nwse-resize",C=p.current==="bottom"&&n==="nesw-resize"||M&&n==="nwse-resize";if(v<=Pe&&(w<=b.current.x&&O||w>=b.current.x&&C)||A<=Pe&&(R<=b.current.y&&p.current==="bottom"||R>=b.current.y&&M))return;let N=0,j=0;const ve=Math.abs(w)>Math.abs(R);N=ve?n==="nesw-resize"?-R:R:w,j=ve?R:n==="nesw-resize"?-w:w,y.x=E[O?1:0],y.y=E[M?2:3],l.forEach(X=>{const Ie=Math.abs(X.x-y.x)/v,$e=Math.abs(X.x+X.width-y.x)/v,Le=Math.abs(X.y-y.y)/A,qe=Math.abs(X.y+X.height-y.y)/A;X.x+=(N-b.current.x)*Ie,X.y+=(j-b.current.y)*Le,X.width+=(N-b.current.x)*($e-Ie),X.height+=(j-b.current.y)*(qe-Le)}),b.current={x:N,y:j}},Je=(l,d,a)=>{l.length===1?Be(l[0],d-S.current.x,a-S.current.y):je(l,d,a)},Ke=(l,d,a)=>{l.forEach(f=>{f.x+=d,f.y+=a})},he=(l,d,a)=>{ee.current=!0;const f=d?i.data.find(h=>h.id===d):Xt(l);f?Ot(f,(h,y)=>{if(ee.current=!1,h.trim()&&e.current){let w=0;const R=de(h),E=[];R.forEach(O=>{let C="";for(let N=1;N<=O.length;N++){C=O.substring(w,N);const{width:j}=e.current.measureText(C);j>f.width&&(E.push(O.substring(w,N-1)),w=N-1)}C&&E.push(C)});let v=0;E.forEach(O=>{const{width:C}=e.current.measureText(O);C>v&&(v=C)});const A=Z(),M=f.y+f.height/2-y/2;i.addDrawData({type:"text",id:A,x:f.x+(f.width-v)/2,y:M,content:E.join(`
`),width:v,height:y,isSelected:!1,containerId:f.id}),f.boundElement.push({type:"text",id:A}),i.addOperateStack({type:"ADD",selectedIds:[A]}),i.storageDrawData(),_()}},a):Ct(l,h=>{if(ee.current=!1,h.trim()){const y=de(h);let w=0;y.forEach(E=>{if(e.current){const{width:v}=e.current.measureText(E);v>w&&(w=v)}});const R=Z();i.addDrawData({type:"text",id:R,x:l.x,y:l.y,content:h,width:w,height:y.length*U,isSelected:!1,containerId:null}),i.addOperateStack({type:"ADD",selectedIds:[R]}),i.storageDrawData(),_()}},a==null?void 0:a.content)},te=g.exports.useRef();te.current=(l,d)=>{if(t==="selection"){const a=Nt({x:l,y:d});K(),a?(i.data=i.data.filter(f=>f.id!==a.id),he({x:a.x,y:a.y},a.containerId,a)):he({x:l,y:d},null),_()}},g.exports.useEffect(()=>{const l=({pageX:d,pageY:a})=>{var f;(f=te.current)==null||f.call(te,d,a)};return document.addEventListener("dblclick",l),()=>document.removeEventListener("dblclick",l)},[]),g.exports.useEffect(()=>{s(t==="selection"?I.default:I.crosshair),t!=="selection"&&K()},[t]),Ue((l,d)=>{d&&l==="z"&&(i.revokeDrawData(),_()),d&&l==="a"&&(i.data.forEach(a=>a.isSelected=!0),i.data.length>1&&(u.current=!0),i.storageDrawData(),_()),l==="Backspace"&&(i.delete(),_())});const Ze=()=>{D.current=void 0,m.current=!1,b.current={x:0,y:0},F.current=[]},re=g.exports.useRef();re.current=l=>{if(l.button===2)return;const{pageX:d,pageY:a}=l;if(S.current=L.current={x:d,y:a},t==="text")r("selection"),he({x:d,y:a},null);else if(t==="selection"){if(o.current=!0,u.current&&Fe(d,a)){c.current=!0;return}const f=He({x:d,y:a});if(f){p.current=f[1],c.current=!0;const y=i.data.filter(w=>w.isSelected);if(F.current=y.map(w=>W({},w)),y.length===1&&y[0].type==="arrow"){const w=y[0];x.current=w.height<=0&&p.current==="top"||w.height>0&&p.current==="bottom"?"head":"foot"}return}const h=Te({x:d,y:a});K(),c.current=!1,h?(i.data.find(y=>y.id===h).isSelected=!0,c.current=!0,i.storageDrawData()):(i.addDrawData({type:t,id:Z(),x:d,y:a,width:0,height:0,isSelected:!1}),_())}else o.current=!0,i.addDrawData({type:t,id:Z(),x:d,y:a,width:0,height:0,isSelected:!1,boundElement:[]})};const ne=g.exports.useRef();ne.current=l=>{const{pageX:d,pageY:a}=l;if(fe.current={x:d,y:a},!o.current){const y=He({x:d,y:a});if(y){s(y[0]);return}if(t==="selection"){const w=u.current?Fe(d,a):Te({x:d,y:a});s(w?I.move:I.default)}return}const f=d-S.current.x,h=a-S.current.y;if(t==="selection"&&c.current){const y=i.data.filter(R=>R.isSelected),w=["nesw-resize","nwse-resize"].includes(n);w?Je(y,d,a):Ke(y,f,h),(d!==S.current.x||a!==S.current.y)&&(D.current=w?"resize":"move",S.current={x:d,y:a})}else{const y=i.data[i.data.length-1];if(y.type!=="text"&&(y.width=f,y.height=h),y.type==="selection"){m.current=!0;const w=kt(S.current.x,S.current.y,f,h);u.current=w.length>1,i.data.forEach(R=>{R.isSelected=w.includes(R.id)})}}_()};const se=g.exports.useRef();se.current=l=>{if(!o.current)return;o.current=!1;const{pageX:d,pageY:a}=l;if(d===S.current.x&&a===S.current.y)t!=="selection"&&i.popDrawData(),D.current?D.current==="move"?i.addOperateStack({type:"MOVE",selectedIds:i.data.filter(f=>f.isSelected).map(f=>f.id),payload:{x:d-L.current.x,y:a-L.current.y}}):i.addOperateStack({type:"RESIZE",payload:F.current}):u.current=!1;else{if(t!=="selection"){const f=i.data[i.data.length-1];f.isSelected=!0,i.addOperateStack({type:"ADD",selectedIds:[f.id]}),r("selection")}else i.popDrawData();_()}if(t==="selection"&&!D.current&&!m.current){K();const f=Te({x:d,y:a});f?i.data.find(h=>h.id===f).isSelected=!0:s(I.default),_()}Ze(),i.storageDrawData()},g.exports.useEffect(()=>{const l=f=>{var h;(h=ne.current)==null||h.call(ne,f)},d=f=>{var h;(h=re.current)==null||h.call(re,f)},a=f=>{var h;(h=se.current)==null||h.call(se,f)};return document.addEventListener("mousedown",d),document.addEventListener("mousemove",l),document.addEventListener("mouseup",a),()=>{document.removeEventListener("mousedown",d),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",a)}},[])},Zt=()=>{const{drawType:e,setDrawType:t}=g.exports.useContext(Ee);Ue(m=>{const u=+m-1;!isNaN(u)&&u!==-1&&u<me.length&&t(me[u].type)});const r=(m,u)=>z("div",{className:G["tool-item"],onClick:u,children:z(m,W({},Oe))}),n=()=>{k.emit("clear")},s=()=>{k.emit("import")},o=()=>{k.emit("exportData")},c=()=>{k.emit("exportImage")};return ie(dt,{children:[z("div",{className:we(G.container,G.element),children:me.map(({Icon:m,type:u},p)=>z(Ut,{isActive:u===e,Icon:z(m,W({},Oe)),index:p+1,changeType:()=>t(u)},p))}),ie("div",{className:we(G.container,G.operate),children:[r(pt,n),r(ut,s),r(ft,o),r(ht,c)]})]})};function $t(){const e=g.exports.useRef(null),t=g.exports.useRef(null),{cursorType:r}=g.exports.useContext(be);return g.exports.useEffect(()=>{e.current&&(t.current=e.current.getContext("2d"))},[]),Kt(t),Bt(e,t),ie("div",{className:"App",style:{position:"relative",cursor:r},children:[z(Zt,{}),z("canvas",{ref:e,id:"canvas"})]})}yt.render(z(gt.StrictMode,{children:z(jt,{children:z(Jt,{children:z($t,{})})})}),document.getElementById("root"));
